function browserEvent(a){return"on"+a in window||a.replace(/end|start|update$/,"")in document.body.style?a:"onwebkit"+a in window?"webkit"+this.capitalize(a[0]).replace(/(end|start|update)$/,this.capitalize):!1}function msiebox(a){"MSIE9"==currentBrowser()&&(a.onresize=function(a){(a=this.firstElementChild)&&this.clientHeight!=a.offsetHeight&&(a.style.height=this.clientHeight+"px")})}
function toClipboard(a,b){var c=mkElement("textarea",{value:a,style:"width: 1px; height: 1px; position: absolute; top: -100%; left: -100%"});document.body.appendChild(c);c.select();if(document.queryCommandSupported("copy")&&document.queryCommandEnabled("copy")&&document.execCommand("copy"))return gui.notifier&&gui.notifier._value({type:"success",args:{text_plain:getLang("notification::"+(b||"clipboard_link"))}}),setTimeout(function(){c.parentNode&&c.parentNode.removeChild(c)},220),!0;gui.notifier&&
gui.notifier._value({type:"alert",args:{header:"",text:"ERROR::CLIPBOARD"}});return!1}function emulateEventHandlers(a){for(var b=0;b<a.length;b++)document.addEventListener(a[b],function(a){window.event=a},!0)}"object"==typeof window.event?"":emulateEventHandlers(["mousemove","mousedown","mouseover"]);
window.opera&&11>parseInt(window.opera.version(),10)&&"undefined"==typeof document.getElementsByTagName("html")[0].oncontextmenu&&(window.addEventListener("mousedown",function(a){if(a.altKey)return a.preventDefault(),a.cancelBubble=!0,!1;if(2==a.button){var b=a.srcElement;do{if(b.oncontextmenu){a.preventDefault();a.cancelBubble=!0;window.opera.__overrideBtn&&(window.opera.__overrideBtn.parentNode.removeChild(window.opera.__overrideBtn),window.opera.__overrideBtn=null);window.opera.__overrideBtn=document.createElement("input");
window.opera.__overrideBtn.type="button";window.opera.__overrideBtn.style.position="absolute";window.opera.__overrideBtn.style.zIndex=1E4;window.opera.__overrideBtn.style.width="5px;";window.opera.__overrideBtn.style.height="5px;";window.opera.__overrideBtn.style.left=a.clientX-2+"px";window.opera.__overrideBtn.style.top=a.clientY-2+"px";window.opera.__overrideBtn.style.opacity=.01;document.body.appendChild(window.opera.__overrideBtn);b.oncontextmenu({type:"contextmenu",srcElement:a.srcElement,clientX:a.clientX,
clientY:a.clientY,button:2});break}b=b.parentNode}while(b!=document)}},!0),window.addEventListener("mouseup",function(a){window.opera.__overrideBtn&&(window.opera.__overrideBtn.parentNode.removeChild(window.opera.__overrideBtn),window.opera.__overrideBtn=null)},!0),window.addEventListener("click",function(a){if(a.altKey){var b=a.srcElement;do{if(b.oncontextmenu){a.preventDefault();a.cancelBubble=!0;b.oncontextmenu({type:"contextmenu",srcElement:a.srcElement,clientX:a.clientX,clientY:a.clientY,button:2});
break}b=b.parentNode}while(b!=document);return!1}},!0));var supportsPassive=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=!0}});window.addEventListener("test",null,opts)}catch(a){}
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!=e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c},writable:!0,configurable:!0});Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);
Element.prototype.closest||(Element.prototype.closest=function(a){var b=this;do{if(b.matches(a))return b;b=b.parentElement||b.parentNode}while(null!==b&&1===b.nodeType);return null});
function AttachEvent(a,b,c){a.addEventListener?(b=b.substr(2),"mousewheel"==b?(0==(window.navigator.platform||"").toLowerCase().indexOf("mac")&&"Mozilla"==currentBrowser()?b="DOMMouseScroll":Is.Defined(document.documentElement.onwheel)||8<(document.documentMode||0)?b="wheel":"Mozilla"==currentBrowser()&&(b="DOMMouseScroll"),a.addEventListener(b,function(a){a=a||window.event;var b={originalEvent:a,type:a.type,srcElement:a.target||a.srcElement,deltaX:0,deltaY:0};"mousewheel"==a.type?(Is.Defined(a.wheelDeltaX)&&
(b.deltaX=a.wheelDeltaX/-40),Is.Defined(a.wheelDeltaY)?b.deltaY=a.wheelDeltaY/-40:b.deltaY=a.wheelDelta/-40):"wheel"==a.type?document.documentMode&&8<document.documentMode||-1!=navigator.userAgent.indexOf("WebKit")?(b.deltaX=a.deltaX/40,b.deltaY=a.deltaY/40):(b.deltaX=a.deltaX,b.deltaY=a.deltaY):Is.Defined(a.axis)&&a.axis===a.HORIZONTAL_AXIS?b.deltaX=a.detail:b.deltaY=a.detail;c(b)},supportsPassive?{passive:!0}:!1)):a.addEventListener(b,c,!1)):a.attachEvent&&a.attachEvent(b,function(){if("onmousewheel"==
b){var d=arguments[0]||window.event;c.apply(a,[{originalEvent:d,type:d.type,srcElement:d.target||d.srcElement,deltaX:0,deltaY:d.wheelDelta/-40}])}else c.apply(a,arguments)})}function unique_id(){return 1E18*Math.random()+""+(new Date).getTime()}var sAvatarNo=Date.now();
function getAvatarURL(a,b){a===sPrimaryAccount?b=sAvatarNo:b||(b=0);try{return"/teamchatapi/files.avatar?"+buildURL({token:sPrimaryAccountTeamchatToken,email:a||"",skin:GWOthers.getItem("LAYOUT_SETTINGS","skin")||"default",no:b})}catch(c){return console.log("getAvatarURL",c),console.log(sPrimaryAccountTeamchatToken,a),""}}
function getContactAvatarURL(a){try{return"/teamchatapi/files.avatar?"+buildURL({token:sPrimaryAccountTeamchatToken,email:"",contactid:WMItems.__serverID(a)||"",skin:GWOthers.getItem("LAYOUT_SETTINGS","skin")||"default"})}catch(b){return console.log("getContactAvatarURL",b),console.log(sPrimaryAccountTeamchatToken,a),""}}
window.downloadItem=function(a,b){function c(){var a=this.contentDocument,b,c="";try{b=a.documentElement,c=JSON.parse(b.innerText||b.xtContent).error}catch(g){}switch(c){case "no_permission":return gui.notifier._value({type:"alert",args:{text:"ERROR::E_ACCESS",args:[c]}});default:c&&gui.notifier._value({type:"alert",args:{text:"ALERTS::GENERAL_ERROR",args:[c]}})}}return function(a,b){if(Is.String(a)){var f,g=b?a:"server/download.php?"+a;if(b&&"https:"==location.protocol&&0==a.toLowerCase().indexOf("http:")&&
(f=window.open(g,"downloadFile"))&&f.document){f.document.onload=function(){window.close()};return}f="ifrm_download_"+unique_id();frm=mkElement("iframe",{id:f,src:g});frm.style.position="absolute";frm.style.width="1px";frm.style.height="1px";frm.style.top="0";frm.style.left="-1000px";frm.onload=c;document.body.appendChild(frm);setTimeout(function(){try{frm&&frm.parentNode&&frm.parentNode.removeChild(frm)}catch(a){gui._REQUEST_VARS.debug&&console.log("downloadItem",g,a)}},12E4)}}}();
window.getRemoteFileContent=function(a,b){var c=new XMLHttpRequest;c.open("GET",a);c.onreadystatechange=function(){4===c.readyState&&(200===c.status||0==c.status?b(c.responseText):b(!1))};c.send()};function openItem(a,b,c){window.open(b?a:"server/download.php?"+a,c||"file","menubar=no,resizable=yes,status=no,location=no")}
var GSM0338_To_Unicode_Charset=[64,36,165,232,233,249,236,242,231,10,216,248,13,197,229,916,95,934,915,923,937,928,936,931,920,926,27,198,230,223,201,32,33,34,35,164,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,161,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,196,214,209,220,167,191,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,228,246,241,252,224];
Math.ceilFloat=function(a,b){b=this.pow(10,parseInt(b,10))||1;return this.ceil(parseFloat(a)*b)/b};Math.rand=function(a){a=a||1E16;return this.floor(this.random()*a+1)};function cMaxZIndex(){}cMaxZIndex.prototype.zindex=[500];cMaxZIndex.prototype.get=function(a){var b=this.zindex[this.zindex.length-1]+1;a||this.zindex.push(b);return b};cMaxZIndex.prototype.remove=function(a){a=inArray(this.zindex,a);-1<a&&this.zindex.splice(a,1)};maxZIndex=new cMaxZIndex;
function setSelectAll(a){try{a.style.setProperty("MozUserSelect","text",""),a.style.setProperty("-moz-user-select","text","")}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}try{a.unselectable="off"}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}try{a.style.KhtmlUserSelect="text"}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}try{a.style.WebkitUserSelect="text"}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}}
function setSelectNone(a){try{a.style.setProperty("MozUserSelect","-moz-none",""),a.style.setProperty("-moz-user-select","-moz-none","")}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}try{a.unselectable="on"}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}try{a.style.KhtmlUserSelect="none"}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}try{a.style.WebkitUserSelect="none"}catch(b){gui._REQUEST_VARS.debug&&console.log(this._name||!1,b)}}
function pubEval(a){if(!a)return!1;try{"object"==typeof window.execScript?window.execScript(a):window.eval(a)}catch(b){if(console)console.log("pubEval()",b);else throw"pubEval() - unable to Eval: \r\n"+a;return!1}}
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!=e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c},writable:!0,configurable:!0});
function mkElement(a,b,c,d){var e=(c||document).createElement(a);if("object"===typeof b)for(var f in b)try{switch(f){case "contenteditable":case "for":e.setAttribute(f,b[f]);break;case "text":e.appendChild((c||document).createTextNode(b[f]));break;case "style":if(Is.Object(b[f])){for(var g in b[f])e.style[g]=b[f][g];break}case "href":if(!b[f])break;default:f in e?e[f]=b[f]:e.setAttribute(f,b[f])}}catch(h){}(Array.isArray(d)?d:[d]).forEach(function(a){a&&e.appendChild(a)});return e}
function isDescendent(a,b){for(;b=b.parentNode;)if(b==a)return!0;return!1}
function addcss(a){if(a){for(var b=[],c=1;c<arguments.length;c++)Is.String(arguments[c])&&(b=b.concat(arguments[c].trim().split(" ")));if(a.classList&&a.classList.add)for(c=0;c<b.length;c++)b[c]&&a.classList.add(b[c]);else{var d=a.className?a.className.split(" "):[];if(d.length){for(var e in d)d[e]&&(d[e]=d[e].trim());for(c=0;c<b.length;c++)0>inArray(d,b[c])&&d.push(b[c]);d=d.join(" ");a.className!=d&&(a.className=d)}else a.className=b.join(" ")}}}
function removecss(a){if(a)if(2>arguments.length)a.className="";else if(a.classList&&a.classList.remove)for(var b=1;b<arguments.length;b++)Is.String(arguments[b])&&a.classList.remove(-1<arguments[b].indexOf(" ")?arguments[b].trim():arguments[b]);else{for(var c=a.className?a.className.split(" "):[],d=c.length,b=1;b<arguments.length;b++)if(Is.String(arguments[b]))for(var e=c.length-1;-1<e;e--)c[e].toLowerCase()==arguments[b].toLowerCase()&&c.splice(e,1);c.length!=d&&(a.className=c.join(" "))}}
function togglecss(a,b){hascss(a,b)?removecss(a,b):addcss(a,b)}function hascss(a,b){return a.classList?a.classList.contains(b):-1<inArray((a.className||"").split(" "),b)}function getStyle(a,b,c){if(window.getComputedStyle)return(c||document).defaultView.getComputedStyle(a,null).getPropertyValue(b)||"";if(a.currentStyle)return a.currentStyle[b]||""}
(function(a){var b=a.document.createElement("div"),c=/-([a-z]|[0-9])/ig,d,e;a.supportcss=function(f,g){g=2===arguments.length?g:"inherit";if("CSS"in a&&"supports"in a.CSS)return a.CSS.supports(f,g);if("supportsCSS"in a)return a.supportsCSS(f,g);e=f.replace(c,function(a,b){return(b+"").toUpperCase()});d=e in b.style;b.style.cssText=f+":"+g;return d&&""!==b.style[e]}})(this);
function getSize(a,b){var c={x:0,y:0,h:a.offsetHeight,w:a.offsetWidth};if(a.getBoundingClientRect){b=b||document;var d=a.getBoundingClientRect();c.x=d.left+Math.max(b.documentElement.scrollLeft,b.body.scrollLeft);c.y=d.top+Math.max(b.documentElement.scrollTop,b.body.scrollTop);"MSIE7"==currentBrowser()&&(c.x--,c.y--)}else for(c.x=a.offsetLeft,c.y=a.offsetTop;(a=a.offsetParent)&&a&&"BODY"!=a.tagName;)c.x+=a.offsetLeft-a.scrollLeft,c.y+=a.offsetTop-a.scrollTop;return c}
Is=function(){var a=/^([a-z0-9\'\!\#\$\%\&\+\-\/\=\?\^\_\`\{\|\}\~\*][\.]?)+\@[a-z0-9]+([\.\-\_]?[a-z0-9])*\.[a-z]{2,}$/gi,b=/^([a-z0-9][\-\_\.]?)*\.[a-z]{2,6}$/gi,c=/^http(s?):\/\/[a-z0-9]*/gi,d=/^(?!\.)(?!com[0-9]$)(?!con$)(?!lpt[0-9]$)(?!nul$)(?!prn$)[^<>:\/\\|?*""]*$/gm;return{Boolean:function(a){return"boolean"==typeof a},Array:function(a){return Is.Object(a)&&a.constructor==Array},Empty:function(a){if(Is.Object(a))if(Is.Array(a)){if(a.length)return!1}else for(var b in a)if(!Is.Undefined(a[b]))return!1;
return!0},Function:function(a){return"function"==typeof a},Null:function(a){return"object"==typeof a&&!a},Number:function(a){return"number"==typeof a&&isFinite(a)},Object:function(a){return a&&"object"==typeof a||Is.Function(a)},String:function(a){return"string"==typeof a},Email:function(b){a.lastIndex=0;return Is.String(b)?!!b.match(a):!1},Domain:function(a){return Is.String(a)?!!a.match(b):!1},URL:function(a){return Is.String(a)?!!a.match(c):!1},Filename:function(a){return Is.String(a)&&a.trim().length?
!!a.match(d):!1},Undefined:function(a){return"undefined"==typeof a},Defined:function(a){return!Is.Undefined(a)},Date:function(a,b,c){var d=[31,28,31,30,31,30,31,31,30,31,30,31],l=0;a=parseInt(a,10);b=parseInt(b,10);c=parseInt(c,10);if(!Is.Number(a)||!Is.Number(b)||!Is.Number(c))return!1;d[1]=0==a%4&&0!=a%100||0==a%400?29:28;l=d[b-1];return 0>a||12<b||1>b||c>l||1>c?!1:!0},Child:function(a,b,c){if(Is.String(b)){b=b.toUpperCase();try{do{if(a.tagName==b)return a;if(c&&c==a)break}while(a=a.parentNode)}catch(d){gui._REQUEST_VARS.debug&&
console.log(this._name||!1,d)}}else if(b)if("contains"in document.body)try{return b.parentNode&&b.contains(a)}catch(d){gui._REQUEST_VARS.debug&&console.log(this._name||!1,d)}else try{do{if(a==b)return!0;if(c&&c==a)break}while(a=a.parentNode)}catch(d){gui._REQUEST_VARS.debug&&console.log(this._name||!1,d)}return!1}}}();String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};
String.prototype.unentityify=function(){return this.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")};String.prototype.urlEncode=function(){return encodeURIComponent(this).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")};String.prototype.urlDecode=function(){return decodeURIComponent(this.replace(/%(?![\da-f]{2})/gi,function(){return"%25"}).replace(/\+/g,"%20"))};
String.prototype.highlight_links=function(a){var b=this;0<this.indexOf("@")&&(a=a||"",b=b.replace(/(([a-z0-9\'\!\#\$\%\&\+\-\/\=\?\^\_\`\{\|\}\~\*][\.]?)+\@[a-z0-9]+([\.\-\_]?[a-z0-9])*\.[a-z]{2,})/gi,'<a href="mailto:$1"'+(a?" "+a:"")+">$1</a>"));return b=b.replace(/([A-Za-z]{3,5}:\/\/[^\s<]+?)([.,]\s|[\s<]|$)/g,'<a href="$1" target="_blank">$1</a>$2')};
String.prototype.highlight_links_array=function(a){for(var b=[],c=[],d=a?mkElement("A"):null,e=/@\[\S+\]/gi,f=/([a-z0-9\'\!\#\$\%\&\+\-\/\=\?\^\_\`\{\|\}\~\*][\.]?)+\@[a-z0-9]+([\.\-\_]?[a-z0-9])*\.[a-z]{2,}/gi,g=/([A-Za-z-]{3,}:\/\/[^\s<]+?)([.,]\s|[\s<]|$)/g,b=~this.indexOf("```")?this.split("```"):[this],h=0,l=b.length;h<l;h+=2)!b[h].match(g)&&0<b[h].indexOf("@")&&(b[h]=b[h].replace(e,function(a,b){return"~\u2591"+(c.push(a)-1)+"\u2591~"}),b[h]=b[h].replace(f,function(a,b){return"~\u2591"+(c.push('<a href="mailto:'+
a+'">'+a+"</a>")-1)+"\u2591~"})),b[h]=b[h].replace(g,function(b,e,f){b=e;a&&48<e.length&&(d.href=e,e=d.protocol+"//"+d.hostname,24<d.pathname.length?e+=d.pathname.substr(0,24)+"...":(e+=d.pathname,d.search&&(e+="?...")));return"~\u2591"+(c.push('<a href="'+b+'" target="_blank">'+e.entityify()+"</a>")-1)+"\u2591~"+f});return{string:b.join("```"),array:c,replace:"~\u2591(\\d+)\u2591~"}};
String.prototype.str_replace=function(a,b){for(var c=[].concat(a),d=[].concat(b),e=this,f=0,g=c.length;f<g;f++)e=e.split(c[f]).join(d[f]||"");return e.toString()};String.prototype.escapeXML=function(a){var b=this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");a&&(b=b.replace(/'/g,"&apos;").replace(/"/g,"&quot;"));return b};
String.prototype.unescapeXML=function(){return this.replace(/&gt;/gi,">").replace(/&lt;/gi,"<").replace(/&quot;/gi,'"').replace(/&apos;/gi,'"').replace(/&amp;/gi,"&")};
String.prototype.escapeHTML=function(){if("MSIE7"==currentBrowser()&&-1!=this.indexOf("\n"))return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var a=document.createElement("div");a.appendChild(document.createTextNode(this));return"Safari"==currentBrowser()||"KHTML"==currentBrowser()?a.innerHTML.replace(/>/gm,"&gt;"):a.innerHTML};
String.prototype.unescapeHTML=function(){if(0>this.indexOf("&"))return this.toString();var a=document.createElement("div");a.innerHTML=this.toString();for(var a=a.childNodes[0],b=a.textContent;;)if(a=a.nextSibling)a.nodeValue&&(b+=a.nodeValue);else break;return b};
String.prototype.quote=function(){var a,b,c=this.length,d='"';for(b=0;b<c;b+=1)if(a=this.charAt(b)," "<=a){if("\\"==a||'"'==a)d+="\\";d+=a}else switch(a){case "\b":d+="\\b";break;case "\f":d+="\\f";break;case "\n":d+="\\n";break;case "\r":d+="\\r";break;case "\t":d+="\\t";break;default:a=a.charCodeAt().toString(16),d=1==a.length?d+("\\u000"+a):d+("\\u00"+a)}return d+'"'};
String.prototype.hashCode=function(){var a=0,b,c;if(0===this.length)return a;for(b=0;b<this.length;b++)c=this.charCodeAt(b),a=(a<<5)-a+c,a|=0;return a};"a".split(/a/gi).length?String.prototype.realsplit=String.prototype.split:String.prototype.realsplit=function(a){if(a instanceof RegExp){for(var b=[],c,d=0;c=a.exec(this);)b.push(this.slice(d,c.index)),c[1]&&b.push(c[1]),d=a.lastIndex;b.push(this.slice(d));return b}return String.prototype.split.apply(this,arguments)};
String.prototype.remove=function(a,b){var c;c=Is.String(a)?new RegExp(a,"undefined"!=typeof b?b:"g"):a;return this.replace(c,"")};String.prototype.wrap=function(){return this.replace(/(\r\n)|(\r)|(\n)/gm,"<br>")};String.prototype.removeTags=function(a){return this.replace(/<[\!\/]?([\-a-zA-Z0-9]+)[^>^<]*>/gm,a||"").replace(/\&nbsp\;/g," ")};String.prototype.quoteSQL=function(){return this.replace(/([\'])/g,"$1$1").replace(/([%])/g,"\\$1")};
String.prototype.quoteMeta=function(){return this.replace(/([\!\#\$\%\^\@\.\&\*\(\)\-\_\=\+\:\;\"\'\\\/\?\<\>\~\[\]\{\}\`])/g,"\\$1")};var GlobalTools={search:function(a){this.text=a;this.word=""}};GlobalTools.search.prototype.find=function(a){a&&(this.word=a,this.re=new RegExp("("+this.word.quoteMeta()+")","gi"));if(this.text&&this.word)return this.matches=this.text.realsplit(this.re),1<this.matches.length?(this.matches.length-1)/2:!1;this.matches=null;return!1};
GlobalTools.search.prototype.within=function(a){this.text=a;return this};GlobalTools.search.prototype.highlight=function(a){a||(a="strong");var b=this.matches.slice(0),c=this.matches.length;if(c){for(;c--;)b[c]=c&1?"<"+a+">"+b[c].escapeXML()+"</"+a+">":b[c].escapeXML();return b.join("")}return!1};function dec2hex(a){return a.toString(16)}function hex2dec(a){return parseInt(a,16)}
function parseJulianTime(a){var b=(a-a%3600)/3600;a=Math.ceil(a%3600/60);a=10>a?"0"+a:a;return 0<GWOthers.getItem("LAYOUT_SETTINGS","time_format")?(b%12||12)+":"+a+(12>b?" AM":" PM"):b+":"+a}function arrayKeys(a){var b=[],c;for(c in a)null!=a[c]&&b.push(c);return b}function inArray(a,b){if("undefined"!=typeof a.indexOf&&Is.Array(a))return a.indexOf(b);for(var c in a)if(a[c]==b)return c;return-1}
function reverse(a){if(a.constructor==Array)return a.reverse();var b=[],c={},d;for(d in a)b.push(d);b.reverse();for(d in b)c[b[d]]=a[b[d]];return c}function arrConcat(){for(var a={},b=0;b<arguments.length;b++)for(var c in arguments[b])a[c]=arguments[b][c];return a}function arrConcatValues(){for(var a=clone(arguments[0]),b=1;b<arguments.length;b++)for(var c in arguments[b])0>inArray(a,arguments[b][c])&&a.push(arguments[b][c]);return a}
function mkArrayPath(a,b,c){"object"!=typeof b&&(b={});var d=b,e;for(e in a)2<arguments.length&&a.length-1==e?b[a[e]]=c:"object"!=typeof b[a[e]]&&(b[a[e]]={}),b=b[a[e]];return d}function arrayPath(a,b){for(var c in b)if(a=a[b[c]],"undefined"==typeof a)return;return a}function arraySearch(a,b,c){var d="g",e=[];c&&(d="gi");if(!Is.Array(a)||!Is.String(b))return e;b=new RegExp(b.quoteMeta(),d);for(var f in a)a[f].match&&a[f].match(b)&&e.push(a[f]);return e}
function substract(a){if(2>arguments.length)return a;for(var b,c,d=1;d<arguments.length;d++){b=arguments[d];for(var e in b)-1!=(c=inArray(a,b[e]))&&delete a[c]}return a}function getFreeKey(a){for(var b=0;;b++)if("undefined"==typeof a[b])return b}function arrKeySlice(a,b){var c,d=!1,e=[];b.constructor==Array&&(d=!0);if(!a||!b)return d?e:compact(b);for(var f in b)c=d?b[f]:f,d||a[c]||!b[c]?"undefined"!=typeof a[c]&&(e[c]=a[c]):e[c]=b[c];return e}
function arrUnique(a){return a.filter(function(a,c,d){return d.indexOf(a)===c})}function count(a){return Array.isArray(a)?a.length:null!=a&&"object"==typeof a?Object.keys(a).length:-1}function arrayCompare(a,b){var c=0,d;for(d in a){if(a[d]!=b[d])return!1;c++}return count(b)==c?!0:!1}function buildURL(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+(void 0!==a[c]?"="+encodeURIComponent(a[c].toString()):""));return b.join("&")}
function parseURL(a){var b,c={};Is.Defined(a)||(a=self.location.search);if("string"==typeof a){-1<(b=a.indexOf("#"))&&(a=a.substr(0,b));-1<(b=a.indexOf("?"))&&b<a.indexOf("=")&&(a=a.substr(b+1));a=a.split("&");for(var d=0;d<a.length;d++)if(a[d]){b=a[d].split("=");try{c[decodeURIComponent(b[0])]=b[1]?decodeURIComponent(b[1].toString()):""}catch(e){return{}}}}return c}var IcewarpNumber=function(a,b){this.value=parseInt(a);this.unit=b;this.locale=document.documentElement.lang||"en"};
IcewarpNumber.prototype.localize=function(a){a=a||this.locale;return this.value.toLocaleString(a)};IcewarpNumber.prototype.fileSize=function(a){parseFileSize(this.value)};
function parseFileSize(a){return(a=parseInt(a,10))&&Is.Number(a)?(a=Math.ceilFloat(a/1024,1),1024<a?Math.ceilFloat(a/1024,1).toLocaleString(document.documentElement.lang)+" "+getLang("UNITS::MB"):a.toLocaleString(document.documentElement.lang)+" "+getLang("UNITS::KB")):(0).toLocaleString(document.documentElement.lang)+" "+getLang("UNITS::KB")}_me=cCookieManager.prototype;function cCookieManager(){}
_me.set=function(a,b,c){var d="",e=new Date,f=null;try{window.localStorage&&(f=window.localStorage)}catch(g){}if(f){c={};if(f.cookie)try{c=JSON.parse(f.cookie.toString())}catch(g){gui._REQUEST_VARS.debug&&console.log(this._name||!1,g)}b?c[a]=b:delete c[a];f.cookie=JSON.stringify(c);return!0}if(!Is.Defined(document.cookie))return!1;c&&(0<c?(e.setTime(e.getTime()+864E5*c),d="; expires="+e.toGMTString()):d="; expires=-1");if("string"==typeof b||"number"==typeof b)b=[b];document.cookie=a+"="+buildURL(b)+
d+";";return!0};_me.get=function(a){try{if(window.localStorage)return JSON.parse(window.localStorage.cookie.toString())[a];if(!document.cookie)return}catch(e){return}a+="=";var b="",c=document.cookie.split(";"),d;for(d in c)if(b=c[d].trim(),0==b.indexOf(a)){if(d=b.substring(a.length))return parseURL(b.substring(a.length));break}};var cookieManager=new cCookieManager;
function pushParameterToCallback(a,b){if(Is.Function(a[0]))Is.Array(a[1])?a[1].push(b):a[1]=[b];else if(Is.Object(a[0]))Is.Array(a[2])?a[2].push(b):a[2]=[b];else throw"pushParameterToCallback - Invalid argument";}function getCallbackFunction(a,b){if(a){if(Is.Function(a[0]))return a[0];if(Is.Function(a[1]))return a[1];if(b||!a[0]._destructed)try{return a[0][a[1]]}catch(c){}}return!1}
function executeCallbackFunction(a){if(Is.Array(a)&&(Is.Object(a[0])&&(Is.String(a[1])||Is.Function(a[1]))||Is.Function(a[0])))try{var b;b=Is.Function(a[0])?1:2;for(var c=[],d=1;d<arguments.length;d++)c.push(arguments[d]);Is.Array(a[b])&&(c=c.concat(a[b]));for(d=b+1;d<a.length;d++)c.unshift(a[d]);var e;if(1==b)e=a[0].apply(null,c);else if(Is.Function(a[1]))e=a[1].apply(a[0],c);else if(e=a[0][a[1]].apply(a[0],c),1==a[0]._destructed)return!1;return e}catch(f){b="",b=Is.String(a[0])?"Error while executing "+
a[0]+"()":"Error while executing "+(a[0]&&a[0]._pathName?a[0]._pathName:"oObject")+"."+a[1]+"()",console.warn("browser_ext:executeCallbackFunction",b),console.error(f)}else return!1}function createNameFromLocation(a){if(Is.Object(a)){var b=[];a.ITMFIRSTNAME&&b.push(a.ITMFIRSTNAME);a.ITMMIDDLENAME&&b.push(a.ITMMIDDLENAME);a.ITMSURNAME&&b.push(a.ITMSURNAME);a.ITMSUFFIX&&b.push(a.ITMSUFFIX);return(a.ITMTITLE?a.ITMTITLE+" ":"")+b.join(" ")}return""}
function parseNameToLocation(a,b){a=(a||"").trim();Is.Object(b)?(b.ITMCLASSIFYAS=a,b.ITMTITLE="",b.ITMFIRSTNAME="",b.ITMMIDDLENAME="",b.ITMSURNAME="",b.ITMSUFFIX=""):b={ITMCLASSIFYAS:a};if(!a.length)return b;for(var c,d,e=a.split(" "),f=e.length-1;-1<f;f--)(e[f]=e[f].trim())||e.splice(f,1);if(e.length){var g=getLang("NAME_PREFIX"),h={},l={};for(f in g)g[f]&&(h[g[f].toUpperCase()]=!0);g=getLang("NAME_SUFFIX");for(f in g)g[f]&&(l[g[f].toUpperCase()]=!0);for(;Is.String(e[0]);)if(h[e[0].toUpperCase()])b.ITMTITLE=
(b.ITMTITLE||"")+e.shift();else if(-1<(d=e[0].lastIndexOf(".")))d==e[0].length-1?b.ITMTITLE=(b.ITMTITLE||"")+e.shift():(c=e[0].split("."),e[0]=c.pop(),b.ITMTITLE=(b.ITMTITLE||"")+c.join(".")+".");else break;for(b.ITMFIRSTNAME=e.shift();;)if((c=e[e.length-1])&&(c.toUpperCase()===c||-1<(d=c.indexOf("."))||l[c.toUpperCase()]))-1<d?(c=c.split("."),c[0]&&c[1]?(b.ITMSUFFIX=c[1],e[e.length-1]=c[0]):b.ITMSUFFIX=e.pop()+(b.ITMSUFFIX?" "+b.ITMSUFFIX:"")):b.ITMSUFFIX=e.pop()+(b.ITMSUFFIX?" "+b.ITMSUFFIX:"");
else break;1<e.length&&0>e[0].indexOf(".")&&(b.ITMMIDDLENAME=e.shift());if(c=e.shift()){if(b.ITMSURNAME=c,c=e.join(" "))b.ITMSUFFIX=c+(b.ITMSUFFIX?" "+b.ITMSUFFIX:"")}else b.ITMMIDDLENAME?(b.ITMSURNAME=b.ITMMIDDLENAME,b.ITMMIDDLENAME=""):b.ITMFIRSTNAME&&(b.ITMSURNAME=b.ITMFIRSTNAME,b.ITMFIRSTNAME="")}return b}function getPrimaryAccountFromAddress(a){var b=dataSet.get("accounts",[sPrimaryAccount]);return b.FULLNAME?MailAddress.createEmail(b.FULLNAME,sPrimaryAccount,a):sPrimaryAccount}
function getSubobjects(a,b){b=b||{};for(var c in a)"_"!=c.charAt(0)&&"X_"!=c.substr(0,2)&&"x_"!=c.substr(0,2)&&a[c].constructor&&a[c].constructor===Gui&&("obj_tabs"==a[c]._type||"obj_tab"==a[c]._type?getSubobjects(a[c],b):b[c]=a[c]);return b}function getAuxiliarySubobjects(a,b){b=b||{};for(var c in a)"_"!=c.charAt(0)&&("X_"==c.substr(0,2)||"x_"==c.substr(0,2)?b[c]=a[c]:"obj_tabs"!=a[c]._type&&"obj_tab"!=a[c]._type||getAuxiliarySubobjects(a[c],b));return b}
function loadDataIntoForm(a,b){var c=getSubobjects(a),d;for(d in c)c.hasOwnProperty(d)&&Is.Defined(b[d])&&c[d]._value&&c[d]._value(b[d])}
function loadDataIntoFormOnAccess(a,b,c){var d=getSubobjects(a,d);if(b.USERACCESS||b.DOMAINADMINACCESS)var e=getAuxiliarySubobjects(a);for(var f in d){if(b.ACCESS[f])switch(b.ACCESS[f]){case "full":d[f]._value(b.VALUES[f]);break;case "view":d[f]._value(b.VALUES[f]);d[f]._disabled(!0);break;case "none":d[f]._main.parentNode.style.display="none"}b.DOMAINADMINACCESS&&!c&&e["x_"+f+"_set"]&&(e["x_"+f+"_set"].domadmin._value("view"==b.DOMAINADMINACCESS[f]?!0:!1),"view"==b.ACCESS[f]&&e["x_"+f+"_set"].domadmin._disabled(!0));
b.USERACCESS&&e["x_"+f+"_set"]&&(e["x_"+f+"_set"].user._value("view"==b.USERACCESS[f]?!0:!1),"view"==b.ACCESS[f]&&e["x_"+f+"_set"].user._disabled(!0))}}
function storeDataFromFormWithAccess(a,b,c){var d=getSubobjects(a);a=getAuxiliarySubobjects(a);var e,f;for(f in d)Is.Defined(e=d[f]._value())?b[f]=e:b[f]="",a["x_"+f+"_set"]&&a["x_"+f+"_set"].domadmin&&(c.DOMAINADMINACCESS||(c.DOMAINADMINACCESS={}),c.DOMAINADMINACCESS[f]=a["x_"+f+"_set"].domadmin._value()?"view":"full"),a["x_"+f+"_set"]&&(c.USERACCESS||(c.USERACCESS={}),c.USERACCESS[f]=a["x_"+f+"_set"].user._value()?"view":"full")}
function storeDataFromForm(a,b){var c=getSubobjects(a),d,e;for(e in c)Is.Function(c[e]._value)&&(Is.Defined(d=c[e]._value())?b[e]=d:b[e]="")}function firstIndex(a){if(Is.Object(a))for(var b in a)return b;return null}function firstValue(a){if(Is.Object(a))for(var b in a)return a[b];return null}function shiftObject(a){if(Is.Object(a))for(var b in a){var c=a[b];delete a[b];return c}return null}
function isFormEmpty(a){for(var b in a)if(Is.Object(a[b])){if(!isFormEmpty(a[b]))return!1}else if(""!=a[b])return!1;return!0}function translateFolder(a){switch(a){case "INBOX":return getLang("COMMON_FOLDERS::INBOX");case "__@@VIRTUAL@@__":return getLang("COMMON_FOLDERS::VIRTUAL-FOLDERS");default:return a}}_me=cColors.prototype;function cColors(){this.hexchars="0123456789ABCDEF"}
_me.fast_contrast=function(a,b,c){return 128<(hex2dec(a.substr(1,2))+hex2dec(a.substr(3,2))+hex2dec(a.substr(5,2)))/3?b||"#000000":c||"#FFFFFF"};_me.rgb2hsv=function(a,b,c){a/=255;b/=255;c/=255;var d=Math.max(a,b,c),e=d-Math.min(a,b,c),f,g;if(0==e)g=f=0;else{g=e/d;var h=((d-a)/6+e/2)/e,l=((d-b)/6+e/2)/e,e=((d-c)/6+e/2)/e;a==d?f=e-l:b==d?f=1/3+h-e:c==d&&(f=2/3+l-h);0>f&&(f+=1);1<f&&--f}return[255*f,255*g,255*d]};
_me.hsl2rgb=function(a,b,c){if(0==b)c=b=a=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a},e=.5>c?c*(1+b):c+b-c*b,f=2*c-e;c=d(f,e,a+1/3);b=d(f,e,a);a=d(f,e,a-1/3)}return[Math.round(255*c),Math.round(255*b),Math.round(255*a)]};
_me.rgb2hsl=function(a,b,c){a/=255;b/=255;c/=255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f,g=(d+e)/2;if(d==e)f=e=0;else{var h=d-e,e=.5<g?h/(2-d-e):h/(d+e);switch(d){case a:f=(b-c)/h+(b<c?6:0);break;case b:f=(c-a)/h+2;break;case c:f=(a-b)/h+4}f/=6}return[f,e,g]};_me.isValidRGB=function(a){return!a[0]&&0!=a[0]||isNaN(a[0])||0>a[0]||255<a[0]||!a[1]&&0!=a[1]||isNaN(a[1])||0>a[1]||255<a[1]||!a[2]&&0!=a[2]||isNaN(a[2])||0>a[2]||255<a[2]?!1:!0};
_me.hex2rgb=function(a){a=a.replace("#","");return[16*this.toDec(a.substr(0,1))+this.toDec(a.substr(1,1)),16*this.toDec(a.substr(2,1))+this.toDec(a.substr(3,1)),16*this.toDec(a.substr(4,1))+this.toDec(a.substr(5,1))]};_me.toDec=function(a){return this.hexchars.indexOf(a.toUpperCase())};_me.rgb2hex=function(a,b,c){return this.toHex(a)+this.toHex(b)+this.toHex(c)};
_me.toHex=function(a){a=parseInt(a||0,10);isNaN(a)&&(a=0);a=Math.round(Math.min(Math.max(0,a),255));return this.hexchars.charAt((a-a%16)/16)+this.hexchars.charAt(a%16)};colors=new cColors;function getActualEventTime(){var a=new IcewarpDate,b=a.format(IcewarpDate.JULIAN),a=a.format(IcewarpDate.JULIAN_TIME),a=a-a%30;return{EVNSTARTDATE:b,EVNSTARTTIME:a,EVNENDDATE:b,EVNENDTIME:a+30}}
function arrToString(a){if(null===a)return"null";var b;switch(typeof a){case "string":return"'"+a.replace(/\'/g,"\\'")+"'";case "number":return a;case "object":var c=[],d=!1;if(Is.Array(a)){c.push("[");for(var e=0;e<a.length;e++)!1!==(b=arrToString(a[e]))&&(d&&c.push(","),c.push(b),d=!0);c.push("]")}else{c.push("{");for(e in a)!1!==(b=arrToString(a[e]))&&(d&&c.push(","),c.push("'"+e+"'",":",b),d=!0);c.push("}")}return c.join("");case "undefined":return!1}}
function valuesToString(a){var b="",c;for(c in a)b+=a[c]+"|";return b.substr(0,b.length-1)}
var MailAddress={createEmail:function(a,b,c){var d="";0===b.indexOf("[")&&b.indexOf("]")===b.length-1&&(a="");a&&(c?d=a:(a=a.replace(/([\"\\])/g,"\\$1").trim(),d=/[\s,;@<]/.test(a)?'"'+a+'"':a));b&&(c?d=d?d+(" ("+b.toLowerCase()+")"):b.toLowerCase():(d&&(d+=" "),d+="<"+b.toLowerCase()+">"));return d},appendEmail:function(a,b){if(b){if(!a)return b;var c=MailAddress.splitEmailsAndNames(b),d=MailAddress.splitEmailsAndNames(a);if((c=c[0])&&c.email){for(var e=d.length-1;-1<e;e--)if(d[e].email==c.email)return a;
d.push(c);c=[];for(e=0;e<d.length;e++)!d[e].name&&0===d[e].email.indexOf("[")&&d[e].email.match(/^\[.+\]$/g)?c.push(d[e].email):c.push(MailAddress.createEmail(d[e].name,d[e].email));return c.join(", ")}}return a},splitEmails:function(a){var b=[],c,d="",e=!1,f=!1,g=!1;if(Is.String(a)){for(var h=0;h<a.length;h++){c=a.charAt(h);switch(c){case ",":case ";":if(!e&&!f&&!g){(d=d.trim()).length&&(b.push(d),d="");continue}break;case '"':g||""!=d&&!e||(e=!e);break;case "[":e||g||(f=!0);break;case "]":f&&!g&&
(f=!1);break;case "\\":if(!g){g=!0;d+=c;continue}case " ":if(""==d)continue}d+=c;g=!1}(d=d.trim()).length&&b.push(d)}return b},splitEmailsAndNames:function(a){var b=[];a=MailAddress.splitEmails(a);for(var c={},d=0;d<a.length;d++)if(">"==a[d].charAt(a[d].length-1))for(var e="",f,g=!1,h=!1,l=0,q=a[d].length;l<q;l++){f=a[d].charAt(l);switch(f){case "<":if(!g&&!h){e=e.trim();(f=a[d].substring(l+1,q-1).trim())&&!c[f]&&(c[f]=!0,b.push({name:e,email:f}));f||b.push({name:e,email:f});l=q;continue}break;case '"':if(!h&&
(""==e||g)){g=!g;continue}break;case "\\":if(!h){h=!0;continue}}e+=f;h=!1}else c[a[d]]||(c[a[d]]=!0,b.push({name:"",email:a[d]}));return b},splitNames:function(a){a=MailAddress.splitEmailsAndNames(a);for(var b=[],c=0;c<a.length;c++)b.push(a[c].name||a[c].email);return b.join(", ")},findDistribList:function(a){var b,c,d,e,f,g,h={},l={},q;for(q in a)if(h[q]="",a[q]){b=MailAddress.splitEmails(a[q]);for(var t in b)if(c=b[t],"["==c.charAt(0)&&"]"==c.charAt(c.length-1)){c=c.substr(1,c.length-2);c=c.split("::");
e=d="";f=[];switch(3>=c.length?c.length:3){case 3:d=c.shift();case 2:e=c.shift();case 1:for(var m in c)f.push(c[m]);g=f.join("::")}d||(d=sPrimaryAccount);e||(e="__@@ADDRESSBOOK@@__");l[d]||(l[d]={});l[d][e]||(l[d][e]={to:[],cc:[],bcc:[]});l[d][e][q].push(g)}else h[q]+=c+",";h[q]=h[q].substr(0,h[q].length-1)}h.distrib=l;return h}},base64={encode:function(a){if(window.btoa)return window.btoa(a);var b={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var d=
"",e,f,g,h,l,q,t=0;for(a=b._utf8_encode(a);t<a.length;)e=a.charCodeAt(t++),f=a.charCodeAt(t++),g=a.charCodeAt(t++),h=e>>2,e=(e&3)<<4|f>>4,l=(f&15)<<2|g>>6,q=g&63,isNaN(f)?l=q=64:isNaN(g)&&(q=64),d=d+this._keyStr.charAt(h)+this._keyStr.charAt(e)+this._keyStr.charAt(l)+this._keyStr.charAt(q);return d},decode:function(a){var d="",e,f,g,h,l,q=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");q<a.length;)e=this._keyStr.indexOf(a.charAt(q++)),f=this._keyStr.indexOf(a.charAt(q++)),h=this._keyStr.indexOf(a.charAt(q++)),
l=this._keyStr.indexOf(a.charAt(q++)),e=e<<2|f>>4,f=(f&15)<<4|h>>2,g=(h&3)<<6|l,d+=String.fromCharCode(e),64!=h&&(d+=String.fromCharCode(f)),64!=l&&(d+=String.fromCharCode(g));return d=b._utf8_decode(d)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",e=0;e<a.length;e++){var f=a.charCodeAt(e);128>f?b+=String.fromCharCode(f):(127<f&&2048>f?b+=String.fromCharCode(f>>6|192):(b+=String.fromCharCode(f>>12|224),b+=String.fromCharCode(f>>6&63|128)),b+=String.fromCharCode(f&63|128))}return b},
_utf8_decode:function(a){for(var b="",e=0,f=c1=c2=0;e<a.length;)f=a.charCodeAt(e),128>f?(b+=String.fromCharCode(f),e++):191<f&&224>f?(c2=a.charCodeAt(e+1),b+=String.fromCharCode((f&31)<<6|c2&63),e+=2):(c2=a.charCodeAt(e+1),c3=a.charCodeAt(e+2),b+=String.fromCharCode((f&15)<<12|(c2&63)<<6|c3&63),e+=3);return b}};return b.encode(a)},decode:function(a){if(window.atob)return window.atob(a);var b={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var d="",e,
f,g,h,l,q,t=0;for(a=b._utf8_encode(a);t<a.length;)e=a.charCodeAt(t++),f=a.charCodeAt(t++),g=a.charCodeAt(t++),h=e>>2,e=(e&3)<<4|f>>4,l=(f&15)<<2|g>>6,q=g&63,isNaN(f)?l=q=64:isNaN(g)&&(q=64),d=d+this._keyStr.charAt(h)+this._keyStr.charAt(e)+this._keyStr.charAt(l)+this._keyStr.charAt(q);return d},decode:function(a){var d="",e,f,g,h,l,q=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");q<a.length;)e=this._keyStr.indexOf(a.charAt(q++)),f=this._keyStr.indexOf(a.charAt(q++)),h=this._keyStr.indexOf(a.charAt(q++)),
l=this._keyStr.indexOf(a.charAt(q++)),e=e<<2|f>>4,f=(f&15)<<4|h>>2,g=(h&3)<<6|l,d+=String.fromCharCode(e),64!=h&&(d+=String.fromCharCode(f)),64!=l&&(d+=String.fromCharCode(g));return d=b._utf8_decode(d)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",e=0;e<a.length;e++){var f=a.charCodeAt(e);128>f?b+=String.fromCharCode(f):(127<f&&2048>f?b+=String.fromCharCode(f>>6|192):(b+=String.fromCharCode(f>>12|224),b+=String.fromCharCode(f>>6&63|128)),b+=String.fromCharCode(f&63|128))}return b},
_utf8_decode:function(a){for(var b="",e=0,f=c1=c2=0;e<a.length;)f=a.charCodeAt(e),128>f?(b+=String.fromCharCode(f),e++):191<f&&224>f?(c2=a.charCodeAt(e+1),b+=String.fromCharCode((f&31)<<6|c2&63),e+=2):(c2=a.charCodeAt(e+1),c3=a.charCodeAt(e+2),b+=String.fromCharCode((f&15)<<12|(c2&63)<<6|c3&63),e+=3);return b}};return b.decode(a)}},Path={split:function(a,b){if(Is.String(a)){var c=a.split("/");return b?{aid:c.shift(),fid:c.join("/")}:[c.shift(),c.join("/")]}return b?{aid:"",fid:""}:["",""]},basename:function(a){return Is.String(a)?
a.split("/").pop():!1},basedir:function(a){if(!Is.String(a))return"";a=a.split("/");a.pop();return a.join("/")},extension:function(a){return a&&-1!=a.indexOf(".")?a.split("?")[0].split(".").pop().toLowerCase():""},slash:function(a){return a?a.replace(/\\/g,"/"):""},backslash:function(a){return a?a.replace(/\//g,"\\"):""},build:function(a){return[a.aid||a[0],a.fid||a[1]].join("/")}};function Mapping(){}
Mapping.getDefaultFolderForGWType=function(a){var b="";switch(a){case "C":case "L":b="contacts";break;case "E":b="events";break;case "J":b="journal";break;case "N":b="notes";break;case "T":b="tasks";break;case "F":b="files";break;default:return!1}return Path.split(GWOthers.getItem("DEFAULT_FOLDERS",b))[1]};
Mapping.getFormNameByGWType=function(a){switch(a){case "C":return"frm_contact";case "E":return"frm_event2";case "N":return"frm_note";case "T":return"frm_task";case "J":return"frm_journal";case "L":return"frm_distrib";case "F":return"frm_file";default:throw Error("Not implemented");}};Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())};
Date.prototype.isDstObserved=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};function toString(a){return void 0==a||null==a?"":a.toString()}function makeIDFromIDS(a,b){try{return[a[0],a[1],a[2][b]]}catch(c){}}function makeIDSFromID(a){return[a[0],a[1],[a[2]]]}function getPathFromDataset(a){a=dataSet.get(a);for(var b in a)for(var c in a[b])return[b,c]}
window.currentBrowser=function(){var a="",b="",c=navigator.userAgent.toUpperCase();-1<c.indexOf("CHROME")?(a="Chrome",b=parseInt(c.substr(c.indexOf("CHROME/")+7).split(".")[0],10)):-1<c.indexOf("WEBKIT")||-1<c.indexOf("SAFARI")?(a="Safari",b=parseInt(c.substr(c.indexOf("SAFARI/")+7),10)):-1<c.indexOf("KHTML")?a="KHTML":-1<c.indexOf("OPERA")?a="Opera":-1<c.indexOf("MSIE 9")?a=document.documentMode&&9>document.documentMode?"MSIE7":"MSIE9":-1<c.indexOf("MSIE 10")?a="MSIE9":-1<c.indexOf("MSIE 7")?a="MSIE7":
-1<c.indexOf("MSIE 8")?(a="MSIE7",b=8):-1<c.indexOf("MSIE 6.0")?a="MSIE6":-1<c.indexOf("TRIDENT/")?a="MSIE11":-1<c.indexOf("GECKO")&&(a="Mozilla",b=parseInt(c.substr(c.indexOf("GECKO/")+6),10));return function(c){return c?b:a}}();
currentBrowser.HighDensity=window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&1.3<window.devicePixelRatio;
function IsBrowserPluginInstalled(a){return navigator.mimeTypes&&navigator.mimeTypes[a]&&navigator.mimeTypes[a].enabledPlugin}
window.getCalendarColor=function(){var a={blue:"",green:"",brown:"",purple:"",yellow:"",teal:"",plum:"",red:"",aqua:"",aquamarine:"",orchid:"",pink:"",silver:"",white:"",gray:"",lemon:""};return function(b,c){var d=Cookie.get(["calendar_colors"])||{};if(!b)return d;if(c){var e=d[c]&&d[c]!=b?d[c]:"",f;for(f in d)if(d[f]==b){d[f]="";Cookie.set(["calendar_colors",f]);break}d[c]=b;Cookie.set(["calendar_colors",c],b);e&&getCalendarColor(e);return c}for(c in d)if(d[c]==b)return c;e=dataSet.get("folders",
[sPrimaryAccount,"__@@VIRTUAL@@__/__@@EVENTS@@__","VIRTUAL","FOLDERS"])||{};for(c in a)if(!d[c]||!Is.Defined(e[d[c]]))return d[c]=b,Cookie.set(["calendar_colors",c],b),c}}();function parseParamLine(a){var b,c=[];a.split("\r\n").forEach(function(a,e){if(a)if(0==e){var f=a.toUpperCase().split("&");b=f}else{var f=a.split("&"),g={};b.forEach(function(a,b){a&&Is.String(f[b])&&(g[a]=f[b].urlDecode())});c.push({values:g})}});return c}
var CalendarFormatting={formats:{0:"MM/DD/YY",1:"MM/DD/YYYY",5:"DD-MM-YY",2:"DD-MM-YYYY",6:"DD/MM/YY",3:"DD/MM/YYYY",4:"YYYY-MM-DD",7:"DD.MM.YY",8:"DD.MM.YYYY",9:"DD MMM YY",10:"DD MMM YYYY"},rtl_formats:!1,rtl_langs:["ar","fa","ps","ur","he"],formatRtlTransform:function(){var a;this.rtl_formats={};for(a in this.formats)this.rtl_formats[a]=this.formats[a].split("").reverse().join("");return this.rtl_formats},getFormats:function(){return~this.rtl_langs.indexOf(document.documentElement.lang)?this.rtl_formats?
this.rtl_formats:this.formatRtlTransform():this.formats},getFormat:function(a){return~this.rtl_langs.indexOf(GWOthers.getItem("LAYOUT_SETTINGS","language")||"en")?this.rtl_formats?this.rtl_formats[a]:this.formatRtlTransform()[a]:this.formats[a]},simplified:function(a,b){return a.calendar(null,Object.assign({sameDay:"LT",nextDay:"["+getLang("CALENDAR::TOMORROW")+"] LT",nextWeek:a.getMoment().localeData().longDateFormat("L").replace(/[\/\-\.\s]?[ij]?Y+[\/\-\.\s]?/,"")+" LT",lastDay:"["+getLang("CALENDAR::YESTERDAY")+
"] LT",lastWeek:a.getMoment().localeData().longDateFormat("L").replace(/[\/\-\.\s]?[ij]?Y+[\/\-\.\s]?/,"")+" LT",sameElse:a.isSame(new IcewarpDate,"year")?a.getMoment().localeData().longDateFormat("L").replace(/[\/\-\.\s]?[ij]?Y+[\/\-\.\s]?/,"")+" LT":"L LT"},b||{}))},normal:function(a,b){return a.calendar(null,Object.assign({sameDay:"["+getLang("CALENDAR::TODAY")+"]",nextDay:"["+getLang("CALENDAR::TOMORROW")+"]",nextWeek:"L",lastDay:"["+getLang("CALENDAR::YESTERDAY")+"]",lastWeek:"L",sameElse:"L"},
b||{}))},normalWithTime:function(a,b){return a.calendar(null,Object.assign({sameDay:"["+getLang("CALENDAR::TODAY")+"] LT",nextDay:"["+getLang("CALENDAR::TOMORROW")+"] LT",nextWeek:"L LT",lastDay:"["+getLang("CALENDAR::YESTERDAY")+"] LT",lastWeek:"L LT",sameElse:"L LT"},b||{}))},normalWithWeekDay:function(a,b){var c=7>Math.abs(a.diff(new Date,"days"))?"["+this.weekdayToString(a.day(),a<new Date)+"]":"L";return this.normal(a,Object.assign({sameElse:c,lastWeek:c,nextWeek:c},b||{}))},normalWithWeekDayAndTime:function(a,
b){var c=7>Math.abs(a.diff(new Date,"days"))?"["+this.weekdayToString(a.day(),a<new Date)+"] LT":"L LT";return this.normalWithTime(a,Object.assign({sameElse:c,lastWeek:c,nextWeek:c},b||{}))},formatStartDate:function(a){var b="";0<a.startdate&&(b=-1<a.starttime?IcewarpDate.julian(a.startdate,a.starttime).format("L LT"):IcewarpDate.julian(a.startdate).format("L"));return b},weekdayToString:function(a,b){return"sunday monday tuesday wednesday thursday friday saturday".split(" ").map(function(a){return getLang("DAYS::"+
(b?"LAST_":"")+a.toUpperCase())})[a]}};
window.csstool={st:function(a,b){return a.split(",").map(function(a){a=a.trim();return"body"==a.toLowerCase()?b:b+" "+a}).join(",")},prefix:function(a,b,c){c=c||{};var d=b||document;b=[].slice.call(d.styleSheets);for(var e,f=b.length-1;0<=f;f--)if(e=b[f],(!c.tagOnly||!e.href)&&e.cssRules&&e.ownerNode)if(c.removeIW&&e.ownerNode.hasAttribute("iwstyle"))e.ownerNode.parentNode.removeChild(e.ownerNode);else if(!e.ownerNode.hasAttribute("iwfix")&&!e.ownerNode.hasAttribute("data-fr-style"))if(e.href)[].slice.call(e.cssRules).forEach(function(b,c){if(1===
b.type)try{e.insertRule(csstool.st(b.selectorText,a)+b.cssText.substr(b.selectorText.length),c),e.deleteRule(c+1)}catch(d){console&&console.log("csstool.prefix.link",d)}}),e.setAttribute("iwfix",a);else{var g=mkElement("style",{type:"text/css",iwfix:a},d);[].slice.call(e.cssRules).forEach(function(b,c){try{1===b.type?g.appendChild(d.createTextNode(csstool.st(b.selectorText,a)+b.cssText.substr(b.selectorText.length)+"\r\n")):g.appendChild(d.createTextNode(b.cssText+"\r\n"))}catch(e){console&&console.log("csstool.prefix.style",
e)}});e.ownerNode.parentNode.replaceChild(g,e.ownerNode)}},copy:function(a,b,c){c=c||{};var d=a||document;if(d.styleSheets){b=b||mkElement("style",{type:"text/css"},d);c.useIW&&b.setAttribute("iwstyle","iwstyle");d.body.insertBefore(b,d.body.firstChild||null);try{[].slice.call(d.styleSheets).forEach(function(a){a&&a.cssRules&&a.href&&a.ownerNode&&!c.skipIW&&a.cssRules&&[].slice.call(a.cssRules).forEach(function(a){a.cssText&&b.appendChild(d.createTextNode(a.cssText+"\r\n"))})})}catch(e){console&&
console.log("csstool.copy",e)}}}};function objConcat(a,b){for(var c in b)switch(typeof b[c]){case "object":break;case "function":break;default:a[c]=b[c]}for(c in b.prototype)a.prototype[c]=b.prototype[c];return a}
Function.prototype.inherit=function(a){var b=0,c=this.prototype=new a;this.prototype.__uber=function(d){var e,f;e=b;f=a.prototype;if(e){for(;e;)f=f.constructor.prototype,--e;e=f[d]}else e=c[d],e==this[d]&&(e=f[d]);b+=1;f=e.apply(this,Array.prototype.slice.apply(arguments,[1]));--b;return f};return this};
function inherits(a){for(var b,c,d=1;d<arguments.length;d++){b=arguments[d];for(c in b)switch(typeof b[c]){case "object":break;case "function":break;default:a[c]=b[c]}for(c in b.prototype)a[c]=b.prototype[c]}}
function clone(a,b){if("object"!=typeof a||"undefined"!==typeof IcewarpDate&&a instanceof IcewarpDate)return a;try{var c=new a.constructor}catch(f){c={}}if(c.constructor===Array)for(var d=0,e=a.length;d<e;d++)b&&"object"===typeof a[d]?c.push(clone(a[d],!0)):"undefined"!=typeof a[d]&&c.push(a[d]);else for(d in a)a.hasOwnProperty(d)&&(b&&"object"==typeof a[d]?c[d]=clone(a[d],!0):"undefined"!=typeof a[d]&&(c[d]=a[d]));return c}
function compareObj(a,b,c){a=void 0!==a?c?clone(a,!0):a:void 0;if("undefined"==typeof a)return"undefined"==typeof b;if("undefined"==typeof b||a.constructor!==b.constructor)return!1;if("object"!=typeof a)return a==b;for(var d in b)if(compareObj(a[d],b[d]))delete a[d];else return!1;for(d in a)return!1;return!0}window.roundTo=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c};_me=cTemplate.prototype;function cTemplate(){this.strict=!0}
_me.tmp=function(a,b){return this.exe(storage.template(a),b)};_me.exe=function(a,b){this.sBuffer="";if(this.sTpl=a)return this.aData="object"==typeof b?arrConcat(storage.aStorage.language,b):storage.aStorage.language,this.parser(),this.sBuffer};_me.variable=function(a,b){var c=arrayPath(this.aData,a.split("::"));return Is.Defined(c)?c:b?"{"+a+"}":""};_me.anchor=function(a){return(this.aData._ins||"")+"#"+a};
_me.parser=function(){for(var a,b,c,d;!(0>(a=this.sTpl.indexOf("{")));)if(this.sBuffer+=this.sTpl.substring(0,a),this.sTpl=this.sTpl.substring(a),1==(a=this.sTpl.indexOf("}")))this.sTpl=this.sTpl.substring(2);else switch(c=this.sTpl.substring(1,a),-1<(b=c.indexOf(" "))?(d=c.substring(b+1),c=c.substring(0,b)):d=null,this.sTpl=this.sTpl.substring(a+1),c){case "include":this.include(d);break;case "noptional":this.option(d,1);break;case "optional":this.option(d);break;case "dynamic":this.loop(d);break;
case "rdynamic":this.option(d,1);break;case "htmlspecialchars":this.sBuffer+=this.variable(d,this.strict).toString().escapeHTML();break;case "htmlspecialchars-double-quote":this.sBuffer+=this.variable(d,this.strict).toString().escapeHTML().replace(/"/g,"&quot;");break;case "anchor":d&&(this.sBuffer+=this.anchor(d));break;case "lang":c=this.variable(d);default:this.sBuffer+=this.variable(c,this.strict)}this.sBuffer+=this.sTpl};
_me.option=function(a,b){var c=!1,d=this.part((b?"n":"")+"optional");if(-1<a.indexOf(" ")){var e=a.split(" "),f;for(f in e)if(this.variable(e[f])){c=!0;break}}else this.variable(a)&&(c=!0);if(!c&&!b||c&&b)this.sTpl=this.sTpl.substr(d)};
_me.include=function(a){var b=this.part("include");if(a){var c=this.sTpl.substr(0,b),d=new cTemplate,e;try{c.length&&(e=JSON.parse(c))}catch(f){console.log("template.include","JSON error")}this.sTpl=d.tmp(a,e)+this.sTpl.substr(b)}else console.log("template.include","missing template"),this.sTpl=this.sTpl.substr(b)};
_me.loop=function(a,b){var c=this.part((b?"r":"")+"dynamic"),d=this.variable(a);if("object"!=typeof d)this.sTpl=this.sTpl.substr(c);else{b&&(d=reverse(d));var e=this.sTpl.substr(0,c),f="",g="",h=new RegExp("{"+a+"::\\*","g"),l=new RegExp("[ ]"+a+"::\\*","g"),q=new RegExp("::"+a+"::\\*","g"),t;for(t in d)g=e,-1<g.indexOf("{"+a+"::*")&&(g=g.replace(h,"{"+a+"::"+t)),-1<g.indexOf(" "+a+"::*")&&(g=g.replace(l," "+a+"::"+t)),-1<g.indexOf("::"+a+"::*")&&(g=g.replace(q,"::"+a+"::"+t)),f+=g;this.sTpl=f+this.sTpl.substr(c)}};
_me.part=function(a){var b="{"+a;a="{/"+a+"}";var c,d,e=0;for(d=0;!(0>(c=this.sTpl.indexOf(a,d)));)if(d=this.sTpl.indexOf(b,d),-1<d&&d<c)e++,d=this.sTpl.indexOf("}",d+1);else if(0<e)e--,d=c+a.length;else return this.sTpl=this.sTpl.substr(0,c)+this.sTpl.substr(c+a.length),c};template=new cTemplate;function cXMLTools(){this.noparse={"http://www.w3.org/1999/xhtml":!0}}
cXMLTools.prototype.XMLDoc=function(){try{if(window.ActiveXObject){if(this.prefix)return new ActiveXObject(this.prefix);for(var a,b=["Msxml2.DOMDocument.3.0","MSXML.DomDocument"],c=0;c<b.length;c++)try{a=new ActiveXObject(b[c]);this.prefix=b[c];break}catch(d){}if(this.prefix)return a;throw Error("cXMLTools.XMLDoc() - Could not find an installed XML parser");}if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument("","",null);throw!0;}catch(d){throw Error("Your browser does not support XmlDocument objects");
}};
cXMLTools.prototype.XML2Arr=function(a,b){for(var c={},d,e=0;;e++){if(0==e)var f=a.firstChild;else if(f.nextSibling)f=f.nextSibling;else{if(!b&&(!c||c.PARSERERROR&&c.PARSERERROR[0]))throw"XML parsing error: "+c.PARSERERROR[0].VALUE;return c}if(e||f.tagName){var g=f.tagName.toUpperCase();c[g]?(c[g].push({}),d=c[g].length-1):(d=0,c[g]=[{}]);var h=f.getAttribute("xmlns");if(h&&this.noparse[h])h=this.XML2Str(f),h=h.substring(h.indexOf(">")+1,h.lastIndexOf("<")),c[g][d].VALUE=h;else if(f.hasChildNodes())if(f.firstChild.nodeValue)for(h=f.firstChild,
c[g][d].VALUE=h.nodeValue;;)if(h=h.nextSibling)h.nodeValue&&(c[g][d].VALUE+=h.nodeValue);else break;else c[g][d]=this.XML2Arr(f,!0);if(f.attributes.length)for(c[g][d].ATTRIBUTES={},e=0;e<f.attributes.length;e++)c[g][d].ATTRIBUTES[f.attributes.item(e).nodeName.toUpperCase()]=f.attributes.item(e).nodeValue}}};
cXMLTools.prototype.Arr2XML=function(a,b,c){a=b?a:clone(a,!0);var d="Safari"==currentBrowser()&&526>currentBrowser(!0),e;b||(this.xDoc=null,this.xDoc=this.XMLDoc());for(var f in a)for(var g in a[f]){!d&&a[f][g].ATTRIBUTES&&(a[f][g].ATTRIBUTES.XMLNS||a[f][g].ATTRIBUTES.xmlns)&&this.xDoc.createElementNS?(e=this.xDoc.createElementNS(a[f][g].ATTRIBUTES.XMLNS||a[f][g].ATTRIBUTES.xmlns,c?f:f.toLowerCase()),delete a[f][g].ATTRIBUTES.XMLNS,delete a[f][g].ATTRIBUTES.xmlns):e=b&&b.namespaceURI&&this.xDoc.createElementNS?
this.xDoc.createElementNS(b.namespaceURI,c?f:f.toLowerCase()):this.xDoc.createElement(c?f:f.toLowerCase());if("object"==typeof a[f][g].ATTRIBUTES&&a[f][g].ATTRIBUTES.constructor!=Array){for(var h in a[f][g].ATTRIBUTES)e.setAttribute(c?h:h.toLowerCase(),a[f][g].ATTRIBUTES[h]);delete a[f][g].ATTRIBUTES}"undefined"!=typeof a[f][g].VALUE&&"object"!=typeof a[f][g].VALUE?"string"==typeof a[f][g].VALUE&&d?e.appendChild(this.xDoc.createTextNode(a[f][g].VALUE.escapeHTML())):e.appendChild(this.xDoc.createTextNode(a[f][g].VALUE)):
this.Arr2XML(a[f][g],e,c);if(b)b.appendChild(e);else{if("Opera"==currentBrowser())return e;this.xDoc.appendChild(e);return this.xDoc}}};
cXMLTools.prototype.Str2XML=function(a){if(DOMParser){var b=(new DOMParser).parseFromString(a,"text/xml");this.stripWhiteSpace(b);return b}b=null;try{return b=this.XMLDoc(),b.async=!1,b.validateOnParse=!1,b.loadXML(a),b.parseError.errorCode&&console.log("Error code: "+b.parseError.errorCode+"\nLine: "+b.parseError.line+":"+b.parseError.linePos+"\nReason: "+b.parseError.reason+"\n"+b.parseError.srcText),b}catch(c){}};cXMLTools.prototype.XML2Str=function(a){try{return a.xml?a.xml:(new XMLSerializer).serializeToString(a)}catch(b){return""}};
cXMLTools.prototype.Str2Arr=function(a){try{return this.XML2Arr(this.Str2XML(a))}catch(b){return console.warn("Str2Arr",b,a),[]}};cXMLTools.prototype.Arr2Str=function(a,b){try{return this.XML2Str(this.Arr2XML(a,null,b))}catch(c){console&&console.log("Arr2Str",c)}};cXMLTools.prototype.stripWhiteSpace=function(a){nodesToDelete=[];this.findWhiteSpace(a,0);for(var b=nodesToDelete.length;b--;)nodeRef=nodesToDelete[b],nodeRef.parentNode.removeChild(nodeRef);return a};cXMLTools.prototype.is_ws=function(a){return!/[^\t\n\r ]/.test(a.data)};
cXMLTools.prototype.findWhiteSpace=function(a,b){for(var c=a.childNodes.length;c--;)void 0!==a.childNodes[c].splitText&&this.is_ws(a.childNodes[c])&&(nodesToDelete[nodesToDelete.length]=a.childNodes[c]),a.childNodes[c].hasChildNodes()&&this.findWhiteSpace(a.childNodes[c],c)};var XMLTools=new cXMLTools;XMLHttpRequest.prototype.getString=function(){return this.status&&200==this.status?this.responseText:""};
XMLHttpRequest.prototype.getXML=function(){try{return XMLTools.stripWhiteSpace(this.responseXML)}catch(a){throw"XMLHttpRequest.getXML \n"+this.getString();}};
XMLHttpRequest.prototype.getArray=function(){try{var a=this.getResponseHeader("Content-Type").split(";")[0];switch(a){case "text/json":return JSON.parse(this.getString());case "text/xml":case "application/xml":return XMLTools.XML2Arr(this.getXML());case null:case "null":return{};default:throw'unsupported content-type "'+a+'"';}}catch(b){throw"XMLHttpRequest.getArray \n"+("string"==typeof b?b+"\n":"")+this.getString();}};function cRequest(a){this.sURL=a;this.iRetry=15}
cRequest.prototype._send=function(a,b,c,d,e){e=e||this.sURL;var f=c?!0:!1,g=this;if(!e)throw"cRequest No Target URL";if(gui&&!gui.__online)return f&&gui.connection?gui.connection._queue(0,this.iRetry,[this,"_send",[a,b,c,d,e]],d):this.error({type:"response",text:"Offline",status:0,url:e}),!1;try{var h=new XMLHttpRequest}catch(l){throw"cRequest Your browser does not support XMLHttpRequest object";}h.open(a?"POST":"GET",e,f);a&&h.setRequestHeader("Content-Type",b||"text/xml");if(f&&(h.onabort=function(f){if(g.onfinish)g.onfinish(this);
try{0!==f.target.status||g.onreconnect&&!g.onreconnect(f)||g._send(a,b,c,d,e)}catch(h){g.error({type:"system",text:"abort, unable to send"})}},h.onerror=function(f){if(g.onfinish)g.onfinish(this);try{0!=f.target.status||d&&executeCallbackFunction(d,this,[a,b,c,d,e])||g.onerror&&g.onerror(this,[a,b,c,d,e])||(gui&&gui.connection?gui.connection._queue(0,g.iRetry,[g,"_send",[a,b,c,d,e]],d):g.error({stype:"response",text:"Offline",status:0,url:e}))}catch(h){g.error({type:"system",status:f.target.status,
text:"error, can not add to the buffer"})}},h.onreadystatechange=function(){if(4==this.readyState){if(0!=this.status&&g.onfinish)g.onfinish(this);if(200!=this.status&&304!=this.status||null==this.getResponseHeader("Content-Type"))switch(this.status){case 0:break;case 409:case 410:if((!d||!executeCallbackFunction(d,this,[a,b,c,d,e]))&&g.onerror)g.onerror(this,[a,b,c,d,e]);break;case 404:case 500:gui.connection?gui.connection._queue(this.status,0,null,d):g.error({stype:"response",text:"Server Error",
status:this.status,url:e});break;default:var f=g.iRetry;if(d&&executeCallbackFunction(d,this,[a,b,c,d,e])||g.onerror&&g.onerror(this,[a,b,c,d,e]))break;case 503:f=parseInt(this.getResponseHeader("Retry-After"),10)||f,gui.connection?gui.connection._queue(this.status,f,[g,"_send",[a,b,c,d,e]],d):g.error({stype:"response",text:"Server Error",status:this.status,url:e})}else{try{switch(f={},c[3]){case "XML":f={XML:this.getXML()};break;case "Text":f={Text:this.getString()};break;default:f={Array:this.getArray()}}}catch(h){throw"Response parse error: \n"+
this.getString();}executeCallbackFunction(c,f);if(g.onsuccess)g.onsuccess(f)}}},g.onstart))g.onstart(h);h.send(a||null);return f||200==h.status||304==h.status?h:(g.error({type:"response",status:h.status}),!1)};cRequest.prototype.error=function(a){console&&console.dir&&console.dir(a)};cRequest.prototype.sendArray=function(a,b,c,d,e){return this._send(XMLTools.Arr2XML(a,"",e),"text/xml",b,c,d)};
cRequest.prototype.sendJSON=function(a,b,c,d){return this._send(JSON.stringify(a),"application/json",b,c,d)};cRequest.prototype.sendString=function(a,b,c,d){return this._send(a,"text/plain",b,c,d)};cRequest.prototype.get=function(a,b,c){return this._send(null,"",b,c,a)};cRequest.timer=new Date;cRequest.lapse=0;cRequest.interval=setInterval(function(){cRequest.lapse=(new Date-cRequest.timer)/1E3;cRequest.timer=new Date},15E3);
function cDataSet(){this.aDataSets={};this.aListeners={};this.listeners={}}cDataSet.prototype.add=function(a,b,c,d,e){var f=!1;d||compareObj(this.get(a,b),c,!0)||(f=!0);Is.Array(b)?this.aDataSets[a]=mkArrayPath(b,this.aDataSets[a],c):this.aDataSets[a]=c;if(f)this.update(a,b,e);else if(!d)return!1;return!0};
cDataSet.prototype.remove=function(a,b,c,d){if("undefined"!=typeof this.aDataSets[a]){if(!b)delete this.aDataSets[a];else if(Is.Array(b))try{if("undefined"==typeof arrayPath(this.aDataSets[a],b))return;var e=this.aDataSets,f=a;b.forEach(function(a){e=e[f];f=a});delete e[f]}catch(g){return!1}c||this.update(a,b,d);return!0}};cDataSet.prototype.get=function(a,b,c){if(a)if(a=this.aDataSets[a],Is.Array(b)){if(a)return a=arrayPath(a,b),c&&a?clone(a,1):a}else return c?clone(a,1):a};
cDataSet.prototype.obey=function(a,b,c,d){if("object"!=typeof a||!c)return!1;a[b||"_listener"]=c;this.aListeners[c]||(this.aListeners[c]=[]);this.aListeners[c].push(a);"undefined"==typeof this.aDataSets[c]||d||a.__update(c);return!0};cDataSet.prototype.disobey=function(a,b){b=b||"_listener";if("object"!=typeof a||!a[b]||!this.aListeners[a[b]])return!1;for(var c=this.aListeners[a[b]].length;c--;)this.aListeners[a[b]][c]===a&&this.aListeners[a[b]].splice(c,1);return!0};
cDataSet.prototype.update=function(a,b,c){this.trigger(a,b);if(a&&this.aListeners[a])for(var d in this.aListeners[a])try{if(c)if("string"==typeof c){if(this.aListeners[a][d]._pathName==c)continue}else if("object"==typeof c&&this.aListeners[a][d]._pathName==c._pathName)continue;this.aListeners[a][d].__update(a,b)}catch(e){gui._REQUEST_VARS.debug&&console.log(this._name||!1,e)}};
cDataSet.prototype.trigger=function(a,b){try{b=[].slice.apply(b||[]);var c=b.length;do{var d=[a].concat(b);this.listeners[d]&&this.listeners[d].forEach(function(d){(d.all||b.length===c)&&d.fn.call(d.context||this,this.get(a,b),a,b)},this);b.pop()}while(1<d.length)}catch(e){gui._REQUEST_VARS.debug&&console.log(this._name||!1,e)}};
cDataSet.prototype.on=function(a,b,c,d,e,f){var g=[a].concat(b||[]);!this.listeners[g]&&(this.listeners[g]=[]);this.listeners[g].push({fn:c,context:d,all:f});e&&c.call(d||this,this.get(a,b),a,b);return this};cDataSet.prototype.once=function(a,b,c,d){var e=[a].concat(b||[]);!this.listeners[e]&&(this.listeners[e]=[]);var f=this.listeners[e].push({fn:function(){this.listeners[e].splice(f,1);c.call(d||this)},context:this})-1;return this};
cDataSet.prototype.off=function(a,b,c){a=[a].concat(b||[]);if(this.listeners[a]&&this.listeners[a].length)for(b=0;b<this.listeners[a].length;b++)if(this.listeners[a][b].fn===c){this.listeners[a].splice(b,1);break}return this};dataSet=new cDataSet;
function cStorage(){this.aStorage={css:{},library:{},language:{},template:{},object:{}};this.aStorage.library={"client/inc/debug":"enabled","client/inc/object_ext":"enabled","client/inc/browser_ext":"enabled","client/inc/template":"enabled","client/inc/xmltools":"enabled","client/inc/request":"enabled","client/inc/dataset":"enabled","client/inc/storage":"enabled","client/inc/gui":"enabled","client/inc/wm_generic":"enabled","client/inc/wm_auth":"enabled","client/inc/wm_accounts":"enabled","client/inc/wm_folders":"enabled",
"client/inc/wm_items":"enabled","client/inc/wm_settings":"enabled","client/inc/wm_storage":"enabled","client/inc/init":"enabled","client/inc/gw_others":"enabled","client/inc/json":"enabled","client/inc/obj_loader":"enabled","client/inc/obj_form_generic":"enabled","client/inc/obj_form_tab":"enabled","client/inc/obj_button":"enabled","client/inc/obj_connection":"enabled"}}
cStorage.prototype.css=function(a,b,c){if(!b){if(this.aStorage.css.style)return!0;if(this.aStorage.css[a])return"disabled"==this.aStorage.css[a]&&(document.getElementById("css_"+a).disabled=!1,this.aStorage.css[a]=2),c&&c(),!0}this.aStorage.css[a]=1;var d=this,e={id:"css_"+a,rel:"stylesheet",type:"text/css",onload:function(){d.aStorage.css[a]&&(d.aStorage.css[a]=2);c&&c()}},f=GWOthers.getItem("LAYOUT_SETTINGS","skin"),g=GWOthers.getItem("LAYOUT_SETTINGS","skin_style");g&&storage&&storage.aStorage.language&&
storage.aStorage.language.SKIN_STYLE&&!storage.aStorage.language.SKIN_STYLE[g.toUpperCase()]&&(g="default");e.href="font"==a?"client/skins/"+f+"/css/font.css":"style"==a?"client/skins/"+f+"/css/style."+g+".css":"client/skins/"+f+"/css/css.php?"+buildURL({skin:f,palette:g,file:a+".css"});if(b)return b=document.getElementById("css_"+a),e.onload=c,document.head.appendChild(mkElement("link",e)),b&&document.head.removeChild(b),!0;if("default"!=f||"default"!=g){var h="",h="font"==a?"client/skins/default/css/font.css":
"style"==a?"client/skins/default/css/style.default.css":"client/skins/default/css/css.php?"+buildURL({skin:"default",palette:"default",file:a+".css"});e.onerror=function(a){this.href=h}}document.head.appendChild(mkElement("link",e));return!0};cStorage.prototype.css_status=function(a){switch(this.aStorage.css.style||this.aStorage.css[a]){case "disabled":return"disabled";case 1:return"loading";case 2:return"loaded";default:return!1}};
cStorage.prototype.remove_css=function(a){return this.aStorage.css[a]?("disabled"!=this.aStorage.css[a]&&(document.getElementById("css_"+a).disabled=!0,this.aStorage.css[a]="disabled"),!0):!1};cStorage.prototype.remove_all_css=function(){var a,b;for(b in this.aStorage.css){if(a=document.getElementById("css_"+b))a.disabled=!0,a.parentNode.removeChild(a);delete this.aStorage.css[b]}};
cStorage.prototype.library=function(a,b,c,d){var e;switch(b||""){case "":if("enabled"==this.aStorage.library["client/inc/javascript"])return!0;e="client/inc/"+a;break;case "libs":e="libs/"+a;break;case "skin":e="client/skins/"+GWOthers.getItem("LAYOUT_SETTINGS","skin")+"/inc/"+a;break;default:/^[\w//-]+$/gi.test(b)&&(e="client/inc/"+b+"/"+a)}if("enabled"==this.aStorage.library[e])return!0;if(c)this.aStorage.library[e]||(this.aStorage.library[e]="loading",request.get(e+".js",[this,"preloadLib",[e,
d],"Text"]));else if(a=request.get(e+".js"))if(a=a.getString())pubEval(a),this.aStorage.library[e]="enabled";else return!1;return!0};cStorage.prototype.preloadLib=function(a,b,c,d){b&&b.Text&&("enabled"!=this.aStorage.library[c]&&(pubEval(b.Text),this.aStorage.library[c]="enabled"),d&&executeCallbackFunction(d))};cStorage.prototype.preloadObj=function(){var a=request.get("client/objects/objects.xml");if(a){var a=a.getArray(),b;for(b in a.OBJECTS[0])this.object(b.toLowerCase(),a.OBJECTS[0][b][0])}};
cStorage.prototype.preloadTpl=function(a,b){if(a&&b)if("templates"==b){if(a.Array&&a.Array.TEMPLATE&&a.Array.TEMPLATE[0])for(var c in a.Array.TEMPLATE[0])this.aStorage.template[c.toLowerCase()]=a.Array.TEMPLATE[0][c][0].VALUE||""}else this.aStorage.template[b]=a.Text||""};
cStorage.prototype.language=function(a){a=a||"en";if("undefined"!=typeof this.aStorage.language._ACTIVE_LANG&&this.aStorage.language._ACTIVE_LANG==a)return a;var b;try{b=request.get("client/languages/"+a+"/data.xml").getArray()}catch(f){b=null}if("en"!=a&&!Is.Object(b))try{a="en",b=request.get("client/languages/"+a+"/data.xml").getArray()}catch(f){b=null}if(!Is.Object(b))throw Error("cStorage.language() - bad language file syntax: "+a);this.aStorage.language={_ACTIVE_LANG:a};b=b.LANGUAGE[0];var c,
d,e;for(c in b)for(d in this.aStorage.language[c]={},b[c][0])"VALUE"!=d&&(e=1<b[c][0][d].length?b[c][0][d]:b[c][0][d][0].VALUE,this.aStorage.language[c][d]=Is.Defined(e)?e:"");return a};
cStorage.prototype.template=function(a,b){if("undefined"!=typeof this.aStorage.template[a])return this.aStorage.template[a];var c=GWOthers.getItem("LAYOUT_SETTINGS","skin"),d;if(b)return request.get("client/skins/"+c+"/templates/"+a+("templates"==a?".xml":".tpl"),[this,"preloadTpl",[a],"templates"==a?"Array":"Text"]),!0;if("templates"==a){if(d=request.get("client/skins/"+c+"/templates/templates.xml"))return this.preloadTpl({Array:d.getArray()},"templates"),!0}else if(d=request.get("client/skins/"+
c+"/templates/"+a+".tpl"))return this.aStorage.template[a]=d.getString();throw Error("cStorage.template() - blank template file: "+c+"/"+a);};
cStorage.prototype.object=function(a,b){if("undefined"!=typeof this.aStorage.object[a])return this.aStorage.object[a];try{b||(b=request.get("client/objects/"+a+".xml").getArray()),b.OBJECT&&(b=b.OBJECT[0])}catch(d){throw"cStorage.object() - blank xml: "+a;}if(b.CSS)for(var c in b.CSS)this.css(b.CSS[c].VALUE);if(b.BEFORE)for(c in b.BEFORE)b.BEFORE[c].ATTRIBUTES&&b.BEFORE[c].ATTRIBUTES.PATH?this.library(b.BEFORE[c].VALUE,b.BEFORE[c].ATTRIBUTES.PATH):this.library(b.BEFORE[c].VALUE);if(b.LIBRARY)for(c in b.LIBRARY)b.LIBRARY[c].ATTRIBUTES&&
b.LIBRARY[c].ATTRIBUTES.PATH?this.library(b.LIBRARY[c].VALUE,b.LIBRARY[c].ATTRIBUTES.PATH):this.library(b.LIBRARY[c].VALUE);return this.aStorage.object[a]=b};storage=new cStorage;
window.getLang=function(){var a=/\%[sS0-9]/g;return function(b,c,d){if("string"!=typeof b||!b)return"";var e="",f=b.toUpperCase().split("::");try{e="undefined"==typeof f[1]?storage.aStorage.language[f[0]]:storage.aStorage.language[f[0]][f[1]];if("string"==typeof e){if(c&&e.length)var g=0,e=e.replace(a,function(a){return"%s"==a.toLowerCase()?c[g++]:c[+a.substr(1)]});return e}if("object"==typeof e)return e}catch(h){gui._REQUEST_VARS.debug&&console.log(this._name||!1,h)}return 2==d?"":d?b:"{"+b+"}"}}();
function Gui(a,b,c){this._name=a;this._type=b||"document";this._pathName=(this._parent=c)&&this._parent._pathName?this._parent._pathName+"."+a:a;this._destructed=!1;this._anchors={main:""};this._template="";this._destructors={};this._events={};this._listener;this._listenerPath;this._saverPath=this._saver=null;this._updateBuffer=this._norefresh=this._noupdate=this._skipsaving=!1;b||c||Gui.__root.call(this)}
Gui.prototype._create=function(a,b,c,d){if(this._destructed||this._main&&!this._main.parentNode)return!1;var e,f=storage.object(b);if(f.PARENTS){e=!0;for(var g in f.PARENTS[0].OBJ)if(this._type==f.PARENTS[0].OBJ[g].VALUE){e=!1;break}if(e)throw Error("gui._create() -  OBJ "+b+"\n disallowed parent "+this._type);}if(f.UNIQUE){if("undefined"!=typeof this[a]){if("keep"==f.UNIQUE[0].VALUE)return this[a];this[a]._destruct()}}else{e="";for(g=0;;g++){if(void 0===this[a+e]){a+=e;break}e="_"+g}e=null}e=Is.Object(c)?
c.target||"main":Is.Defined(c)&&(c=c.toString()).length?c:"main";this[a]=new Gui(a,b,this);if(f.ANCHORS&&"undefined"!=typeof f.ANCHORS[0].ELM){var h="",l={};for(g in f.ANCHORS[0].ELM)if(h=f.ANCHORS[0].ELM[g].VALUE)l[h]=this._pathName+"."+a+"#"+h;this[a]._anchors=l}this[a]._anchor=e;h=!1;switch(f.TYPE?f.TYPE[0].VALUE:""){case "none":break;case "inline":h=mkElement("span");break;case "tr":h=mkElement("tr");break;case "td":h=mkElement("td");break;case "form":h=mkElement("form");h.onsubmit=function(){return!1};
h.name=this[a]._pathName;break;default:h=mkElement("div")}if(h){if(!(l=this._getAnchor(e)))throw'Anchor "'+e+'" doesn\'t exists in "'+this._type+'" object';h.setAttribute("id",this[a]._pathName);Is.Object(c)&&c.first&&l.firstChild?l.insertBefore(h,l.firstChild):l.appendChild(h);this[a]._css=d;this[a]._allcss=h.className=(f.ATTRIBUTES&&f.ATTRIBUTES.CSS?f.ATTRIBUTES.CSS+" ":"")+b+(d?" "+d:"");this[a]._main=h;h=l=null}h=[].slice.call(arguments).splice(4);if(f.BEFORE)for(g in f.BEFORE){if(this[a]&&this[a]._destructed)return;
l=f.BEFORE[g].ATTRIBUTES&&f.BEFORE[g].ATTRIBUTES.CLASS?f.BEFORE[g].ATTRIBUTES.CLASS:f.BEFORE[g].VALUE;if("function"==typeof window[l]&&(inherits(this[a],window[l]),window[l].prototype.__constructor&&!1===this[a].__constructor.apply(this[a],h)))return this[a]._destruct(),!1}f.TEMPLATE&&"undefined"!=typeof f.TEMPLATE[0].VALUE&&(this[a]._template=f.TEMPLATE[0].VALUE,Is.Defined(this._parent)&&Is.Defined(this._parent._aTemplateData)?this[a]._draw(null,null,this._parent._aTemplateData):Is.Defined(this._aTemplateData)?
this[a]._draw(null,null,this._aTemplateData):this[a]._draw());if(f.ONUNLOAD)for(g in f.ONUNLOAD)this[a]._add_destructor(f.ONUNLOAD[g].VALUE,f.ONUNLOAD[g].ATTRIBUTES);if(f.LIBRARY){l="";g=0;for(var q=f.LIBRARY.length;g<q;g++){if(this[a]&&this[a]._destructed)return;l=f.LIBRARY[g].VALUE;if(f.LIBRARY[g].ATTRIBUTES){if(f.LIBRARY[g].ATTRIBUTES.INCLUDE)continue;f.LIBRARY[g].ATTRIBUTES.CLASS&&(l=f.LIBRARY[g].ATTRIBUTES.CLASS)}"function"==typeof window[l]&&(inherits(this[a],window[l]),window[l].prototype.__constructor&&
this[a].__constructor.apply(this[a],h))}}this[a]&&this[a]._finished&&this[a]._finished();this.__onCreateChild&&this.__onCreateChild(a,b,e,d);return this[a]};
Gui.prototype._draw=function(a,b,c,d){c&&"object"===typeof c?c._ins=this._pathName:c={_ins:this._pathName};GWOthers&&(c._skin="client/skins/"+GWOthers.getItem("LAYOUT_SETTINGS","skin"));var e=template.tmp(a?a:this._template,c)||"",f,g=[];f=[];var h,l=mkElement("div",{innerHTML:e});if(-1<e.indexOf("<obj ")){if(e=l.getElementsByTagName("obj"),e.length){for(var q=function(a){var b,c=a.getElementsByTagName("item"),d=[],e={};if(!c.length)return a.textContent||("string"==typeof a.text?a.text.unescapeHTML():
null);a=0;for(var f=c.length;a<f;a++)(b=c[a].getAttribute("key"))?e[b]=q(c[a]):d.push(q(c[a]));return Is.Empty(e)?d:e},t,m,p,u,r=[],v=0,x=e.length;v<x;v++)if(t=e[v].parentNode,p=e[v].getAttribute("type"),(u=e[v].getAttribute("name"))&&p){if("OBJ"===t.tagName)h=e[v].getAttribute("anchor")||"main";else if(f=t.getAttribute("id")){if(h=inArray(this._anchors,f),-1==h){do h=Math.rand();while(this._anchors[h]);this._anchors[h]=f}}else{do h=Math.rand();while(this._anchors[h]);this._anchors[h]=(this._pathName||
"")+"#"+h;t.setAttribute("id",this._anchors[h])}f={type:p,name:u,anchor:h};p=e[v].attributes;for(u=p.length;u--;)void 0===f[p[u].name]&&(f[p[u].name]=p[u].value);for(u=e[v].childNodes.length;u--;)if(m=e[v].childNodes[u],p=m.tagName?m.tagName.toLowerCase():!1)switch(p){case "readonly":case "disabled":m=m.textContent;!m||"false"==m&&"0"==m||(f[p]=!0);break;case "draw":f.draw=[m.getAttribute("form"),m.getAttribute("anchor")||"main",q(m)];break;case "restrictions":case "init":case "fill":case "value":case "src":case "title":case "text":case "placeholder":f[p]=
q(m)}m=null;if("obj"==t.tagName.toLowerCase()){for(p=e.length;p--&&e[p]!==t;);r[p].objects?r[p].objects.push(f):r[p].objects=[f]}else g.push(f);r.push(f);f=null}r=null;for(t=e.length;t--;)e[t].parentNode.removeChild(e[t]);t=null}}else h=b;if(a=a&&h?this._getAnchor(b):this._main)if(2===d)for(d=a.firstChild||null;l.firstChild;)a.insertBefore(l.firstChild,d);else{if(!d)for(;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}l=a=null;delete c._ins;Is.Empty(c)?this.__addObjects(g):
this.__addObjects(g,null,c);this.__onCreateChild&&this.__onCreateChild("","",b)};
Gui.prototype.__addObjects=function(a,b,c){var d;b=b||this;c&&(this._aTemplateData=c);for(var e=0,f=a.length;e<f;e++){d=[a[e].name,a[e].type,a[e].anchor,a[e].css];if(a[e].init)if("object"==typeof a[e].init)for(var g in a[e].init)d.push(a[e].init[g]);else d.push(a[e].init);this._aTemplateData&&b&&(b._aTemplateData=c);d=b._create.apply(b,d);a[e].title&&Is.Function(d._title)&&d._title(a[e].title);a[e].text&&Is.Function(d._text)&&d._text(a[e].text);a[e].fill&&Is.Function(d._fill)&&d._fill(a[e].fill);
a[e].value&&Is.Function(d._value)&&d._value(a[e].value);a[e].src&&Is.Function(d._src)&&d._src(a[e].src);a[e].readonly&&Is.Function(d._readonly)&&d._readonly(a[e].readonly);a[e].disabled&&Is.Function(d._disabled)&&d._disabled(a[e].disabled);a[e].placeholder&&Is.Function(d._placeholder)&&d._placeholder(a[e].placeholder);a[e].tabindex&&Is.Function(d._tabIndex)&&d._tabIndex(a[e].tabcontainer,"true"==a[e].tabindex?void 0:parseInt(a[e].tabindex,10));a[e].focus&&Is.Function(d._focus)&&d._focus(a[e].focus);
(a[e].width||a[e].height)&&Is.Function(d._size)&&d._size(a[e].width,a[e].height);if(a[e].restrictions&&Is.Function(d._restrict)){var h=[];if("object"==typeof a[e].restrictions)for(g in a[e].restrictions)h.push(a[e].restrictions[g],g);else"string"==typeof a[e].restrictions&&h.push(a[e].restrictions);try{h.length&&d._restrict.apply(d,h)}catch(l){throw"invalid input array for restrictions in:\n"+b._pathName+"."+a[e].name;}}a[e].draw&&Is.Function(d._draw)&&("undefined"!=typeof d.__drawTpl&&!d._isActive&&
a[e].ondemand?(d.__drawTpl=a[e].draw,d.__drawData=c):(c=arrConcat(c,a[e].draw[2]),d._draw(a[e].draw[0],a[e].draw[1],c),d._isActive&&d._active&&d._active(!0)));a[e].objects&&a[e].objects.length&&("undefined"!=typeof d.__drawObj&&!d._isActive&&a[e].ondemand?(d.__drawObj=a[e].objects,d.__drawData=c):(this.__addObjects(a[e].objects,d,c),d._isActive&&d._active&&d._active(!0)))}};
Gui.prototype._obeyEvent=function(a,b,c){this._events[a]?this._disobeyEvent(a,b):this._events[a]={};var d=unique_id();this._events[a][d]=[b,c];return d};
Gui.prototype._disobeyEvent=function(a,b){var c=getCallbackFunction(b,!0);if(Is.Function(c)){if(!this._events[a])return!0;for(var d in this._events[a])if(this._events[a][d]){var e=this._events[a][d][0];if(Is.Function(e[0])&&Is.Function(b[0])&&e[0]===b[0]||Is.Function(e[1])&&Is.Function(b[1])&&e[0]===b[0]&&e[1]===b[1]||e[0]._pathName==b[0]._pathName&&c===getCallbackFunction(e,!0))return delete this._events[a][d],!0}}return!1};
Gui.prototype.__exeEvent=function(a,b,c){if(this._events[a])for(var d in this._events[a])try{"undefined"!=typeof this._events[a][d]&&Is.Object(this._events[a][d][0])&&!1!==executeCallbackFunction(this._events[a][d][0],b,c)||delete this._events[a][d]}catch(e){gui._REQUEST_VARS.frm&&console.log("exeEvent",e),delete this._events[a][d]}};
Gui.prototype._getChildObjects=function(a,b){var c=[];Is.Defined(a)&&(a=a.toString());for(var d in this)0!=d.indexOf("_")&&this[d]&&(a&&this[d]._anchor!=a||b&&this[d]._type!=b||c.push(this[d]));return c};Gui.prototype._clean=function(a,b){var c=this._getChildObjects(a,b),d;for(d in c)c[d]._destruct();return!0};
Gui.prototype._getAnchor=function(a){Is.Defined(a)&&(a=a.toString());return this._anchors[a]?document.getElementById(this._anchors[a]):"main"==a||"self"==a?this._main:document.getElementById(this._pathName+(a?"#"+a:""))};Gui.prototype._listen=function(a,b,c){this._listener=a;"object"==typeof b&&(this._listenerPath=b);dataSet.obey(this,"_listener",a,c)};Gui.prototype._save=function(a,b){this._saver=a;"object"==typeof b&&(this._saverPath=b);dataSet.obey(this,"_saver",a)};
Gui.prototype._saveme=function(a){if(this._skipsaving)return"";this._noupdate&&(a=this._noupdate);if(this._saver)return dataSet.add(this._saver,this._saverPath,this._value(),a,this._pathName),this._saver;if(this._listener)return dataSet.add(this._listener,this._listenerPath,this._value(),a,this._pathName),this._listener};Gui.prototype._add_destructor=function(a,b){if(!a)return!1;this._destructors[a]=b};Gui.prototype._remove_destructor=function(a){delete this._destructors[a]};
Gui.prototype._destruct=function(){if(!this._destructed){this._destructed=!0;if(!this._parent[this._name])return!1;for(var a in this._destructors)Is.Function(this[a])&&this[a].apply(this,Is.Array(this._destructors[a])?this._destructors[a]:arguments);this.__exeEvent("ondestruct",null,{owner:this});for(var b in this)0!=b.indexOf("_")&&"object"==typeof this[b]&&null!=this[b]&&"function"==typeof this[b]._destruct&&(this[b]._destruct(),delete this[b]);this._listener&&dataSet.disobey(this);this._listener_data&&
dataSet.disobey(this,"_listener_data");try{this._main&&this._main.parentNode&&this._main.parentNode.removeChild(this._main)}catch(c){gui._REQUEST_VARS.debug&&console.log(this._name||!1,c)}this._parent[this._name]=null;delete this._parent[this._name];this._parent.__onDestroyChild&&this._parent.__onDestroyChild(this._name,this._type,this._anchor);this.__exeEvent("destructed",null,this)}};
Gui.__root=function(){function a(a){a=a||window.event;b.__exeEvent(a.type,a)}var b=this;this._main=mkElement("div",{id:this._name,style:{width:"100%",height:"100%",overflow:"hidden",position:"absolute"}});this._main.onscroll=function(a){a=a||window.event;this.scrollLeft=this.scrollTop=0;a.preventDefault&&a.preventDefault();return!1};document.getElementsByTagName("body")[0].appendChild(this._main);this.__Y=this.__X=0;this.__UNIQ=unique_id();this.__BROWSER={touch:!1,retina:1<window.devicePixelRatio||
window.matchMedia&&window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),     (min--moz-device-pixel-ratio: 1.5),     (-o-min-device-pixel-ratio: 3/2),     (min-resolution: 1.5dppx)").matches?!0:!1};AttachEvent(document,"onkeydown",function(a){(a.ctrlKey||a.metaKey)&&122==a.keyCode&&(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&
document.webkitCancelFullScreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))});if("ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints)addcss(this._main,"touch"),this.__BROWSER.touch=!0;window.onresize=function(b){setTimeout(function(){a(b)},
5)};this.__focus=!0;window.onfocus=function(c){b.__focus=!0;a(c)};window.onblur=function(c){b.__focus=!1;a(c)};this.__online=!0;document.body.ononline=function(c){b.__online=!0;a(c)};document.body.onoffline=function(c){b.__online=!1;a(c)};document.onclick=function(c){b.__focus||(b.__focus=!0);a(c)};document.onmousedown=a;document.onmouseup=function(c){b.__focus||(b.__focus=!0);a(c)};AttachEvent(document,"onmousewheel",function(b){b=b||window.event;Is.Defined(b.deltaY)?b=b.deltaY:(b.originalEvent&&
(b=b.originalEvent),b=Is.Defined(b.detail)?b.detail:b.wheelDelta/-120);a({type:"mousewheel",delta:b})});document.onmousemove=function(c){c=c||window.event;b.__X=c.clientX;b.__Y=c.clientY;a(c)};document.onkeydown=function(b){b=b||window.event;a(b);if(116==b.keyCode||27==b.keyCode)return b.cancelBubble=!0,b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),!1;122==b.keyCode&&(b.ctrlKey||b.metaKey)&&(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?
document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))};document.onkeyup=
function(b){b=b||window.event;a(b);if(116==b.keyCode||27==b.keyCode)return b.cancelBubble=!0,b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),116==b.keyCode&&gui.frm_main._getNew(),!1};document.onpaste=function(b){b=b||window.event;a(b)};this.__loading_stack=[];this._loading=function(a,b){var e;if(this.__loading_obj){b?(this.__loading_stack.push(a),setTimeout(this._loading.bind(this,a),5E3)):~(e=this.__loading_stack.indexOf(a))&&this.__loading_stack.splice(e,1);try{this.__loading_obj._loading(this.__loading_stack.length)}catch(f){gui._REQUEST_VARS.debug&&
console.log(this._name||!1,f)}}else this.__loading_stack=[]};0===currentBrowser().indexOf("MSIE")&&setInterval(function(){0<b._main.scrollTop&&(b._main.scrollTop=0)},1E3)};function wm_generic(){this.xmlns;this.error}var _me=wm_generic.prototype;
_me.create_iq=function(a,b,c,d,e,f,g,h){delete this.error;f=f||this.xmlns;if(!{auth:1,tools:1,accounts:1,folders:1,items:1,freebusy:1,spellchecker:1,"public":1,"private":1,domain:1,message:1,"import":1,"export":1,upload:1}[f])throw Error('create_iq: unsupported xmlns "'+f+'"');f="webmail:iq:"+f;var l={IQ:[{ATTRIBUTES:{},QUERY:[{ATTRIBUTES:{}}]}]};(h=h?"":dataSet.get("main",["sid"]))&&(l.IQ[0].ATTRIBUTES.SID=h);e&&(l.IQ[0].ATTRIBUTES.UID=e);l.IQ[0].ATTRIBUTES.TYPE=d||"get";l.IQ[0].QUERY[0].ATTRIBUTES.XMLNS=
f;gui._REQUEST_VARS.xml||"set"==d&&!g||(l.IQ[0].ATTRIBUTES.FORMAT="json");a&&"object"==typeof a&&(l.IQ[0].QUERY[0]=arrConcat(l.IQ[0].QUERY[0],a));if(b)return request.sendArray(l,[this,"response_check",[b]],c),!0;if(a=request.sendArray(l))return a=a.getArray(),"error"==a.IQ[0].ATTRIBUTES.TYPE&&(b=a.IQ[0].ERROR[0],this.error={},this.error.text=b.VALUE,b.ATTRIBUTES&&b.ATTRIBUTES.UID&&(this.error.id=b.ATTRIBUTES.UID,this.error.lang=getLang("ERR_"+b.ATTRIBUTES.ID))),a};
_me.response_check=function(a,b){try{var c=a.Array,d=c.IQ[0].ATTRIBUTES}catch(g){return!1}if("error"==d.TYPE)try{var e=c.IQ[0].ERROR[0].ATTRIBUTES.UID||"";switch(e){case "folder_does_not_exist":if("__@@ADDRESSBOOK@@__"===c.IQ[0].ERROR[0].VALUE&&dataSet.get("accounts",[sPrimaryAccount,"GUEST_ACCOUNT"]))return;break;case "account_does_not_exist":var f=c.IQ[0].ERROR[0].VALUE;if(f&&f!==sPrimaryAccount)return gui._create("settings","frm_settings","","","account_settings","other"),gui.notifier._value({type:"alert",
args:{header:"ALERTS::"+e,text:"ALERTS::UPDATE_LOGIN_INFORMATION",args:[f]}}),!1;case "session_expired":case "session_no_user":return dataSet.add("main",["sid"],""),gui&&gui.frm_main&&gui.frm_main.__logout&&gui.frm_main.__logout(),!1;case "imap_authenticate":case "smtp_authenticate":case "groupware_authenticate":return(f=c.IQ[0].ERROR[0].VALUE||d.UID)&&f!==sPrimaryAccount?(gui.notifier._value({type:"alert",args:{header:"ALERTS::"+e,text:"ALERTS::UPDATE_LOGIN_INFORMATION",args:[f]}}),gui.settings&&
gui.settings._isModal()||gui._create("settings","frm_settings","","","account_settings","other"),gui.settings._modal(!0)):gui&&gui.frm_main&&gui.frm_main._acceptChangedIP&&gui.frm_main._acceptChangedIP(),!1;case "xmlrequest_invalid_sid":case "session_ip_mismatch":return gui.reauth||gui._create("reauth","frm_reauth"),!1;default:0===e.indexOf("E_")&&getLang("ERROR::"+e,!1,2)&&gui.notifier._value({type:"alert",args:{header:"ERROR::"+e}})}}catch(g){gui._REQUEST_VARS.debug&&console.log(this._name||!1,
g)}else c.IQ[0].ATTRIBUTES&&c.IQ[0].ATTRIBUTES.TEAMCHAT_TOKEN&&(sPrimaryAccountTeamchatToken=c.IQ[0].ATTRIBUTES.TEAMCHAT_TOKEN);try{executeCallbackFunction(b,a)}catch(g){(gui._REQUEST_VARS.debug||gui._REQUEST_VARS.frm)&&dataSet.get("main",["sid"])&&console.warn({InputData:c||"no data",Error:g})}};_me.response=function(){};function wm_auth(){this.xmlns="auth"}wm_auth.inherit(wm_generic);_me=wm_auth.prototype;
_me.login=function(a,b,c){if(a.username&&(a.password||a.digest||a.auto_digest)){if(a.password)try{a.digest=this.digest(a.username,a.password)}catch(e){return this.error={id:"RSA"},!1}else if(a.auto_digest)try{a.digest=this.digest(a.username,"",a.auto_digest)}catch(e){return this.error={id:"RSA"},!1}this.logout();var d={USERNAME:[{VALUE:a.username}],DIGEST:[{VALUE:a.digest}],METHOD:[{VALUE:"RSA"}]};a.auto_login&&(d.AUTO_LOGIN=[{VALUE:"true"}]);a.language&&(d.LANGUAGE=[{VALUE:a.language}]);a.disable_ip_check&&
(d.DISABLE_IP_CHECK=[{VALUE:1}])}else if(a.session)0===a.session.indexOf("wmtr")?d={METHOD:[{VALUE:"troubleshootingsession"}],SESSION:[{VALUE:a.session}]}:(d={SESSION:[{VALUE:a.session}]},a.from&&(d.FROM=[{VALUE:a.from}]),a.keep&&(d.KEEP=[{VALUE:"true"}]));else return!1;if(b)this.create_iq(d,[this,"response",["login",b,c]],"","set");else{a=this.create_iq(d,"","","set");if(this.error)return!1;a=a.IQ[0].ATTRIBUTES.SID;dataSet.add("main",["sid"],a);return a}return!0};
_me.reconnect=function(a,b,c){a=auth.digest(a,b,void 0,auth.hashid({username:a},!0));a={METHOD:[{VALUE:"RSAIP"}],USERNAME:[{VALUE:dataSet.get("main",["user"])}],DIGEST:[{VALUE:a}],SESSION:[{VALUE:dataSet.get("main",["sid"])}]};this.create_iq(a,[this,"response",["reconnect","main",["sid"],c]],"","set")};
_me.get_digest=function(a,b,c){b={METHOD:[{VALUE:b}]};if(Is.String(a))b.hashID=[{VALUE:a}];else if(a.hash)b.hashID=[{VALUE:a.hash}],a.command&&(b.COMMAND=[{VALUE:a.command}],a.uri&&(b.URI=[{VALUE:a.uri||""}]));else{console.log("get_digest","Invalid hashID",a);return}if(c)this.create_iq(b,[this,"response",["digest","","",c]],"","get");else try{var d=this.create_iq(b,"","","get");return d=d.IQ[0].QUERY[0].DIGEST[0].VALUE}catch(e){return!1}};
_me.get_xmpp=function(a){a&&this.create_iq({METHOD:[{VALUE:"xmpp"}]},[this,"response",["xmpp","","",a]],"","get")};_me.logout=function(a){if(!dataSet.get("main",["sid"]))return!0;"3"==cookieManager.get("LoginState")&&cookieManager.set("LoginState","2");if(a)return this.create_iq(null,[this,"_void"],"","set"),!0;this.create_iq(null,"","","set");dataSet.remove("main",["sid"],!0);return!0};
_me.troubleshootingSession=function(a,b){this.create_iq({METHOD:[{VALUE:"troubleshootingsession"}],VALIDITY:[{VALUE:a}]},[this,"response",["troubleshootingSession",null,null,b]],"","get")};_me.deleteTroubleshooting=function(a,b){this.create_iq({METHOD:[{VALUE:"deletetroubleshooting"}],SESSION:[{VALUE:a}]},[this,"response",["deleteTroubleshooting",null,null,b]],"","set")};
_me._forgot=function(a,b,c){a={"EMAIL`":[{VALUE:a}],CAPTCHA:[{ATTRIBUTES:{UID:b},VALUE:c}],SUBJECT:[{VALUE:GWOthers.getItem("RESET_SETTINGS","subject")||getLang("RESET_PASS::SUBJECT")}],MESSAGE:[{VALUE:GWOthers.getItem("RESET_SETTINGS","mail")||getLang("RESET_PASS::EMAIL")}]};a=this.create_iq(a,"","","set").IQ[0];if("result"==a.ATTRIBUTES.TYPE){b=[];for(var d in a.QUERY[0].EMAIL)b.push(a.QUERY[0].EMAIL[d].VALUE);return b}return"error"==a.ATTRIBUTES.TYPE?a.ERROR[0].ATTRIBUTES.UID:!1};_me._void=function(){};
_me.digest=function(a,b,c,d){a=d?d:this.hashid({username:a});d=new RSAKey;d.setPublic(a.hash,"10001");try{return b?d.encrypt(buildURL({p:b,t:a.time})):d.encrypt(c)}catch(e){console.error(e)}};_me.hashid=function(a,b){var c={USERNAME:[{VALUE:a.username}],METHOD:[{VALUE:"RSA"}]},c=b?this.create_iq(c,void 0,void 0,void 0,void 0,void 0,void 0,!0):this.create_iq(c);return{hash:c.IQ[0].QUERY[0].HASHID[0].VALUE,time:c.IQ[0].QUERY[0].TIMESTAMP[0].VALUE}};
_me.response=function(a,b,c,d,e){var f=a.Array,g=f.IQ[0].ATTRIBUTES;d="main"==c?["sid"]:d||["sid"];switch(b){case "login":case "reconnect":"result"==g.TYPE&&f.IQ[0].ATTRIBUTES.SID&&dataSet.add(c,d,f.IQ[0].ATTRIBUTES.SID);e&&executeCallbackFunction(e,"result"==a.Array.IQ[0].ATTRIBUTES.TYPE);break;case "logout":dataSet.add(c,d,"");break;case "digest":"result"==g.TYPE&&executeCallbackFunction(e,f.IQ[0].QUERY[0].DIGEST[0].VALUE);break;case "xmpp":if("result"==g.TYPE){b={};a=f.IQ[0].QUERY[0];for(var h in a)a[h][0]&&
a[h][0].VALUE&&(b[h]=a[h][0].VALUE);executeCallbackFunction(e,b)}break;case "troubleshootingSession":Cookie.set(["troubleshooting"],{session:f.IQ[0].QUERY[0].DIGEST[0].VALUE,timestamp:f.IQ[0].QUERY[0].TIMESTAMP[0].VALUE});executeCallbackFunction(e);break;case "deleteTroubleshooting":Cookie.set(["troubleshooting"]),executeCallbackFunction(e)}};var auth=new wm_auth;function wm_accounts(){this.xmlns="accounts"}wm_accounts.inherit(wm_generic);_me=wm_accounts.prototype;
_me.add=function(a,b,c,d){var e,f;if(a.aid){e={ACCOUNT:[{ATTRIBUTES:{ACTION:"edit",UID:a.aid}}]};f=e.ACCOUNT[0];for(var g in a)if("acl"==g){var h=[],l;for(l in a.acl)h.push({VALUE:a.acl[l].join(""),ATTRIBUTES:{EMAIL:l}});f.ACL=h.length?[{RIGHT:h}]:[{VALUE:""}]}else"aid"!=g&&(f[g]=[{VALUE:a[g]}]);f=a.aid}else if(a.SERVER&&a.USERNAME&&a.PASSWORD&&a.EMAIL){switch(a.PROTOCOL){case "imap":case "pop3":case "local":break;default:a.PROTOCOL="pop3"}a.PORT||(a.PORT="imap"==a.PROTOCOL?143:110);f=a.EMAIL;e={ACCOUNT:[{ATTRIBUTES:{ACTION:"add"},
PROTOCOL:[{VALUE:a.PROTOCOL}],SERVER:[{VALUE:a.SERVER}],USERNAME:[{VALUE:a.USERNAME}],PASSWORD:[{VALUE:a.PASSWORD}],PORT:[{VALUE:a.PORT}],EMAIL:[{VALUE:a.EMAIL}],DESCRIPTION:[{VALUE:a.DESCRIPTION}]}]}}else return!1;if(b||d)return this.create_iq(e,[this,"response",["add",b,c,d]],"","set",f),!0;a=this.create_iq(e,"","","set");try{if("result"==a.IQ[0].ATTRIBUTES.TYPE)return!0}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}return!1};
_me.subscribe=function(a,b){if(a&&a.subscription&&a.subscription.length){var c=[],d;for(d in a.subscription)c.push({VALUE:a.subscription[d]});if(c.length)return this.create_iq({ACCOUNT:[{SUBSCRIPTION:c,ATTRIBUTES:{ACTION:"subscribe",UID:sPrimaryAccount}}]},[this,"response",["subscribe","","",b]],"","set"),!0}};
_me.unsubscribe=function(a,b){if(a&&a.subscription&&a.subscription.length){var c=[],d;for(d in a.subscription)c.push({VALUE:a.subscription[d]});if(c.length)return this.create_iq({ACCOUNT:[{SUBSCRIPTION:c,ATTRIBUTES:{ACTION:"unsubscribe_folder",UID:sPrimaryAccount}}]},[this,"response",["subscribe","","",b]],"","set"),!0}};
_me.test=function(a,b){var c={ACCOUNT:[{ATTRIBUTES:{ACTION:"test"}}]},d=c.ACCOUNT[0];d.EMAIL=[{VALUE:a.EMAIL}];d.USERNAME=[{VALUE:a.USERNAME}];a.PASSWORD&&(d.PASSWORD=[{VALUE:a.PASSWORD}]);d.SERVER=[{VALUE:a.SERVER}];d.PORT=[{VALUE:a.PORT}];d.PROTOCOL=[{VALUE:a.PROTOCOL}];d.SENTFOLDER=[{VALUE:a.SENTFOLDER}];d.TRASHFOLDER=[{VALUE:a.TRASHFOLDER}];d.DESCRIPTION=[{VALUE:a.DESCRIPTION}];if(b)return this.create_iq(c,[this,"response",["test","","",b]],"","set"),!0;c=this.create_iq(c,"","","set");try{if("result"==
c.IQ[0].ATTRIBUTES.TYPE)return!0}catch(e){gui._REQUEST_VARS.debug&&console.log(this._name||!1,e)}return!1};
_me._signup=function(a,b,c,d,e,f,g){aRequest={ACCOUNT:[{ATTRIBUTES:{ACTION:"signup"},USERNAME:[{VALUE:a}],PASSWORD:[{VALUE:b}],FULLNAME:[{VALUE:c}],ALTERNATIVE:[{VALUE:e}],EMAIL:[{VALUE:a+"@"+d}],CAPTCHA:[{ATTRIBUTES:{UID:f},VALUE:g}]}]};a=this.create_iq(aRequest,"","","set").IQ[0];return"result"==a.ATTRIBUTES.TYPE?{uid:!0}:"error"==a.ATTRIBUTES.TYPE?{uid:a.ERROR[0].ATTRIBUTES.UID,value:a.ERROR[0].VALUE}:!1};
_me.license=function(a){this.create_iq({ACCOUNT:[{ATTRIBUTES:{ACTION:"license",UID:sPrimaryAccount}}]},[this,"response",["license",null,null,a]],"","get");return!0};_me.list=function(a,b,c,d,e){var f={};a&&a.aid&&(f.ACCOUNT=[{ATTRIBUTES:{UID:a.aid}}]);f.CTZ=[{VALUE:(new IcewarpDate).utcOffset()}];return b||e?(this.create_iq(f,[this,"response",["list",b,c,e]],"","get",d),!0):this.account_sort(this.parse(this.create_iq(f)))};
_me.account_sort=function(a){var b={},c={},d;for(d in a)a[d].PRIMARY?(b[d]=a[d],delete a[d]):"rss"==a[d].TYPE&&(c[d]=a[d],delete a[d]);for(d in a)b[d]=a[d];for(d in c)b[d]=c[d];return b};_me.refresh=function(a,b,c,d){if(!a.aid)return!1;var e={ACCOUNT:[{ATTRIBUTES:{ACTION:"refresh",UID:a.aid}}]};if(d||b)return this.create_iq(e,[this,"response",["refresh",b,c,d]],"","set",a.aid,"",!0),!0;a=WMFolders.parse(this.create_iq(e,"","","set"));a[sPrimaryAccount]&&this.__mapFolders(a[sPrimaryAccount]);return a};
_me.remove=function(a,b,c,d){if(!a.aid)return!1;a={ACCOUNT:[{ATTRIBUTES:{ACTION:"delete",UID:a.aid}}]};if(b)return this.create_iq(a,[this,"response",["remove",b,c]],"","set",d),!0;b=this.create_iq(a,"","","set");try{if("result"==b.IQ[0].ATTRIBUTES.TYPE)return!0}catch(e){gui._REQUEST_VARS.debug&&console.log(this._name||!1,e)}return!1};
_me.synchronize=function(a,b,c){if(!a.aid)return!1;a={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{ACTION:"sync"}}]}]};if(b)return this.create_iq(a,[this,"response",["synchronize",b,c]],"","set"),!0;b=this.create_iq(a,"","","set");try{if("result"==b.Array.IQ[0].ATTRIBUTES.TYPE)return!0}catch(d){}return!1};
_me.synclist=function(a,b,c){if(!a.aid)return!1;var d={ACCOUNT:[{ATTRIBUTES:{UID:a.aid,ACTION:"sync"}}]};if(b)return this.create_iq(d,[this,"response",["synclist",b,c]],"","set",a.aid),!0;b=this.create_iq(d,"","","set");try{"result"==b.IQ[0].ATTRIBUTES.TYPE&&(new wm_folders).list({aid:a.aid})}catch(e){}return!1};
_me.action=function(a,b,c){if(c&&b){b={ACCOUNT:[{ATTRIBUTES:{UID:sPrimaryAccount,ACTION:b}}]};if(a)for(var d in a)b.ACCOUNT[0][d]=[{VALUE:a[d]}];this.create_iq(b,[this,"response",["action",null,null,c]],"","set",sPrimaryAccount)}};
_me.response=function(a,b,c,d,e){var f=a.Array;a=f.IQ[0].ATTRIBUTES;switch(b){case "license":e&&executeCallbackFunction(e,f);break;case "subscribe":"result"==a.TYPE&&this.refresh({aid:sPrimaryAccount},"folders");e&&executeCallbackFunction(e,f);break;case "test":c=!1;try{"result"==f.IQ[0].ATTRIBUTES.TYPE&&(c=!0)}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}executeCallbackFunction(e,c);break;case "list":if("result"==a.TYPE){if(c||e)b=this.account_sort(this.parse(f)),c&&dataSet.add(c,
d,b),e&&executeCallbackFunction(e,b);if(a.UID)for(sAccId in e=dataSet.get(c,d),dataSet.remove(a.UID,"",!0),e)WMFolders.list({aid:sAccId},a.UID)}return!0;case "refresh":if("error"==a.TYPE){var g,h;try{h=f.IQ[0].ERROR[0].ATTRIBUTES.UID,g=f.IQ[0].ERROR[0].VALUE}catch(q){g=h=""}"imap_internal"==h.toLowerCase()&&("object"==typeof e?executeCallbackFunction(e,(a.UID?a.UID+"\n":"")+g.unescapeHTML()):alert((a.UID?a.UID+"\n":"")+g.unescapeHTML()))}case "synchronize":if("result"==a.TYPE&&a.UID){d=WMFolders.parse(f);
f=f.IQ[0].QUERY[0].ACCOUNT[0].ATTRIBUTES;if(sPrimaryAccount==a.UID){f.MBOX_QUOTA&&(dataSet.add("main",["MBOX_QUOTA"],f.MBOX_QUOTA,!0),dataSet.add("main",["MBOX_USAGE"],f.MBOX_USAGE));f.SMS_LIMIT&&(dataSet.add("main",["SMS_LIMIT"],f.SMS_LIMIT,!0),dataSet.add("main",["SMS_SENT"],f.SMS_SENT));f=+(dataSet.get(c,[a.UID,"INBOX","RECENT"])||0);a.UID==sPrimaryAccount&&this.__mapFolders(d[a.UID]);this.__mergeRecent(a.UID,d[a.UID]);if("synchronize"===b)for(var l in d[a.UID])d[a.UID].hasOwnProperty(l)&&dataSet.add(c,
[a.UID,l],d[a.UID][l]);else dataSet.add(c,[a.UID],d[a.UID]);f<dataSet.get(c,[a.UID,"INBOX","RECENT"])?(gui.frm_main&&gui.frm_main.title&&gui.frm_main.title._add(getLang("TITLE::NEW_EMAIL"),10),gui.notifier&&gui.notifier._value({type:"new_email",args:[sPrimaryAccount]}),storage.library("gw_others"),gui.frm_main&&gui.frm_main.sound&&0<parseInt(GWOthers.getItem("MAIL_SETTINGS_GENERAL","sound_notify"))&&gui.frm_main.sound._play("mail")):0<f&&0==(dataSet.get(c,[a.UID,"INBOX","RECENT"])||0)&&gui.frm_main&&
gui.frm_main.title&&gui.frm_main.title._reset()}else dataSet.add(c,[a.UID],d[a.UID]);"object"==typeof e&&executeCallbackFunction(e)}break;case "remove":try{return"result"!=a.TYPE&&a.UID&&this.list(c,d,a.UID),!0}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}return!1;case "add":case "synclist":try{if("result"==a.TYPE&&c&&a.UID)return WMFolders.list({aid:a.UID},c,d,e),!0;if("result"==a.TYPE&&"object"==typeof e)return executeCallbackFunction(e),!0;"error"==a.TYPE&&"object"==typeof e&&
executeCallbackFunction(e,f.IQ[0].ERROR[0].ATTRIBUTES.UID,f.IQ[0].ERROR[0].VALUE)}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}return!1;case "action":executeCallbackFunction(e,"result"==a.TYPE,f.IQ[0])}};
_me.__mapFolders=function(a){if(this.__mapped!=sPrimaryAccount){var b={},c={};storage.library("gw_others");var d=Path.split(GWOthers.getItem("DEFAULT_FOLDERS","trash"))[1];a[d]||(b.trash=d.toLowerCase());d=Path.split(GWOthers.getItem("DEFAULT_FOLDERS","drafts"))[1];a[d]||(b.drafts=d.toLowerCase());d=Path.split(GWOthers.getItem("DEFAULT_FOLDERS","sent"))[1];a[d]||(b.sent=d.toLowerCase());for(var e in a)if(a[e].ARCHIVE)dataSet.add("main",["archive_path"],sPrimaryAccount+"/"+e,!0);else if(a[e].SPAM)dataSet.add("main",
["spam_path"],sPrimaryAccount+"/"+e,!0);else if(a[e].RESOURCE)dataSet.add("main",["resources_path"],e,!0);else for(var f in b)e.toLowerCase()===b[f]&&(c[f]=sPrimaryAccount+"/"+e,delete b[f]);Is.Empty(c)||GWOthers.set("DEFAULT_FOLDERS",c,"storage");this.__mapped=sPrimaryAccount}};_me.__mergeRecent=function(a,b){var c=dataSet.get("folders",[a]);if(c)for(var d in b)c[d]&&!Is.Defined(b[d].RECENT)&&c[d].RECENT&&(b[d].RECENT=c[d].RECENT);return b};
_me.parse=function(a){try{var b=a.IQ[0].QUERY[0].ACCOUNT;a={};var c,d;for(d in b){c={TYPE:"user"};for(var e in b[d])if("ATTRIBUTES"==e)for(var f in b[d].ATTRIBUTES)c[f]="true"==b[d].ATTRIBUTES[f]?1:"false"==b[d].ATTRIBUTES[f]?0:b[d].ATTRIBUTES[f];else if("ACL"==e){var g;if(b[d][e][0]&&(g=b[d][e][0].RIGHT)){c.ACL={};for(var h in g)c.ACL[g[h].ATTRIBUTES.EMAIL]=g[h].VALUE?g[h].VALUE.split(""):[]}g=null}else c[e]=b[d][e][0].VALUE;c.PRIMARY&&(c.SHARED_PREFIX=(c.SHARED_PREFIX||"~").replace(/\\/g,"/"),dataSet.add("main",
["fullname"],c.FULLNAME,!0),dataSet.add("main",["user"],c.USERNAME,!0),dataSet.add("main",["account"],c.UID,!0),dataSet.add("main",["domain"],c.UID.substr(c.UID.indexOf("@")+1),!0),dataSet.add("main",["message_size"],c.MESSAGE_SIZE,!0),dataSet.add("main",["keep_deleted_items_force_expiration"],c.KEEPDELETEDITEMSFORCEEXPIRATION,!0),dataSet.add("main",["device_id"],c.DEVICE_ID,!0),dataSet.add("main",["server_id"],c.ICEWARP_SERVER_ID,!0),window.sPrimaryAccount=b[d].ATTRIBUTES.UID,window.sPrimaryAccountTeamchatToken=
window.sPrimaryAccountTeamchatToken||!1,window.sPrimaryAccountType=c.TYPE,window.sPrimaryAccountProtocol=c.PROTOCOL,window.sPrimaryAccountWebDAV=b[d].ATTRIBUTES.WEBDAV_URL,window.sTeamchatApiUrl=b[d].ATTRIBUTES.TEAMCHATAPI_URL,window.sPrimaryAccountWebAdmin=b[d].ATTRIBUTES.WEBADMIN_URL,window.sPrimaryAccountClient=b[d].ATTRIBUTES.CLIENT_URL,window.sPrimaryAccountGW=c.GW,window.sPrimaryAccountGWID=b[d].ATTRIBUTES.GW_OWNERID,window.sPrimaryAccountGWTRASH=b[d].ATTRIBUTES.GWTRASH_SUPPORT,window.sPrimaryAccountIM=
c.IM_SUPPORT,window.sPrimaryAccountIMHISTORY=c.IM_HISTORY_SUPPORT,window.sPrimaryAccountSIP=c.SIP_SUPPORT,window.sPrimaryAccount2F=c.TWO_FACTOR_SUPPORT,window.sPrimaryAccount2FE=c.TWO_FACTOR_ENABLED,window.sPrimaryAccountCHAT=c.GROUPCHAT_SUPPORT,window.sPrimaryAccountGUEST=c.GUEST_ACCOUNT,window.sPrimaryAccountACTIVESYNC=c.ACTIVESYNC_SUPPORT,window.sPrimaryAccountSMS=c.SMS_SUPPORT,window.sPrimaryAccountSPREFIX=c.SHARED_PREFIX,window.sPrimaryAccountAPREFIX=c.ARCHIVE_PERFIX,window.sPrimaryAccountSHARING=
c.SHARING_SUPPORT,window.sPrimaryAccountDELIVERY=c.DELIVERY_SUPPORT,window.sPrimaryAccountRULES=c.RULES_SUPPORT,window.sPrimaryAccountCONFERENCE=c.MEETING_SUPPORT,window.sPrimaryAccountFULLTEXT=c.FULLTEXT_SUPPORT,window.sPrimaryAccountSOCKS=c.SOCKS_SUPPORT,window.sPrimaryAccountHTTP=c.HTTP_PORT,window.sPrimaryAccountHTTPS=c.HTTPS_PORT,window.sPrimaryAccountULIMIT=c.UPLOAD_LIMIT,window.sPrimaryAccountSMTP=c.SMTP_HEADER_FUNCTION,window.sPrimaryAccountOLDWC=c.OLD_SUPPORT,window.sPrimaryTelemetry=c.TELEMETRY_SUPPORT);
a[c.UID]=c}return a}catch(l){return!1}};var accounts=new wm_accounts,WMAccounts=accounts;function wm_folders(){this.xmlns="folders"}wm_folders.inherit(wm_generic);_me=wm_folders.prototype;wm_folders.aux={sort:function(a,b){var c,d;c=Is.String(a.TITLE)?a.TITLE.toLowerCase():a.TITLE;d=Is.String(b.TITLE)?b.TITLE.toLowerCase():b.TITLE;return c>d?1:c<d?-1:0}};Object.defineProperty(wm_folders.aux,"private_owner",{get:function(){return this.value||(this.value="private_"+dataSet.get("main",["domain"])+"@##internalservicedomain.icewarp.com##")}});
_me.add=function(a,b,c,d,e){if(!a.aid)return!1;var f;if(a.fid){if(!a["default"]&&!a.name&&"undefined"==typeof a.channel&&!a.acl)return!1;f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid,ACTION:"edit"}}]}]}}else{if(!a.name||a.type&&0>inArray("mail contact event journal note task file m r c e j n t f i".split(" "),a.type.toLowerCase()))return!1;a.type||(a.type="M");f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{ACTION:"add"},TYPE:[{VALUE:a.type}]}]}]}}a.name&&a.fid!=a.name&&
(f.ACCOUNT[0].FOLDER[0].NAME=[{VALUE:a.name}]);a["default"]&&(f.ACCOUNT[0].FOLDER[0].DEFAULT=[{VALUE:a["default"]}]);a["private"]&&(f.ACCOUNT[0].FOLDER[0].PRIVATE=[{VALUE:a["private"]}]);a.clone&&(f.ACCOUNT[0].FOLDER[0].CLONE=[{VALUE:a.clone}]);if(a.virtual){f.ACCOUNT[0].FOLDER[0].VIRTUAL=[];if(a.virtual.sharetype)f.ACCOUNT[0].FOLDER[0].VIRTUAL=[{SHARETYPE:[{VALUE:a.virtual.sharetype}]}];else if(a.virtual.folders){f.ACCOUNT[0].FOLDER[0].VIRTUAL=[{FOLDERS:[{FOLDER:[]}]}];var g,h;for(h in a.virtual.folders)g=
{VALUE:h},a.virtual.folders[h]&&(g.ATTRIBUTES={PRIMARY:"true"}),f.ACCOUNT[0].FOLDER[0].VIRTUAL[0].FOLDERS[0].FOLDER.push(g)}"undefined"!=typeof a.search&&(f.ACCOUNT[0].FOLDER[0].VIRTUAL[0].SEARCH=[{VALUE:a.search}])}if(a.acl){g=[];for(h in a.acl)g.push({VALUE:a.acl[h].join(""),ATTRIBUTES:{EMAIL:h}});f.ACCOUNT[0].FOLDER[0].ACL=g.length?[{RIGHT:g}]:[{VALUE:""}]}if(Is.Array(a.channel))for(h in f.ACCOUNT[0].FOLDER[0].CHANNELS=[{CHANNEL:[]}],a.channel)a.channel[h]&&f.ACCOUNT[0].FOLDER[0].CHANNELS[0].CHANNEL.push({VALUE:a.channel[h]});
if(b||d)return this.create_iq(f,[this,"response",["add",b,c,a,d,e]],"","set",a.aid),!0;a=this.create_iq(f,"","","set");try{if("result"==a.IQ[0].ATTRIBUTES.TYPE)return!0}catch(l){gui._REQUEST_VARS.debug&&console.log(this._name||!1,l)}return!1};_me.list=function(a,b,c,d,e){if(!a.aid)return!1;var f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid}}]};a.fid&&(f.ACCOUNT[0].FOLDER=[{ATTRIBUTES:{UID:a.fid}}]);return b||d?(this.create_iq(f,[this,"response",["list",b,c,"",d,e]],"","get",a.aid),!0):this.parse(this.create_iq(f))};
_me.getType=function(a){var b=a.aid||a[0];a=a.fid||a[1];return b===sPrimaryAccount&&"__@@VIRTUAL@@__/__@@MEETINGS@@__"===a?"W":"@@alfresco@@"===b?"K":dataSet.get("folders",[b,a,"TYPE"])||"X"};
_me.getRights=function(a,b){var c={},d=a.aid||a[0],e=a.fid||a[1],f=null;"Y"==this.getType(a)?f=dataSet.get("folders",[d,e].concat("RIGHTS")):Cookie&&(f=Cookie.get(["rights",d,e]));if(f)for(var g in f)switch(f[g]){case "l":c.read=!0;break;case "k":c.write=!0;break;case "x":c.modify=!0;c.remove=!0;break;case "a":c.owner=!0;break;case "b":c.invite=!0;break;case "c":c.kick=!0;break;case "d":c.edit_folder=!0;break;case "e":c.edit_document=!0}else c={owner:!0,read:!0,write:!0,modify:!0,remove:!0};return b?
!!c[b]:c};_me.getAccess=function(a,b){var c={},d=a.aid||a[0],e=a.fid||a[1],f=null;"Y"==this.getType(a)?f=dataSet.get("folders",[d,e].concat("RIGHTS")):Cookie&&(f=Cookie.get(["rights",d,e]));if(f)for(var g in f)switch(f[g]){case "r":c.read=!0;break;case "i":c.write=!0;break;case "w":c.modify=!0;break;case "t":c.remove=!0;break;case "e":c.edit_document=!0}else c={owner:!0,read:!0,write:!0,modify:!0,remove:!0};return b?!!c[b]:c};_me.remove=function(a,b,c){return this.action(a,b,c,"delete")};
_me.empty=function(a,b,c,d,e){return b?this.action(a,b,c,"empty",d,e):this.action(a,b,c,"empty",d,e)?(dataSet.add("items",[a.aid,a.fid],{}),!0):!1};
_me.action=function(a,b,c,d,e,f){if(!d||!a.aid||!a.fid)return!1;var g={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid,ACTION:d}}]}]};if(a.xmlarray)for(var h in a.xmlarray)g.ACCOUNT[0].FOLDER[0][h]=a.xmlarray[h];Is.Object(e)&&(g.ACCOUNT[0].FOLDER[0].ACCOUNT=[{VALUE:e.aid}],g.ACCOUNT[0].FOLDER[0].FOLDER=[{VALUE:e.fid}]);return b||f?(this.create_iq(g,[this,"response",[d,b,c,{aid:a.aid,fid:a.fid},f]],"","set",a.aid+"/"+a.fid),!0):"result"==this.create_iq(g,"","","set").IQ[0].ATTRIBUTES.TYPE?
!0:!1};_me.save_folder=function(a,b){if(!a.aid||!a.fid)return!1;this.create_iq({ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid,ACTION:"save_items"}}]}]},[this,"response",["save_folder","","","","",b]],"","set");return!0};
_me.subscribe=function(a,b,c,d,e){b=b||"folders";var f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid,ACTION:"edit"},SUBSCRIBED:[{VALUE:d?1:0}]}]}]},g;g=d?[function(a,d){a&&this.sync(d,b,c,e)}.bind(this)]:e;this.create_iq(f,[this,"response",[d?"sync":"unsync",b,c,a,g]],"","set",a.aid+"/"+a.fid);return!0};
_me.sync=function(a,b,c,d){if(!a.aid)return!1;this.create_iq({ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{ACTION:"sync",UID:a.fid}}]}]},[WMAccounts,"response",["synchronize",b,c,d]],"","set",a.aid)};
_me.markItemsRead=function(a,b,c,d){if(!a.aid||!a.fid)return!1;var e={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid,ACTION:d?"markasread":"markasunread"}}]}]};a.bRead=d;if(b)return this.create_iq(e,[this,"response",["markread",b,c,a]],"","set",a.aid),!0;a=this.create_iq(e,"","","set");try{if("result"==a.IQ[0].ATTRIBUTES.TYPE)return!0}catch(f){gui._REQUEST_VARS.debug&&console.log(this._name||!1,f)}return!1};
_me.response=function(a,b,c,d,e,f,g){a=a.Array;var h=a.IQ[0].ATTRIBUTES;try{if("error"==h.TYPE){var l,q;try{q=a.IQ[0].ERROR[0].ATTRIBUTES.UID,l=a.IQ[0].ERROR[0].VALUE}catch(w){l=q=""}if(g){executeCallbackFunction(g,e,q,l);return}switch(q.toLowerCase()){case "teamchat_kick_member":gui.notifier._value({type:"alert",args:{header:"ALERTS::ALERT",text:"ALERTS::ALERT",args:[e.name.escapeHTML()]}});break;case "imap_internal":gui.notifier._value({type:"alert",args:{header:"ALERTS::UNDEFINED",text_plain:(h.UID?
h.UID+"\n":"")+l.unescapeHTML()}});break;case "folder_create":gui.notifier._value({type:"alert",args:{header:"POPUP_FOLDERS::ADD_FOLDER",text:"ALERTS::CREATE_FOLDER",args:[e.name.escapeHTML()]}});break;case "folder_already_exists":gui.notifier._value({type:"alert",args:{header:"POPUP_FOLDERS::ADD_FOLDER",text:"ALERTS::FOLDER_EXIST",args:[e.name.escapeHTML()]}});break;case "folder_name_bad_char":case "folder_rename":gui.notifier._value({type:"alert",args:{header:"POPUP_FOLDERS::RENAME_FOLDER",text:"ALERTS::RENAME_FOLDER",
args:[e.fid.escapeHTML(),e.name.escapeHTML()]}});break;case "autocreate_folder_name_reserved_word":gui.notifier._value({type:"alert",args:{header:"POPUP_FOLDERS::ADD_FOLDER",text:"ALERTS::RESERVED_FOLDER",args:[e.name.escapeHTML()]}})}}}catch(w){gui._REQUEST_VARS.debug&&console.log(this._name||!1,w)}switch(b){case "save_folder":if("result"==h.TYPE){var t;try{t={"class":a.IQ[0].RESULT[0].ACCOUNT[0].FOLDER[0].ITEM[0].VALUES[0].CLASS[0].VALUE,fullpath:a.IQ[0].RESULT[0].ACCOUNT[0].FOLDER[0].ITEM[0].VALUES[0].FULLPATH[0].VALUE}}catch(w){break}Is.Object(f)?
executeCallbackFunction(f,t):(t.sid=dataSet.get("main",["sid"]),downloadItem(buildURL(t)))}break;case "unsync":case "sync":"result"==h.TYPE&&dataSet.add("folders",[e.aid,e.fid,"SYNC"],"sync"==b?1:0);f&&executeCallbackFunction(f,"result"==h.TYPE,e);break;case "add":if("error"==h.TYPE){try{h.UID&&this.list({aid:h.UID},c,d)}catch(w){gui._REQUEST_VARS.debug&&console.log(this._name||!1,w)}return!0}if("I"==e.type&&Is.String(e.name)){var m=a.IQ[0].QUERY[0].ACCOUNT[0];Path.basename(e.name)==m.FOLDER[0].NAME[0].VALUE&&
(e.name=m.FOLDER[0].ATTRIBUTES.UID)}if(Cookie&&"undefined"!=typeof e.name&&"undefined"!=typeof e.aid)try{m=a.IQ[0].QUERY[0].ACCOUNT[0],m.ATTRIBUTES.UID==e.aid&&m.FOLDER[0].ATTRIBUTES.UID==e.name&&Cookie.set(["rights",e.aid,e.name],m.FOLDER[0].ATTRIBUTES.RIGHTS?m.FOLDER[0].ATTRIBUTES.RIGHTS.split(""):"")}catch(w){gui._REQUEST_VARS.debug&&console.log(this._name||!1,w)}if(e.fid&&(e.name&&e.fid!=e.name||"undefined"!=typeof e.channel)||e["default"]){var p=a.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0],u=e.name||
e.fid,m=dataSet.get(c,[e.aid],!0)||{},r;for(r in m)if(r==e.fid){if(p.RELATIVE_PATH&&(m[r].RELATIVE_PATH=p.RELATIVE_PATH[0].VALUE),p.OWNER&&(m[r].OWNER=p.OWNER[0].VALUE),m[r].NAME=p.NAME?p.NAME[0].VALUE:u.split("/").pop(),"I"!=m[r].TYPE){var v=m[r];delete m[r];"undefined"!=typeof e.channel&&(v.CHANNEL=e.channel);m[p.ATTRIBUTES.UID||u]=v}}else 0===r.indexOf(e.fid+"/")&&(v=m[r],delete m[r],m[u+r.substr(e.fid.length)]=v);e.aid==sPrimaryAccount&&a.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0].DEFAULT&&(r={C:"CONTACTS",
E:"EVENTS",T:"TASKS",N:"NOTES",J:"JOURNAL",F:"FILES",D:"DRAFTS",H:"TRASH",S:"SENT",P:"TEMPLATES"}[a.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0].DEFAULT[0].VALUE],(p=GWOthers.getItem("DEFAULT_FOLDERS",r))&&(p=Path.split(p))&&m[p[1]]&&delete m[p[1]].DEFAULT,m[u].DEFAULT=a.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0].DEFAULT[0].VALUE,GWOthers.setItem("DEFAULT_FOLDERS",r,e.aid+"/"+u));r={};r[e.aid]=m;dataSet.add(c,[e.aid],this.sort(r)[e.aid],!0);dataSet.update(c,[e.aid])}else!e.fid&&e.name&&(a=this.parse(a)[e.aid][e.name],
"undefined"!=typeof e.channel&&(a.RSS="true"),r={},m=dataSet.get(c,[e.aid],!0)||{},m[e.name]=a,r[e.aid]=m,"I"==e.type&&e["private"]&&(r[e.aid][Path.split(e.name).shift()]||(r[e.aid][Path.split(e.name).shift()]={SHARED:"true",OWNER:wm_folders.aux.private_owner,PRIVATE_ROOT:"true",SUBSCRIPTION_TYPE:"account",TYPE:"X"}),r[e.aid][Path.basedir(e.name)]||(r[e.aid][Path.basedir(e.name)]={NAME:getLang("COMMON_FOLDERS::PRIVATE_ROOT"),TYPE:"Y"})),dataSet.add(c,[e.aid],this.sort(r)[e.aid]));"object"==typeof f&&
executeCallbackFunction(f,e);return!1;case "list":try{if(h.UID){var x=this.parse(a,!0);x[sPrimaryAccount]&&WMAccounts.__mapFolders(x[sPrimaryAccount]);c&&dataSet.add(c,[h.UID],WMAccounts.__mergeRecent(h.UID,x[h.UID]));"object"==typeof f&&executeCallbackFunction(f,x);return!0}}catch(w){gui._REQUEST_VARS.debug&&console.log(this._name||!1,w)}return!1;case "delete":try{if("result"!=h.TYPE&&h.UID)return this.list({aid:h.UID},c,d),!0}catch(w){gui._REQUEST_VARS.debug&&console.log(this._name||!1,w)}f=!0;
a=!1;m=dataSet.get(c,[e.aid]);for(r in m)r==e.fid||0===r.indexOf(e.fid+"/")?(a=!0,delete m[r]):f=!1;f&&e.aid==sPrimaryAccount+"_rss"?(dataSet.remove("accounts",[e.aid],!0),dataSet.remove(c,[e.aid])):a&&(dataSet.add(c,[e.aid],m,!0),dataSet.update(c,[e.aid]));return!1;case "empty":try{if("result"!=h.TYPE&&h.UID){p=Path.split(h.UID);this.list({aid:p[0]},c,d);var y=dataSet.get("items");for(u in y)for(v in y[u]);u==p[0]&&v==p[1]&&WMItems.list({aid:u,fid:v,values:items.default_values("M")},"items");return!0}if(h.UID){p=
Path.split(h.UID);y=dataSet.get("items");for(u in y)for(v in y[u]);u==p[0]&&v==p[1]&&dataSet.add("items",[p[0],p[1]],{})}}catch(w){gui._REQUEST_VARS.debug&&console.log(this._name||!1,w)}0<dataSet.get(c,[e.aid,e.fid,"RECENT"])&&dataSet.add(c,[e.aid,e.fid,"RECENT"],"0");"object"==typeof f&&executeCallbackFunction(f,"result"==h.TYPE,e);return!1;case "copyall":case "moveall":e.aid&&(this.list({aid:e.aid},c,d),gui.frm_main.main&&gui.frm_main.main.list&&gui.frm_main.main.list._serverSort());break;case "markread":if("error"==
h.TYPE)return!0;e.bRead?0<dataSet.get(c,[e.aid,e.fid,"RECENT"])&&dataSet.add(c,[e.aid,e.fid,"RECENT"],"0"):(f=0,Is.Defined(a.IQ[0].QUERY[0].RECENT)&&(f=parseInt(a.IQ[0].QUERY[0].RECENT),Is.Number(f)||(f=0)),r=dataSet.get(c,[e.aid,e.fid,"RECENT"]),(0<r?r:0)!=f&&dataSet.add(c,[e.aid,e.fid,"RECENT"],f.toString()));y=dataSet.get("items");for(u in y)for(v in y[u]);u==e.aid&&v==e.fid&&gui.frm_main.main.list._serverSort();return!0;default:"object"==typeof f&&executeCallbackFunction(f,"result"==h.TYPE,e)}};
_me.sort=function(a){var b={},c,d,e,f,g,h,l,q=getLang("COMMON_FOLDERS"),t,m;for(m in a){e=[];f=[];g=[];h=[];l=[];for(var p in a[m])if("__@@GWTRASH@@__"==p)a[m][p].NAME=q["GW-TRASH"],h.push({FOLDER:p,TITLE:q["GW-TRASH"]});else if(c=p.split("/"),"INBOX"==c[0])c[0]==p&&(a[m][p].NAME=q.INBOX),c[0]=q.INBOX,e.push({FOLDER:p,TITLE:c.join("/")});else if("__@@VIRTUAL@@__"==c[0])c[0]==p?a[m][p].NAME=q["VIRTUAL-FOLDERS"]:"__@@EVENTS@@__"==c[1]&&(a[m][p].NAME=q.CALENDARS),c[0]=q["VIRTUAL-FOLDERS"],h.push({FOLDER:p,
TITLE:c.join("/")});else if("SPAM_QUEUE"==c[0])c[1]&&(a[m][p].NAME=q["SPAM_QUEUE-"+c[1].toUpperCase()]),h.push({FOLDER:p,TITLE:p});else if("Quarantine"==c[0]&&"Q"==a[m][p].TYPE)a[m][p].NAME=q.QUARANTINE,h.push({FOLDER:p,TITLE:p});else{a[m][p].PRIVATE_ROOT&&(a[m][p].TYPE="Y");d="";if("I"==a[m][p].TYPE){if((t=Path.basedir(p))&&!a[m][t]){var u={TYPE:"Y"};a[m][p].OWNER==wm_folders.aux.private_owner?(u.NAME=q.PRIVATE_ROOT,d="*"):a[m][p].OWNER&&~a[m][p].OWNER.indexOf("@##internalservicedomain.icewarp.com##")&&
(u.NAME=getLang("COMMON_FOLDERS::PRIVATE_ROOT_EXT",[p.split("/")[0]]),d="*"+t);a[m][t]=u;h.push({FOLDER:t,TITLE:d||t});d=""}a[m][p].NAME&&(d=p.substr(0,p.lastIndexOf("/")+1)+a[m][p].NAME);a[m][p].OWNER&&~a[m][p].OWNER.indexOf("@##internalservicedomain.icewarp.com##")&&(d="*"+(d||p))}0==p.indexOf(sPrimaryAccountSPREFIX)&&0<p.indexOf("@")?(l.push({FOLDER:p,TITLE:a[m][p].SORT||p}),"M"==a[m][p].TYPE&&"INBOX"==c[c.length-1]&&-1<(c[c.length-2]||"").indexOf("@")?a[m][p].NAME=q.INBOX:c[1]||(a[m][p].NAME=
p.substr(sPrimaryAccountSPREFIX.length))):"M"==a[m][p].TYPE&&(a[m][p].DEFAULT||a[m][p].SPAM)?f.push({FOLDER:p,TITLE:p}):a[m][p].DEFAULT?g.push({FOLDER:p,TITLE:p}):(h.push({FOLDER:p,TITLE:d||p}),a[m][c[0]]&&a[m][c[0]].PUBLIC&&"INBOX"==c[1]&&"M"==a[m][p].TYPE&&!c[2]&&(a[m][p].NAME=q.INBOX))}e.sort(wm_folders.aux.sort);f.sort(wm_folders.aux.sort);g.sort(wm_folders.aux.sort);h.sort(wm_folders.aux.sort);l.sort(wm_folders.aux.sort);for(d=0;d<l.length;d++)if(-1<l[d].FOLDER.indexOf("/")){t=l[d].FOLDER.split("/");
for(u=k=0;u<=t.length;u++){t.pop();c=t.join("/");if(""==c||l[d-1]&&l[d-1].FOLDER==c)break;l.splice(d,0,{FOLDER:c});k++}d+=k}c={};for(var r in e){d=a[m][e[r].FOLDER];c[e[r].FOLDER]={};for(var v in d)c[e[r].FOLDER][v]=d[v]}for(r in f)for(v in d=a[m][f[r].FOLDER],c[f[r].FOLDER]={},d)c[f[r].FOLDER][v]=d[v];for(r in g)for(v in d=a[m][g[r].FOLDER],c[g[r].FOLDER]={},d)c[g[r].FOLDER][v]=d[v];for(r in h)if(d=a[m][h[r].FOLDER],!d&&h[r].VALUES)c[h[r].FOLDER]=h[r].VALUES;else for(v in c[h[r].FOLDER]={},d)c[h[r].FOLDER][v]=
d[v];for(r in l)for(v in d=a[m][l[r].FOLDER],!d&&0==l[r].FOLDER.indexOf(sPrimaryAccountSPREFIX)&&0<l[r].FOLDER.indexOf("@")?1>l[r].FOLDER.substr(sPrimaryAccountSPREFIX.length).indexOf("/")?c[l[r].FOLDER]={TYPE:"VA",NAME:l[r].FOLDER.substr(sPrimaryAccountSPREFIX.length)}:c[l[r].FOLDER]={}:c[l[r].FOLDER]=d&&d.SHARED?{TYPE:"VA"}:{},d)c[l[r].FOLDER][v]||(c[l[r].FOLDER][v]=d[v]);b[m]=c}return b};
_me.parse=function(a,b){try{var c=a.IQ[0].QUERY[0].ACCOUNT[0],d=c.ATTRIBUTES.UID,e=c.FOLDER,f,c={},g={},h,l,q={C:"CONTACTS",E:"EVENTS",T:"TASKS",N:"NOTES",J:"JOURNAL",F:"FILES",D:"DRAFTS",H:"TRASH",S:"SENT"},t="",m;for(m in e){h={};f=e[m].ATTRIBUTES.UID;for(var p in e[m])if("CHANNELS"==p){if(e[m][p][0]&&e[m][p][0].CHANNEL){h[p]=[];l=e[m][p][0].CHANNEL;for(var u in l)l[u].VALUE&&h[p].push(l[u].VALUE)}}else if("ACL"==p){if(e[m][p][0]&&e[m][p][0].RIGHT)for(u in h[p]={},l=e[m][p][0].RIGHT,l)h[p][l[u].ATTRIBUTES.EMAIL]=
l[u].VALUE?l[u].VALUE.split(""):[];acl=!0}else if("DEFAULT"==p&&d==sPrimaryAccount&&0!==e[m].ATTRIBUTES.UID.indexOf(sPrimaryAccountSPREFIX))t=e[m].TYPE[0].VALUE,"M"==t&&(t=e[m][p][0].VALUE),GWOthers.setItem("DEFAULT_FOLDERS",q[t],sPrimaryAccount+"/"+e[m].ATTRIBUTES.UID),h[p]=e[m][p][0].VALUE;else if("VIRTUAL"==p&&d==sPrimaryAccount||"SUBFOLDERS"==p){h[p]={};if(e[m][p][0].FOLDERS&&e[m][p][0].FOLDERS[0].FOLDER){h[p].FOLDERS={};var r=e[m][p][0].FOLDERS[0].FOLDER;for(u in r)r[u].ATTRIBUTES&&r[u].ATTRIBUTES.NOEXIST||
(h[p].FOLDERS[r[u].VALUE]=r[u].ATTRIBUTES&&r[u].ATTRIBUTES.PRIMARY?!0:!1)}else e[m][p][0].SHARETYPE&&(h[p].SHARETYPE=e[m][p][0].SHARETYPE[0].VALUE);e[m][p][0].SEARCH&&(h[p].SEARCH=e[m][p][0].SEARCH[0].VALUE)}else"ATTRIBUTES"!=p&&(h[p]=e[m][p][0].VALUE);g[f]=h}c[d]=g;return e?this.sort(c):{}}catch(v){return!1}};
_me.__emptyFolder=function(a,b,c,d){var e,f;if("M"===this.getType([a,b])){storage.library("gw_others");var g=clone(dataSet.get("folders",[a,b]),!0),h=Path.split(GWOthers.getItem("DEFAULT_FOLDERS","trash")),h={aid:h[0],fid:h[1]};c?(e=dataSet.get("folders",[h.aid,h.fid],!0),Is.Defined(e)&&Is.Defined(g)&&(e=parseInt(g.RECENT||0)+parseInt(e.RECENT||0),g=parseInt(dataSet.get("folders",[h.aid,h.fid,"RECENT"])||0),e!=g&&dataSet.add("folders",[h.aid,h.fid,"RECENT"],e.toString())),e=h):h.aid===a&&h.fid===
b&&(f=[function(a){a&&WMAccounts.refresh({aid:h.aid},"folders")}]);0<dataSet.get("folders",[a,b,"RECENT"])&&dataSet.add("folders",[a,b,"RECENT"],"0");g=dataSet.get("preview");if("object"==typeof g){for(var l in g)for(var q in g[l]);l==a&&q==b&&dataSet.remove("preview")}}this.empty({aid:a,fid:b,xmlarray:d&&{SEARCH:[{VALUE:d}]}},"folders","",e,f)};
_me.toTree=function(a){var b={};a.forEach(function(a){a.split("/").reduce(function(a,c){var f=a+(a?"/":"")+c;if(!b[f]){var g=dataSet.get("folders",[sPrimaryAccount,f]);g&&(b[f]={full_path:f,name:c,children:[],type:g.TYPE,owner:g.OWNER,"public":g.PUBLIC,recent:g.RECENT||0,rights:g.RIGHTS})}a&&!~b[a].children.indexOf(b[f])&&b[a].children.push(b[f]);return f},"")});return b};
_me.getUnsubscribedChatFolders=function(){var a,b;b=Object.keys(a=dataSet.get("folders",[sPrimaryAccount])).filter(function(b){return"I"===a[b].TYPE&&(!a[b].SYNC||"0"===a[b].SYNC)});dataSet.add("unsubscribed_rooms_count",!1,b.length);return b};WMFolders=new wm_folders;
function wm_items(){this.xmlns="items";this.__clientID=function(a){return"*"+a.replace(/^\*/,"")};this.__serverID=function(a){return-1<a.indexOf("*")?a.replace("*",""):a};this.__defaultValues={C:"ITMCLASSIFYAS ITMTITLE ITMFIRSTNAME ITMMIDDLENAME ITMSURNAME ITMCLASS ITMSUFFIX ITMCOMPANY ITMDEPARTMENT LCTEMAIL1 LCTEMAIL2 LCTEMAIL3 LCTIM ITMCATEGORY LCTPHNWORK1 LCTPHNFAXWORK LCTPHNHOME1 LCTPHNMOBILE".split(" "),E:"EVNTITLE EVNLOCATION EVNSTARTDATE EVNSTARTTIME EVNENDDATE EVNENDTIME OSD EVNOWN_ID EVNRCR_ID EVNGRP_ID RMNEVN_ID EVNTYPE EVNCLASS EVNFOLDER EVNFLAGS EVNMEETINGID EVNSHARETYPE".split(" "),
EI:"EVNTITLE EVNLOCATION EVNSTARTDATE EVNSTARTTIME EVNENDDATE EVNENDTIME OSD OED EVNOWN_ID EVNRCR_ID EVNGRP_ID RMNEVN_ID EVNTIMEFORMAT EVNTYPE EVNCLASS EVNFOLDER EVNMEETINGID EVNFLAGS EVNSHARETYPE".split(" "),J:"EVNTITLE EVNLOCATION EVNSTARTDATE EVNSTARTTIME EVNENDDATE EVNENDTIME EVNCONTACT EVNTYPE".split(" "),F:"EVNTITLE EVNDESCFORMAT EVNNOTE EVNLOCATION EVN_MODIFIED EVNTYPE EVNCOMPLETE EVNLOCKOWN_ID".split(" "),R:"SUBJECT TO FROM DATE SIZE FLAGS HAS_ATTACHMENT COLOR PRIORITY SMIME_STATUS".split(" "),
M:"SUBJECT TO SMS FROM DATE SIZE FLAGS HAS_ATTACHMENT COLOR PRIORITY SMIME_STATUS ITEM_MOVED TAGS".split(" "),T:"EVNTITLE EVNSTATUS EVNSTARTDATE EVNENDDATE EVNRCR_ID RMNEVN_ID EVNTYPE EVNPRIORITY EVNCOMPLETE".split(" "),N:["EVNTITLE","EVNTYPE","EVN_MODIFIED"],Q:["SNDEMAIL","SNDSUBJECT","QDATE","SNDOWNER","SNDDOMAIN"],QL:["SNDEMAIL","SNDOWNER","SNDDOMAIN","QDATE"],G:"ITM_ID ITMTITLE ITMDESCRIPTION ITMCLASS ITM_DELETED ITMORIGINALFOLDER".split(" "),I:["EVNTITLE","EVNDESCRIPTION"]}}wm_items.inherit(wm_generic);
_me=wm_items.prototype;_me.__lastListId={};
_me.action=function(a,b,c){var d,e,f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]};if(a.values){e={};for(var g in a.values)Is.Array(e[g])||(e[g]=[{VALUE:a.values[g]}])}Is.Array(a.iid)||(a.iid=[a.iid]);for(g in a.iid){d={ATTRIBUTES:{UID:this.__serverID(a.iid[g]),ACTION:b}};e&&(d.VALUES=[e]);if(a.attrs)for(g in attrs={},a.attrs)d[g]=[{VALUE:a.attrs[g]}];if(a.nodes)for(n in a.nodes)a.nodes.hasOwnProperty(n)&&(d[n.toUpperCase()]=[{VALUE:a.nodes[n]}]);f.ACCOUNT[0].FOLDER[0].ITEM.push(d)}if(c)return this.create_iq(f,
[this,"response",["action","","","","",c]],"","set"),!0;a=this.create_iq(f,"","","set");try{if("result"==a.IQ[0].ATTRIBUTES.TYPE)return!0}catch(h){gui._REQUEST_VARS.debug&&console.log(this._name||!1,h)}return!1};
_me.add=function(a,b,c,d,e,f,g){function h(a,b,c){if("object"==typeof b){var d=c[a]=[{}];a=a.substr(0,a.length-1);d=d[0][a]=[{}]}c=0;for(var e in b){d[c]={};for(var f in b[e])a=b[e][f],"uid"==f?d[c].ATTRIBUTES={UID:a}:"values"==f?(aValuesFrame=d[c].VALUES=[{}],l(a,aValuesFrame[0])):h(f,a,d[c]);c++}}function l(a,b){for(var c in a)Is.Array(a[c])?b[c]=[{VALUE:a[c].pop()}]:b[c]=[{VALUE:a[c]}]}if(!a[0]||!a[1])return!1;if(a[2]&&b.values&&"undefined"!=typeof b.values.flags&&c){var q=b.values.flags;dataSet.add(c,
a.concat(["FLAGS"]),q);if(e){var t=dataSet.get(e,[a[0],a[1],"RECENT"]);"undefined"==typeof t&&(t=0);this.hasFlag(q,"SEEN")?t&&t--:t++;parseInt(dataSet.get(e,[a[0],a[1],"RECENT"])||0)!=t&&dataSet.add(e,[a[0],a[1],"RECENT"],t.toString())}}for(var q={ACCOUNT:[{ATTRIBUTES:{UID:a[0]},FOLDER:[{ATTRIBUTES:{UID:a[1]},ITEM:[]}]}]},m,t=a[2]?Is.Array(a[2])?a[2]:[a[2]]:[""],p=0;p<t.length;p++){m=t[p]?{ATTRIBUTES:{ACTION:"edit",UID:this.__serverID(t[p])},VALUES:[{}]}:{ATTRIBUTES:{ACTION:"add"},VALUES:[{}]};for(var u in b)if("aid"!=
u&&"fid"!=u&&"iid"!=u)switch(u){case "values":l(b.values,m.VALUES[0]);break;case "replace":m.ATTRIBUTES.DUPLICITY="replace";break;case "duplicity":m.ATTRIBUTES.DUPLICITY=b[u];break;default:h(u,b[u],m)}g&&m.VALUES&&(m.VALUES[0].AUTO_SAVE=[{VALUE:1}]);m.VALUES&&(m.VALUES[0].CTZ=[{VALUE:(new IcewarpDate).utcOffset()}]);q.ACCOUNT[0].FOLDER[0].ITEM.push(m)}return c||f?(this.create_iq(q,[this,"response",["add",c,d,e,{aid:a[0]},f,{type:"add",args:arguments}]],"","set"),!0):this.parse(this.create_iq(q,"",
"","set"))};
_me.copy=function(a,b,c,d,e){if(!a.aid||!a.fid||!a.folder)return!1;var f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]},g=f.ACCOUNT[0].FOLDER[0].ITEM,h,l;for(l in a.iid)g[l]=a.account?{ATTRIBUTES:{UID:this.__serverID(a.iid[l]),ACTION:"copy"},ACCOUNT:[{VALUE:a.account}],FOLDER:[{VALUE:a.folder}]}:{ATTRIBUTES:{UID:this.__serverID(a.iid[l]),ACTION:"copy"},FOLDER:[{VALUE:a.folder}]},a.duplicity&&(g[l].ATTRIBUTES.DUPLICITY=a.duplicity),a.rename&&(g[l].ATTRIBUTES.RENAME=a.rename),
h=1;if(!h)return!1;if(b)return this.create_iq(f,[this,"response",["copy",b,c,d,{aid:a.aid,fid:a.fid,account:a.account},e,{type:"copy",args:arguments}]],"","set"),!0;f=this.create_iq(f,"","","set");try{if("result"==f.IQ[0].ATTRIBUTES.TYPE)return!0}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}return!1};
_me.move=function(a,b,c,d,e){if(!a.aid||!a.fid||!a.folder)return!1;var f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]},g=f.ACCOUNT[0].FOLDER[0].ITEM,h,l;for(l in a.iid)g[l]=a.account?{ATTRIBUTES:{UID:this.__serverID(a.iid[l]),ACTION:"move"},ACCOUNT:[{VALUE:a.account}],FOLDER:[{VALUE:a.folder}]}:{ATTRIBUTES:{UID:this.__serverID(a.iid[l]),ACTION:"move"},FOLDER:[{VALUE:a.folder}]},a.duplicity&&(g[l].ATTRIBUTES.DUPLICITY=a.duplicity),a.rename&&(g[l].ATTRIBUTES.RENAME=
a.rename),h=1;if(!h)return!1;f=this.create_iq(f,"","","set");try{if(b)this.response({Array:f},"move",b,c,d,{aid:a.aid,fid:a.fid,account:a.account},e,{type:"move",args:arguments});else if("result"==f.IQ[0].ATTRIBUTES.TYPE)return!0}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}return!1};_me.getFlag=function(a,b,c){a=this._getFlagValue(a,c,"FLAGS");return Is.Defined(a)?this.hasFlag(a,b):!1};
_me.hasFlag=function(a,b){switch(b){case "ANSWERED":a&=1;break;case "DELETED":a&=2;break;case "DRAFT":a&=4;break;case "FLAGGED":a&=8;break;case "RECENT":a&=16;break;case "SEEN":a&=32;break;case "FORWARDED":a&=64;break;case "COMPLETED":a&=128;break;default:return!1}return a?!0:!1};
_me.setFlag=function(a,b,c,d){function e(a,b,c){switch(b){case "ANSWERED":return c?a|33:a&-2;case "DELETED":return c?a|2:a&-3;case "DRAFT":return c?a|4:a&-5;case "FLAGGED":return c?a|8:a&-9;case "RECENT":return c?a|16:a&-17;case "SEEN":return c?a|32:a&-33;case "FORWARDED":return c?a|96:a&-65;case "COMPLETED":return c?a|128:a&-129}return a}var f="FLAGS",g="";if(1==count(b))for(var h in b)f=b[h]?"SET_FLAG":"CLEAR_FLAG",g=e(0,h,!0);if(!a.aid||!a.fid||!a.iid||"object"!=typeof a.iid||Is.Empty(a.iid))return!1;
h={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]};var l=h.ACCOUNT[0].FOLDER[0].ITEM,q,t,m=0,p=!1,u;for(u in a.iid){q=this._getFlagValue([a.aid,a.fid,a.iid[u]],c,"FLAGS");"undefined"==typeof q&&(q=0);t=q;for(var r in b)t=e(t,r,b[r]);t!=q&&(dataSet.add(c,[a.aid,a.fid,a.iid[u],"FLAGS"],t,!0),q={ATTRIBUTES:{UID:this.__serverID(a.iid[u]),ACTION:"edit"},VALUES:[{}]},q.VALUES[0][f]=[{VALUE:g||t}],l.push(q),m++,p=!0)}p&&(1==a.iid.length?dataSet.update(c,[a.aid,a.fid,a.iid[0],
"FLAGS"]):dataSet.update(c));d&&0<m&&(b=parseInt(dataSet.get(d,[a.aid,a.fid,"RECENT"])||0),this.hasFlag(t,"SEEN")?dataSet.add(d,[a.aid,a.fid,"RECENT"],(0<b-m?b-m:0).toString()):dataSet.add(d,[a.aid,a.fid,"RECENT"],(b+m).toString()));return m?c?(this.create_iq(h,[this,"response",["edit",c,"",d,{aid:a.aid}]],"","set"),!0):this.parse(this.create_iq(h,"","","set")):!1};
_me.getStaticFlag=function(a,b,c){a=this._getFlagValue(a,c,"STATIC_FLAGS");if("undefined"!=typeof a)return!1;switch(b){case "HTMLBODY":return a&1;case "CACHED":return a&2}return!1};_me._getFlagValue=function(a,b,c){return b&&c?dataSet.get(b,a.concat([c])):!1};
_me.quarantine=function(a,b,c,d){if(!a.aid||!a.fid||!a.action)return!1;var e={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]},f=e.ACCOUNT[0].FOLDER[0].ITEM,g,h;for(h in a.iid)f[h]={ATTRIBUTES:{UID:this.__serverID(a.iid[h]),ACTION:a.action}},g=1;if(!g)return!1;e=this.create_iq(e,"","","set");try{if(b)this.response({Array:e},"quarantine",b,c,d,{aid:a.aid,fid:a.fid});else if("result"==e.IQ[0].ATTRIBUTES.TYPE)return!0}catch(l){gui._REQUEST_VARS.debug&&console.log(this._name||
!1,l)}return!1};
_me.recover=function(a,b,c,d,e){var f,g,h,l;e=e||[];if(!a.aid||!a.fid||!a.action)return!1;g={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]};f=g.ACCOUNT[0].FOLDER[0].ITEM;for(l in a.iid)f[l]={ATTRIBUTES:{UID:this.__serverID(a.iid[l]),ACTION:a.action}},h=1;0<e.length&&(f=g.ACCOUNT[0].FOLDER[0].FOLDERMAPPING=[]);for(l=0;l<e.length;l++)f.push({ATTRIBUTES:{SOURCE:e[l].source,DESTINATION:e[l].destination}});if(!h)return!1;e=this.create_iq(g,"","","set");try{if(b)this.response({Array:e},"recover",
b,c,d,{aid:a.aid,fid:a.fid});else if("result"==e.IQ[0].ATTRIBUTES.TYPE)return!0}catch(q){gui._REQUEST_VARS.debug&&console.log(this._name||!1,q)}return!1};
_me.imip=function(a,b,c){if(!a.aid||!a.fid||!a.iid)return!1;var d={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[{ATTRIBUTES:{UID:this.__serverID(a.iid),ACTION:b}}]}]}]},e=d.ACCOUNT[0].FOLDER[0].ITEM[0];if(!a.destination)switch(a.imip_type){case "VEVENT":a.destination=Mapping.getDefaultFolderForGWType("E");break;case "VTODO":a.destination=Mapping.getDefaultFolderForGWType("T");break;case "VJOURNAL":a.destination=Mapping.getDefaultFolderForGWType("J")}e.FOLDER=[{VALUE:a.destination}];
a.partid&&(e.PARTID=[{VALUE:a.partid}]);a.reason&&(e.VALUES=e.VALUES||[{}],e.VALUES[0].REASON=[{VALUE:a.reason}]);a.EXPDATE&&(e.VALUES=e.VALUES||[{}],e.VALUES[0].EXPDATE=[{VALUE:a.EXPDATE}]);a.EXPFOLLOWING&&(e.VALUES=e.VALUES||[{}],e.VALUES[0].EXPFOLLOWING=[{VALUE:a.EXPFOLLOWING}]);if(a.gwparams){e.GWPARAMS=[{}];for(var f in a.gwparams)e.GWPARAMS[0][f]=[{VALUE:a.gwparams[f]}]}if(c)return this.create_iq(d,[this,"response",[b,"","","",{aid:a.aid,fid:a.fid},c]],"","set"),!0;a=this.create_iq(d,"","",
"set");try{if("result"==a.IQ[0].ATTRIBUTES.TYPE)return!0}catch(g){gui._REQUEST_VARS.debug&&console.log(this._name||!1,g)}return!1};
_me.certificate=function(a,b){if(!a.aid||!a.fid||!a.iid)return!1;var c={ACCOUNT:[{ATTRIBUTES:{UID:a.account},FOLDER:[{ATTRIBUTES:{UID:a.folder},ITEM:[{ATTRIBUTES:{UID:this.__serverID(a.item),ACTION:"certificate"},CONTACT:[{ACCOUNT:[{VALUE:a.aid}],FOLDER:[{VALUE:a.fid}],ITEM:[{VALUE:this.__serverID(a.iid)}]}]}]}]}]};this.create_iq(c,[this,"response",["certificate","","","",a,b]],"","set");return!0};
_me.reminders=function(a,b){if(!a.rid.length)return!1;var c={ACCOUNT:[{ATTRIBUTES:{UID:sPrimaryAccount},FOLDER:[{ATTRIBUTES:{UID:"__@@REMINDERS@@__"},ITEM:[]}]}]},d=(new IcewarpDate).utcOffset(),e;for(e in a.rid)c.ACCOUNT[0].FOLDER[0].ITEM.push({ATTRIBUTES:{UID:this.__serverID(a.rid[e]),ACTION:"undefined"!=typeof a.snooze?"snooze":"dismiss"},VALUES:[{CTZ:[{VALUE:d}],TIMESTAMP:[{VALUE:(new IcewarpDate).unix()}]}]}),"undefined"!=typeof a.snooze&&(c.ACCOUNT[0].FOLDER[0].ITEM[c.ACCOUNT[0].FOLDER[0].ITEM.length-
1].VALUES[0].MINUTES=[{VALUE:a.snooze}]);this.create_iq(c,[this,"response",["reminders","","","",a,b]],"","set");return!0};
_me.redirect=function(a,b,c,d){if(!a.aid||!a.fid||!a.iid||!a.to&&!a.distrib)return!1;var e={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[{ATTRIBUTES:{UID:this.__serverID(a.iid),ACTION:"redirect"}}]}]}]},f=e.ACCOUNT[0].FOLDER[0].ITEM[0];a.to&&(f.TO=[{VALUE:a.to}]);if(a.distrib){f.ACCOUNT=[];var f=f.ACCOUNT,g,h,l=a.distrib,q,t;for(t in l){q=l[t];g=[];for(var m in q){aFolFrame=q[m];h=[];for(var p in aFolFrame)h.push({VALUE:aFolFrame[p]});g.push({ATTRIBUTES:{UID:m},TO:h})}f.push({ATTRIBUTES:{UID:t},
FOLDER:g})}}if(b)return this.create_iq(e,[this,"response",["redirect",b,c,"",{aid:a.aid,fid:a.fid},d]],"","set"),!0;a=this.create_iq(e,"","","set");try{if("result"==a.IQ[0].ATTRIBUTES.TYPE)return!0}catch(u){gui._REQUEST_VARS.debug&&console.log(this._name||!1,u)}return!1};
_me.remove=function(a,b,c,d,e){if(!a.aid||!a.fid)return!1;var f={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]},g=f.ACCOUNT[0].FOLDER[0].ITEM,h=0,l=Is.Object(a.values),q;for(q in a.iid)if(g[q]={ATTRIBUTES:{UID:this.__serverID(a.iid[q]),ACTION:"delete"}},h++,l&&Is.Object(a.values[q])){g[q].VALUES=[{}];var t=a.values[q],m=g[q].VALUES[0],p=void 0;for(p in t)m[p]="object"==typeof t[p]?[{VALUE:t[p].pop()}]:[{VALUE:t[p]}]}if(!h)return!1;if(e)this.create_iq(f,[this,"response",
["remove",b,c,d,{aid:a.aid,fid:a.fid},e,f]],"","set");else{e=this.create_iq(f,"","","set");try{if(b)this.response({Array:e},"remove",b,c,d,{aid:a.aid,fid:a.fid});else if("result"==e.IQ[0].ATTRIBUTES.TYPE)return!0}catch(u){gui._REQUEST_VARS.debug&&console.log(this._name||!1,u)}return!1}};
_me.save_items=function(a,b){if(!a.aid||!a.fid)return!1;var c={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[]}]}]},d;for(d in a.iid)c.ACCOUNT[0].FOLDER[0].ITEM.push({ATTRIBUTES:{UID:this.__serverID(a.iid[d]),ACTION:"save_items"}});if(b)this.create_iq(c,[this,"response",["save_items","","","","",b]],"","set");else{c=this.create_iq(c,"","","set");try{var e={sid:dataSet.get("main",["sid"]),"class":c.IQ[0].RESULT[0].ACCOUNT[0].FOLDER[0].ITEM[0].VALUES[0].CLASS[0].VALUE,fullpath:c.IQ[0].RESULT[0].ACCOUNT[0].FOLDER[0].ITEM[0].VALUES[0].FULLPATH[0].VALUE};
downloadItem(buildURL(e))}catch(f){gui._REQUEST_VARS.debug&&console.log(this._name||!1,f)}}return!0};
_me.list=function(a,b,c,d,e,f){if(!a.aid||!a.fid)return!1;var g;if(a.iid)g=a.atid?{ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[{ATTRIBUTES:{UID:this.__serverID(a.iid),ATID:a.atid}}]}]}]}:{ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[{ATTRIBUTES:{UID:this.__serverID(a.iid)}}]}]}]},a.date&&(g.ACCOUNT[0].FOLDER[0].ITEM[0].ATTRIBUTES.DATE=a.date);else if(a.rid)g={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid},ITEM:[{ATTRIBUTES:{RID:this.__serverID(a.rid)}}]}]}]};
else{g={ACCOUNT:[{ATTRIBUTES:{UID:a.aid},FOLDER:[{ATTRIBUTES:{UID:a.fid}}]}]};if(!window.gui.frm_main.__trash_cleaned){var h=Path.split(GWOthers.getItem("DEFAULT_FOLDERS","trash"));"object"==typeof h&&a.aid==h[0]&&a.fid==h[1]&&(h=0,0<GWOthers.getItem("MAIL_SETTINGS_GENERAL","autoclear_trash")&&0<(h=parseInt(GWOthers.getItem("MAIL_SETTINGS_GENERAL","autoclear_trash_days")||0))&&(g.ACCOUNT[0].FOLDER[0].CLEANUP=[{VALUE:parseInt(h)}],window.gui.frm_main.__trash_cleaned=!0))}window.gui.frm_main.__gwtrash_cleaned||
a.aid!=sPrimaryAccount||"__@@GWTRASH@@__"!=a.fid||(h=0,0<GWOthers.getItem("CALENDAR_SETTINGS","autoclear_trash")&&0<(h=parseInt(GWOthers.getItem("CALENDAR_SETTINGS","autoclear_trash_days")||0))&&(g.ACCOUNT[0].FOLDER[0].CLEANUP=[{VALUE:parseInt(h)}],window.gui.frm_main.__gwtrash_cleaned=!0))}var l,h={};if(a.values){for(var q in a.values)if(h[a.values[q]]=[a.custom_values&&a.custom_values[a.values[q]]?{VALUE:a.custom_values[a.values[q]]}:{}],"HTML"==a.values[q]||"TEXT"==a.values[q])l=!0;l&&a.iid&&b&&
0>a.iid.indexOf("|")&&0==this.getFlag([a.aid,a.fid,a.iid],"SEEN","items")&&(l=dataSet.get("items",[a.aid,a.fid,a.iid,"FLAGS"]),"undefined"!=typeof l&&(dataSet.add(b,[a.aid,a.fid,a.iid,"FLAGS"],l|32),d&&(l=parseInt(dataSet.get(d,[a.aid,a.fid,"RECENT"])||0),0<l&&dataSet.add(d,[a.aid,a.fid,"RECENT"],(--l).toString()))))}a.iid||a.rid||(g.ACCOUNT[0].FOLDER[0].ITEM=[{}]);l=g.ACCOUNT[0].FOLDER[0].ITEM[0];h.CTZ=[{VALUE:(new IcewarpDate).utcOffset()}];l.VALUES=[h];a.locations&&(l.LOCATIONS=[{VALUE:""}]);q=
0;if(a.filter&&!a.iid&&!a.rid){var h={},t;for(t in a.filter){switch(t){case "sort":h[t]=[{}];q=a.filter[t];if(Is.String(q)){q=q.split(",");for(var m in q)q[m]=q[m].trim().split(/\s+/),q[m][0]&&(h[t][0][q[m][0]]=[{VALUE:q[m][1]||"asc"}])}break;default:h[t]=[{VALUE:a.filter[t]}]}q=1}q&&(l.FILTER=[h])}return b||e?(b&&(this.__lastListId[b]=unique_id()),this.create_iq(g,[this,"response",["list",b,c,d,{aid:a.aid,fid:a.fid,iid:a.iid,filter:q},e]],f,"get",b?this.__lastListId[b]:""),!0):this.parse(this.create_iq(g),
"undefined"==typeof a.iid?!0:!1)};
_me.response=function(a,b,c,d,e,f,g,h){var l=a.Array,q=l.IQ[0].ATTRIBUTES;switch(b){case "save_items":if("result"==q.TYPE){var t;try{t={"class":l.IQ[0].RESULT[0].ACCOUNT[0].FOLDER[0].ITEM[0].VALUES[0].CLASS[0].VALUE,fullpath:l.IQ[0].RESULT[0].ACCOUNT[0].FOLDER[0].ITEM[0].VALUES[0].FULLPATH[0].VALUE}}catch(A){break}Is.Object(g)?executeCallbackFunction(g,t):(t.sid=dataSet.get("main",["sid"]),downloadItem(buildURL(t)))}break;case "reminders":g&&("result"==q.TYPE?pushParameterToCallback(g,!0):pushParameterToCallback(g,
!1),executeCallbackFunction(g));break;case "certificate":g&&("result"==q.TYPE?pushParameterToCallback(g,{data:f}):pushParameterToCallback(g,{error:l.IQ[0].ERROR[0].ATTRIBUTES.UID}),executeCallbackFunction(g));break;case "accept_counter":case "decline_counter":case "accept":case "tentative":case "decline":case "propose":if("result"==q.TYPE)executeCallbackFunction(g,!0,!1);else{var m,p;try{p=l.IQ[0].ERROR[0].ATTRIBUTES.UID,m=l.IQ[0].ERROR[0].VALUE}catch(A){m=p=""}switch(p.toLowerCase()){case "imip_obsolete":gui.notifier._value({type:"alert",
args:{header:"",text:"IMIP::OBSOLETE"}});executeCallbackFunction(g,!1,!0);break;case "imip_no_access_permissions":gui.notifier._value({type:"alert",args:{header:"",text:"IMIP::IMIP_NO_ACCESS_PERMISSIONS"}});executeCallbackFunction(g,!1,!1);break;case "imip_unknown_attendee":"decline"!=b&&gui.notifier._value({type:"alert",args:{header:"",text:"IMIP::UNKNOWN_ATTENDEE"}});executeCallbackFunction(g,!1,!0);break;case "imip_versit_empty":gui.notifier._value({type:"alert",args:{header:"",text:"IMIP::MALFORMED"}});
break;case "folder_insufficient_rights":gui.notifier._value({type:"alert",args:{header:"",text_plain:m.unescapeHTML()}});break;case "folder_does_not_exist":gui.notifier._value({type:"alert",args:{header:"",text:"IMIP::FOLDER_NOT_EXIST",args:[m.unescapeHTML()]}})}}break;case "edit":if("result"!=q.TYPE)break;case "add":case "list":if("result"!=q.TYPE){var u=!1;try{p=l.IQ[0].ERROR[0].ATTRIBUTES.UID,m=l.IQ[0].ERROR[0].VALUE}catch(A){m=p=""}switch(p.toLowerCase()){case "folder_does_not_exist":gui.notifier._value({type:"alert",
args:{header:"",text:"IMIP::FOLDER_NOT_EXIST",args:[m?m.unescapeHTML():""]}});break;case "item_invalid_id":break;case "attendee_email_invalid":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::ATTENDEE_INVALID",args:m?[m.unescapeHTML()]:null}});break;case "attachment_blocked_by_filters":gui.notifier._value({type:"alert",args:{header:"ALERTS::ATTACHMENT_FILTER",text_plain:m?"\n"+m.unescapeHTML():""}});break;case "attachment_virus":gui.notifier._value({type:"alert",args:{header:"ALERTS::ATTACHMENT_VIRUS",
text_plain:m?"\n"+m.unescapeHTML():""}});break;case "attachment_groupware_general":case "attachment_webdav_disabled":case "attachment_file_not_found":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::ATTACHMENT_MISSING"}});break;case "attachment_quota_exceeded":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::ATTACHMENT_QUOTA"}});break;case "attachment_size":gui.notifier._value({type:"alert",args:{header:"ALERTS::ATTACHMENT_SIZE",text_plain:m?"\n"+m.unescapeHTML():""}});
break;case "mailbox_quota_limit":gui.notifier._value({type:"alert",args:{header:"ALERTS::MAILBOX_QUOTA_LIMIT",text_plain:m?"\n"+m.unescapeHTML():""}});break;case "smtp_recipients_failed":gui.notifier._value({type:"alert",args:{header:"ALERTS::SMTP_RECIPIENTS_FAILED",text_plain:m?"\n"+m.unescapeHTML():""}});u=!0;break;case "item_edit":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::COULD_NOT_EDIT"}});break;case "item_create":break;case "item_edit_groupchat_attendee":gui.notifier._value({type:"alert",
args:{header:"",text:"ALERTS::ITEM_EDIT_GROUPCHAT_ATTENDEE"}});break;case "imap_fileid_sync_failed":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::IMAP_FILEID_SYNC_FAILED"}});break;case "default_folder_missing":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::DEFAULT_FOLDER_MISSING",args:[m?Mapping.getDefaultFolderForGWType(m):""]}});break;case "items_duplicity":if(h&&l.IQ[0].ERROR[0].DUPLICATE){gui._create("duplicity","frm_duplicity","","",{duplicate:l.IQ[0].ERROR[0].DUPLICATE[0],
request:h});u=2;break}case "imip_no_gw_service":gui.notifier._value({type:"alert",args:{header:"",text:"IMIP::IMIP_NO_GW_SERVICE"}});break;case "imip_no_access_permissions":gui.notifier._value({type:"alert",args:{header:"",text:"IMIP::IMIP_NO_ACCESS_PERMISSIONS"}});break;default:switch(e?WMFolders.list({aid:f.aid},e):c&&dataSet.remove(c,d),p.toLowerCase()){case "folder_insufficient_rights":case "imap_internal":gui.notifier._value({type:"alert",args:{header:"",text_plain:m?m.unescapeHTML():""}});break;
default:var r=m?p+": "+m:p;0!==r.indexOf("E_")&&(""!==getLang("ALERTS::"+r,!1,2)?gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::"+r}}):""!==getLang("ERROR::"+r,!1,2)?gui.notifier._value({type:"alert",args:{header:"",text:"ERROR::"+r}}):gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::GENERAL_ERROR",args:[r]}}))}}}else if(u=!0,"list"==b){if(c&&q.UID&&q.UID!=this.__lastListId[c])break;p=this.parse(l,"undefined"==typeof f.iid?!0:!1);if(Cookie)try{var v=l.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0].ATTRIBUTES.RIGHTS,
r=l.IQ[0].QUERY[0].ACCOUNT[0].ATTRIBUTES.UID,x=l.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0].ATTRIBUTES.UID,y=l.IQ[0].QUERY[0].ACCOUNT[0].FOLDER[0].ATTRIBUTES.PRIMARY,v=v?v.split(""):"";y&&Cookie.set(["rights",r,y],v);Cookie.set(["rights",r,x],v)}catch(A){gui._REQUEST_VARS.debug&&console.log(this._name||!1,A)}c&&(dataSet.add(c,d,p,!0),dataSet.update(c));"object"==typeof g&&(pushParameterToCallback(g,p),executeCallbackFunction(g));break}t=[];if("object"==typeof g&&l.IQ&&l.IQ[0].RESULT){for(var w in l.IQ[0].RESULT)r=
{xml:l},l.IQ[0].RESULT[w].ID&&(r.id=l.IQ[0].RESULT[w].ID[0].VALUE),l.IQ[0].RESULT[w].NAME&&(r.name=l.IQ[0].RESULT[w].NAME[0].VALUE),l.IQ[0].RESULT[w].ATT_SIZE&&(r.att_size=l.IQ[0].RESULT[w].ATT_SIZE[0].VALUE),l.IQ[0].RESULT[w].TEAMCHAT_LINK_ID&&(r.teamchat_link=l.IQ[0].RESULT[w].TEAMCHAT_LINK_ID[0].VALUE),l.IQ[0].RESULT[w].ATT_WEBDAV_LINK&&(r.att_link=l.IQ[0].RESULT[w].ATT_WEBDAV_LINK[0].VALUE),t.push(r);1==t.length&&(t=t[0])}executeCallbackFunction(g,u,u?t:p);return!0;case "copy":case "move":case "remove":try{p=
!0;if("result"!=q.TYPE){p=!1;if(e){if("copy"!=b){u=dataSet.get(c);for(r in u)for(x in u[r])break;if(r==f.aid&&x==f.fid){var C=this.default_values(dataSet.get(e,[r,x,"TYPE"]));C&&this.list({aid:r,fid:x,values:C},c,d)}}f.account&&f.account!=f.aid&&WMFolders.list({aid:f.account},e);WMFolders.list({aid:f.aid},e)}var z=l.IQ[0].ERROR[0],D=z.ATTRIBUTES.UID;switch(D){case "items_duplicity":h&&z.DUPLICATE&&(gui._create("duplicity","frm_duplicity","","",{request:h,duplicate:z.DUPLICATE[0]}),u=!0);break;case "imap_internal":gui.notifier._value({type:"alert",
args:{header:"",text_plain:(z.VALUE||"").unescapeHTML()}});break;case "item_delete":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::ITEM_COULD_NOT_DELETE"}});break;case "item_edit":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::ITEM_COULD_NOT_EDIT"}});break;case "alfresco_error":gui.notifier._value({type:"alert",args:{header:"",text:"ALERTS::"+z.VALUE}});break;case "item_decline_reason":if(z.FAILED_ID){var B=h.ACCOUNT[0].FOLDER[0].ITEM[0].VALUES||[{}],E;for(E in B[0])B[0][E]=
B[0][E][0].VALUE;var F=[];for(E in z.FAILED_ID[0].UID)F.push(this.__clientID(z.FAILED_ID[0].UID[E].VALUE));gui._create("decline","frm_text","","frm_ok_cancel",[function(a){B[0].REASON=a;B={aid:f.aid,fid:f.fid,iid:F,values:B};WMItems.remove(B,c,d,e,g)}],"EVENT::SPECIFY_REASON");u=!0}break;default:(D||z.VALUE)&&gui.notifier._value({type:"alert",args:{header:D||"",text_plain:z.VALUE||""}})}}"object"==typeof g&&executeCallbackFunction(g,p,a);return!0}catch(A){return!1}case "delete":return"object"==typeof g&&
executeCallbackFunction(g),!0;case "recover":case "quarantine":try{if("result"==q.TYPE)return e&&WMFolders.list({aid:f.aid},e),!0}catch(A){gui._REQUEST_VARS.debug&&console.log(this._name||!1,A)}return!1;case "redirect":if("object"==typeof g){if("result"!=q.TYPE){try{m=l.IQ[0].ERROR[0].VALUE,p=l.IQ[0].ERROR[0].ATTRIBUTES.UID}catch(A){p="",m="unknown error"}pushParameterToCallback(g,[p,m.unescapeHTML()])}executeCallbackFunction(g)}break;case "action":executeCallbackFunction(g,"result"==q.TYPE,l)}};
_me.default_values=function(a){return this.__defaultValues[a]};
_me.parse=function(a,b){try{var c=function(a,b){var d,e,f,g={},h,l=a.substr(0,a.length-1),m;for(m in b[l]){e=b[l][m];e.ATTRIBUTES&&e.ATTRIBUTES.UID?(d=e.ATTRIBUTES.UID,g[d]={}):(d="",g[m]={});for(var p in e)if("VALUES"==p){f=e.VALUES[0];h=d?g[d].values={}:g[m].values={};for(var q in f)f[q][0].VALUE?h[q]=f[q][0].VALUE:Is.Empty(f[q][0])||(h[q]=f[q][0])}else"ATTRIBUTES"!=p&&(d?g[d][p]=c(p,e[p][0]):g[m][p]=c(p,e[p][0]))}return g},d=a.IQ[0].QUERY[0].ACCOUNT[0],e=d.ATTRIBUTES.UID,f=d.FOLDER[0],g=f.ATTRIBUTES.UID;
Is.Defined(f.ATTRIBUTES.RECENT)&&parseInt(dataSet.get("folders",[e,g,"RECENT"])||0)!=parseInt(f.ATTRIBUTES.RECENT||0)&&(sPrimaryAccountCHAT&&dataSet.get("teamchat",[g,"recent"])&&dataSet.add("teamchat",[g,"recent"],parseInt(f.ATTRIBUTES.RECENT),!0),dataSet.update("teamchat"),dataSet.add("folders",[e,g,"RECENT"],f.ATTRIBUTES.RECENT.toString()));var h,l,q,d={},t=d[e]={},t=t[g]={};t["@"]=f.ATTRIBUTES;b&&"undefined"!=typeof f.ATTRIBUTES.COUNT&&f.ATTRIBUTES.COUNT&&(t["/"]=f.ATTRIBUTES.COUNT,t["#"]=f.ITEM?
f.ITEM.length:0);"undefined"!=typeof f.ATTRIBUTES.OFFSET&&f.ATTRIBUTES.OFFSET&&(t.$=f.ATTRIBUTES.OFFSET);var m={},p;for(p in f.ITEM){h=f.ITEM[p];var u={aid:e,fid:g},r;for(r in h)if("VALUES"==r){q=h.VALUES[0];for(var v in q)u[v]=q[v][0].VALUE}else"X_ICEWARP_SERVER_TEAMCHAT_NOTIFICATIONS"==r?u[r]=h[r][0]:"X_ICEWARP_SERVER_REQUEST"==r||"X_ICEWARP_SERVER_INVITE_REQUEST"==r?u.X_ICEWARP_SERVER_REQUEST=h[r][0]:"NOTE"==r?u[r]=h[r][0].VALUE:"ATTRIBUTES"!=r&&(u[r]=c(r,h[r][0],u[r]));l=this.__clientID(h.ATTRIBUTES.UID);
u.EVNRCR_ID&&u.EVNSTARTDATE&&u.OSD?u.EVNSTARTDATE!=u.OSD&&(l+="|"+u.EVNSTARTDATE):"undefined"==typeof m[l]?m[l]=0:l+="|"+ ++m[l];t[l]=u}return d}catch(x){return!1}};var WMItems=new wm_items;function wm_storage(){}wm_storage.inherit(wm_generic);_me=wm_storage.prototype;
_me.set=function(a,b,c,d){function e(a){var b={},c;for(c in a)"DEFAULT"!=c&&"DONT_SEND"!=c&&"ACCESS"!=c&&(b[c]=a[c]);return b}if("object"!=typeof a.resources)return!1;var f="private";"public"==a.xmlns?f="public":"domain"==a.xmlns&&(f="domain");var g={RESOURCES:[]};"string"==typeof a.domain&&(g.DOMAIN=[{VALUE:a.domain}]);a=a.resources;var h,l,q,t=g.RESOURCES[0]={},m,p,u,r,v,x=!1,y=!1;v=!1;for(var w in a)if(h=a[w].ATTRIBUTES,!(h.DONT_SEND||h.ACCESS&&"full"!=h.ACCESS)){h.DONT_SEND=!0;l=a[w].ITEMS;m=
t[w]=[];m=m[0]={};p=m.ITEM=[];h=e(h);Is.Empty(h)||(m.ATTRIBUTES=h);r=0;if(l.length)for(var C in l){if(h=l[C].ATTRIBUTES,!(h.DONT_SEND||h.ACCESS&&"full"!=h.ACCESS)){h.DONT_SEND=!0;q=l[C].VALUES;u=p[r]={};h=e(h);Is.Empty(h)||(u.ATTRIBUTES=h);for(var z in q)h=q[z].ATTRIBUTES,h.DEFAULT||h.ACCESS&&"full"!=h.ACCESS||(v=u[z]=[],v=v[0]={},h=e(h),Is.Empty(h)||(v.ATTRIBUTES=h),v.VALUE=q[z].VALUE,v=!0);if(u.ATTRIBUTES||v)r++,v=!1,y=!0}}else x=!0;if(m.ATTRIBUTES||y)y=!1,x=!0}if(!x)return 2;if(b)return this.create_iq(g,
[this,"response",["set",b,c,d]],"","set","",f),!0;b=this.create_iq(g,"","","set","",f);try{if("result"==b.IQ[0].ATTRIBUTES.TYPE)return!0}catch(D){gui._REQUEST_VARS.debug&&console.log(this._name||!1,D)}return!1};
_me.get=function(a,b,c,d,e){if("object"!=typeof a.resources)return!1;var f="private";"public"==a.xmlns?f="public":"domain"==a.xmlns&&(f="domain");var g=a.resources,h=!1,l={RESOURCES:[{}]};"string"==typeof a.domain&&(l.DOMAIN=[{VALUE:a.domain}]);var q=l.RESOURCES[0],t;for(t in g)b&&"private"==f&&!e&&dataSet.get(b,[g[t].toUpperCase()])||(q[a.resources[t]]=[{}],h=!0);if(h)if(b||d)this.create_iq(l,[this,"response",["get",b,c,d]],"","","",f);else return this.parse(this.create_iq(l,"","","","",f));else"object"==
typeof d&&executeCallbackFunction(d)};
_me.response=function(a,b,c,d,e){a=a.Array;d=a.IQ[0].ATTRIBUTES;switch(b){case "set":try{var f="result"==d.TYPE;"object"==typeof e&&executeCallbackFunction(e,[f]);if(f)return!0}catch(l){gui._REQUEST_VARS.debug&&console.log(this._name||!1,l)}return!1;case "get":try{if("result"==d.TYPE){var g=this.parse(a),h;for(h in g)dataSet.add(c,[h],g[h]);"object"==typeof e&&executeCallbackFunction(e,g);return!0}}catch(l){gui._REQUEST_VARS.debug&&console.log(this._name||!1,l)}return!1}};
_me.parse=function(a){try{var b=function(a,b){var c={},d;for(d in a)c[d]=a[d];c.ACCESS||(c.ACCESS="full");b&&(c.DONT_SEND=!0);return c},c=a.IQ[0].QUERY[0].RESOURCES[0],d,e,f;a={};var g,h,l,q,t,m;for(m in c){d=c[m][0];g=a[m]={};g.ATTRIBUTES=b(d.ATTRIBUTES,!0);h=g.ITEMS=[];for(var p in d.ITEM){e=d.ITEM[p];l={};l.ATTRIBUTES=b(e.ATTRIBUTES,!0);q=l.VALUES={};for(var u in e)"ATTRIBUTES"!=u&&(f=e[u][0],t=q[u]={},t.ATTRIBUTES=b(f.ATTRIBUTES,!1),t.VALUE="undefined"==typeof f.VALUE?"":f.VALUE);h.push(l)}}return a}catch(r){return!1}};
WMStorage=new wm_storage;
function cInit(a){document.getElementsByTagName("body")[0].innerHTML="";document.getElementsByTagName("head")[0].appendChild(mkElement("link",{rel:"stylesheet",type:"text/css",href:"client/skins/index.css"}));window.sSessionUID=unique_id();window.request=new cRequest("server/webmail.php");window.gui=new Gui("gui");window.request.onstart=function(a){gui._loading(a,!0)};window.request.onfinish=function(a){gui._loading(a)};window.oWM_INIT=this;var b={page:"index",debug:null,frm:null,sid:null,ref:null,
xml:null,username:null,password:null,mailto:null,subject:null,body:null,video:null,conference:null,cc:null,bcc:null,open:null,telemetry:null,from:null,tconly:null,RoomID:null,PostID:null};gui._REQUEST_VARS=arrConcat(arrKeySlice(a.get,b),arrKeySlice(parseURL(),b));a.language?storage.language(a.language):(storage.library("gw_others"),GWOthers.load(["layout_settings"]),GWOthers.getItem("LAYOUT_SETTINGS","language"),storage.language(GWOthers.getItem("LAYOUT_SETTINGS","language")));gui._create("connection",
"obj_connection");gui._create("preloader","obj_loader");gui.preloader._value("");b="";if(gui&&!gui._REQUEST_VARS.frm&&gui._REQUEST_VARS.sid){var c=auth.login({session:gui._REQUEST_VARS.sid,keep:gui._REQUEST_VARS.open?!0:!1,from:gui._REQUEST_VARS.from});if(gui._REQUEST_VARS.ref)dataSet.add("main",["referrer_url"],gui._REQUEST_VARS.ref);else if(location.hash.replace("#ref=","").length<location.hash.length)dataSet.add("main",["referrer_url"],location.hash.replace("#ref=",""));else if(document.referrer&&
document.referrer!=document.location.href){var d=document.referrer,e;if(-1<(e=d.indexOf("?"))){var f=parseURL(d.substr(e+1));delete f.mid;delete f.msg;delete f.eid;delete f["_s[action]"];d=d.substr(0,e)+"?"+buildURL(f)}dataSet.add("main",["referrer_url"],d)}if(c){dataSet.add("main",["sid"],c);this._continueLogin();return}if(Is.Object(auth.error))switch(auth.error.id){case "login_account_valid":b="ACCOUNT_DISABLED";break;case "login_invalid":case "session_no_user":b="INVALID_LOGIN";break;case "session_expired":b=
"EXPIRED";break;case "session_ip_mismatch":b="IP_MISMATCH";break;default:console.error(auth.error)}else b="INVALID_LOGIN"}else{try{d=location.hash.replace("#",""),d.replace(":","").length<d.length&&(e=d.split(":"),gui._REQUEST_VARS.username=e[0],gui._REQUEST_VARS.password=e[1],location.hash="#"),c=auth.login({username:gui._REQUEST_VARS.username,password:gui._REQUEST_VARS.password})}catch(g){b="CONNECTION",c=""}if(c&&!auth.error){this._continueLogin();return}if(Is.Object(auth.error))switch(auth.error.id){case "db_auto_create":b=
"NO_DB";break;case "login_account_valid":b="ACCOUNT_DISABLED";break;case "login_invalid":b="INVALID_LOGIN";break;case "wm_disabled":b="WC_DISABLED";break;case "settings_user_set":b="ACCESS_ERROR";break;case "RSA":b="INVALID_RSA"}}this._goBack(arrConcat(a.back||{},{reason:b}))}
cInit.prototype._goBack=function(a){storage.library("gw_others");var b=GWOthers.getItem("LAYOUT_SETTINGS","logout_url")||dataSet.get("main",["referrer_url"])||document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:"")+document.location.pathname;b&&!b.match(/^https?:\/\//)&&(b=document.location.protocol+"//"+b);if(a){var b=mkElement("form",{method:"POST",action:b,target:"_self",style:"position: absolute;top:0;left:0;"}),c;for(c in a)b.appendChild(mkElement("input",
{type:"hidden",name:c,value:a[c]}));gui._main.appendChild(b);b.submit()}};
cInit.prototype._continueLogin=function(a){function b(a){return c[a]||a}gui.preloader||gui._create("preloader","obj_loader");gui._REQUEST_VARS.frm||(gui.preloader&&gui.preloader._value(getLang("PRELOADER::FRAMEWORK")),storage.library("javascript"),gui.preloader&&gui.preloader._value(getLang("PRELOADER::DOCEDIT")));a=GWOthers.getItem("LAYOUT_SETTINGS","skin");gui.preloader&&gui.preloader._value(getLang("PRELOADER::SETTINGS"));GWOthers.load("skins banner_options im sip chat mail_settings_default mail_settings_general login_settings layout_settings homepage_settings calendar_settings default_calendar_settings cookie_settings default_reminder_settings event_settings spellchecker_languages signature groups restrictions aliases read_confirmation global_settings paths streamhost password_policy fonts certificate timezones external_settings gw_mygroup default_folders documents".split(" "));
storage.css("font");switch(GWOthers.getItem("LAYOUT_SETTINGS","font_weight")){case "auto":if(!gui.__BROWSER.retina)break;case "light":addcss(document.body,"light")}storage.language();var c={cn:"zh",dk:"da",jp:"ja",kr:"ko",se:"sv"};storage.library("icewarpdate.min","calendar");IcewarpDate.Locale.setLocaleURL("client/inc/calendar/locale/");IcewarpDate.setCalendar(+GWOthers.getItem("LAYOUT_SETTINGS","alternative_calendar"),!0);IcewarpDate.Locale.changeLocalizedFormat("L",CalendarFormatting.getFormat(+GWOthers.getItem("LAYOUT_SETTINGS",
"date_format")));IcewarpDate.Locale.changeLocalizedFormat("LT",+GWOthers.getItem("LAYOUT_SETTINGS","time_format")?"hh:mm a":"HH:mm");"0"!=GWOthers.getItem("CALENDAR_SETTINGS","begin_on_today")?(IcewarpDate.Locale.setCustomWeekStart((new IcewarpDate).day()),IcewarpDate.Locale.chooseLocale(b(GWOthers.getItem("LAYOUT_SETTINGS","language")))):IcewarpDate.Locale.setCustomWeekStart({monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6,sunday:0}[GWOthers.getItem("CALENDAR_SETTINGS","week_begins")]);
IcewarpDate.Locale.chooseLocale(b(GWOthers.getItem("LAYOUT_SETTINGS","language")));a!=GWOthers.getItem("LAYOUT_SETTINGS","skin")&&(storage.aStorage.template={});gui.preloader&&gui.preloader._value(getLang("PRELOADER::LANGUAGE"));storage.language(GWOthers.getItem("LAYOUT_SETTINGS","language"));switch(currentBrowser()){case "MSIE7":if(7>=currentBrowser(!0))return;case "Mozilla":case "Opera":case "Safari":case "Chrome":case "MSIE9":case "MSIE11":break;default:if(!window.confirm(getLang("CONFIRMATION::BROWSER_WARNING_TEXT_UNSUPPORTED"))){document.location.href=
"./basic/?sid="+dataSet.get("main",["sid"]);return}}storage.library("team_chat_api");a=WMAccounts.list();dataSet.add("accounts","",a);sPrimaryAccountGUEST||(storage.library("icewarpapi","icewarpapi"),window.icewarpapi=IceWarpAPI());this.__refreshed=!1;WMFolders.list({aid:sPrimaryAccount},"folders",[sPrimaryAccount],[this,"_updatePreloader"]);a=GWOthers.getItem("LAYOUT_SETTINGS","language");a=document.documentElement.lang={cn:"zh",dk:"da",jp:"ja",kr:"ko",se:"sv"}[a]||a||"en";gui._rtl=!!~["ar","fa",
"he"].indexOf(a);gui._rtl&&(document.body.className+=" rtl");a=GWOthers.getItem("EXTERNAL_SETTINGS","dropbox_app_key")||"";if("1"!=GWOthers.getItem("RESTRICTIONS","disable_dropbox")&&a.length){var d=document.createElement("script");d.type="text/javascript";d.src="https://www.dropbox.com/static/api/1/dropbox.js";d.id="dropboxjs";d.setAttribute("data-app-key",a);document.getElementsByTagName("head")[0].appendChild(d)}sPrimaryAccountSIP?(storage.library("sip_bridge"),"undefined"!=typeof IceSIP&&IceSIP.supported()?
(dataSet.add("sip",["state"],"offline"),dataSet.add("sip",["activity"],""),"Safari"===currentBrowser()&&storage.library("AdapterJS","sip"),storage.library("sharing","sip"),storage.library("JsSIP","sip")):window.JsSIP=null):window.JsSIP=null};
cInit.prototype._updatePreloader=function(){var a=dataSet.get("folders",[sPrimaryAccount]);if(a){storage.library("class_cookie");window.Cookie=new class_cookie;gui._REQUEST_VARS.frm?storage.library("smiles"):(gui.preloader&&gui.preloader._value(getLang("PRELOADER::STARTUP")),storage.css("style"),storage.template("templates"),storage.preloadObj());gui.preloader&&gui.preloader._destruct();if(sPrimaryAccountGUEST&&!Object.keys(a).some(function(b){return"I"===a[b].TYPE}))return gui._create("confirm",
"frm_alert","","",[function(){frm_main.prototype.__logout()}],"MAIN_MENU::LOGOUT","ERROR::MISSING_TEAMCHAT");var b=Cookie.get(["tzoffset"]),c=(new IcewarpDate).utcOffset();void 0===b?(Cookie.set(["tzoffset"],(new IcewarpDate).utcOffset()-60*(new IcewarpDate).getMoment().isDST()),gui._create("frm_main","frm_main","","",!0)):0<sPrimaryAccountGW&&b!=c-60*(new IcewarpDate).getMoment().isDST()?gui._create("timezone","frm_timezone","main","",[function(){gui._create("frm_main","frm_main","","",!0)}]):gui._create("frm_main",
"frm_main","","",!0);TeamChatAPI.init();gui.__exeEvent("GUIDone",!1,{owner:this});1==GWOthers.getItem("LAYOUT_SETTINGS","night_mode")&&setTimeout(function(){storage.library("night_mode");NightMode().activate()},1E3)}else this.__refreshed=!0,gui.preloader&&gui.preloader._value(getLang("PRELOADER::INDEXING")),WMAccounts.refresh({aid:sPrimaryAccount},"folders",[sPrimaryAccount],[this,"_updatePreloader"])};
function initPRO(a){new cInit(a);dataSet.on("folders",[sPrimaryAccount],function(a){for(var c in a)"I"!==a[c].TYPE||a[c].SYNC&&"0"!==a[c].SYNC||(a[c].RECENT=0)});"1"==sPrimaryAccountCHAT&&(a=function(a,c){if("folders"===a){if(!c||1!==c.length){var d=Cookie.get(["recent"])||[],e,f;c&&"RECENT"===c[c.length-1]&&"I"===dataSet.get("folders",c.slice(0,2)).TYPE&&"0"!==dataSet.get("folders",c.slice(0,2)).RECENT&&(e=c.slice(0,2).join("/"),f=d.indexOf(e),~f&&d.splice(f,1),d.unshift(e));Cookie.set(["recent"],
d);dataSet.update("cookies",["recent"])}}else d=dataSet.get("active_folder").split("/"),d=dataSet.get("folders",[d.shift(),d.join("/")]),gui.socket&&d&&"I"===d.TYPE&&gui.socket.api._pushGroupChatStatus(obj_groupchat._ONLINE)},dataSet.on("active_folder",[],a),dataSet.on("folders",[],a))}function gw_others(){}_me=gw_others.prototype;
_me.load=function(a,b,c,d){storage.library("wm_storage");b=b||"storage";a=WMStorage.get({resources:a});if(d)for(var e in a)dataSet.add(b,[e],a[e],!0);else dataSet.add(b,c,a,!0);this.checkLayoutSettings(b,c)};
_me.get=function(a,b,c,d){if(!a||!b)return!1;var e=dataSet.get(b,[a]),f=!1;d&&"object"!=typeof e&&(storage.library("wm_storage"),d=WMStorage.get({resources:[a]}),d[a]&&"object"==typeof d[a]&&!Is.Empty(d[a].ITEMS)&&(e=d[a],dataSet.add(b,[a],e,!0)));if("object"!=typeof e||Is.Empty(e.ITEMS))e={ITEMS:[{VALUES:{},ATTRIBUTES:{DONT_SEND:!0}}],ATTRIBUTES:{DONT_SEND:!0}},f=!0;if(!(e=this.setDefault(a,e,b,f)))return!1;a={full:0,view:1,none:2};b=e.ATTRIBUTES.ACCESS?e.ATTRIBUTES.ACCESS:"full";if(c)var g=e.ATTRIBUTES.USERACCESS?
e.ATTRIBUTES.USERACCESS:"full",h=e.ATTRIBUTES.DOMAINADMINACCESS?e.ATTRIBUTES.DOMAINADMINACCESS:"full";d=e.ITEMS[0];e=d.ATTRIBUTES.ACCESS?d.ATTRIBUTES.ACCESS:"full";b=a[b]>=a[e]?b:e;c&&(e=d.ATTRIBUTES.USERACCESS?d.ATTRIBUTES.USERACCESS:"full",f=d.ATTRIBUTES.DOMAINADMINACCESS?d.ATTRIBUTES.DOMAINADMINACCESS:"full",g=a[g]>=a[e]?g:e,h=a[h]>=a[f]?h:f);d=d.VALUES;var l={VALUES:{},ACCESS:{}},q=l.VALUES,t=l.ACCESS;if(c)var m=l.USERACCESS=[],p=l.DOMAINADMINACCESS=[];var u,r;for(r in d)u=r.toLowerCase(),q[u]=
d[r].VALUE,e=d[r].ATTRIBUTES.ACCESS?d[r].ATTRIBUTES.ACCESS:"full",t[u]=a[b]>=a[e]?b:e,c&&(e=d[r].ATTRIBUTES.USERACCESS?d[r].ATTRIBUTES.USERACCESS:"full",m[u]=a[g]>=a[e]?g:e,f=d[r].ATTRIBUTES.DOMAINADMINACCESS?d[r].ATTRIBUTES.DOMAINADMINACCESS:"full",p[u]=a[h]>=a[f]?h:f);return l};
_me.set=function(a,b,c,d){if(!a||"object"!=typeof b||!c)return!1;var e=dataSet.get(c,[a]);if("object"!=typeof e||Is.Empty(e.ITEMS)){e={ITEMS:[{VALUES:{},ATTRIBUTES:{DONT_SEND:!1}}],ATTRIBUTES:{DONT_SEND:!1}};g=e.ITEMS[0].VALUES;for(t in b)g[t.toUpperCase()]={VALUE:b[t],ATTRIBUTES:{}};dataSet.add(c,[a],e,!0)}else{var f=e.ITEMS[0],g=f.VALUES,h=!1,l=!1,q,t;for(t in b){l=!1;q=t.toUpperCase();"object"!=typeof g[q]&&(g[q]={ATTRIBUTES:{}});g[q].VALUE!=b[t]&&(g[q].VALUE=b[t],l=!0);if(d){if(d.USERACCESS){var m=
d.USERACCESS[t]?d.USERACCESS[t]:"full";(g[q].ATTRIBUTES.USERACCESS?g[q].ATTRIBUTES.USERACCESS:"full")!=m&&(g[q].ATTRIBUTES.USERACCESS=m,l=!0)}d.DOMAINADMINACCESS&&(m=d.DOMAINADMINACCESS[t]?d.DOMAINADMINACCESS[t]:"full",(g[q].ATTRIBUTES.DOMAINADMINACCESS?g[q].ATTRIBUTES.DOMAINADMINACCESS:"full")!=m&&(g[q].ATTRIBUTES.DOMAINADMINACCESS=m,l=!0))}l&&(h=!0,g[q].ATTRIBUTES.DEFAULT=!1)}h&&(e.ATTRIBUTES.DONT_SEND=!1,f.ATTRIBUTES.DONT_SEND=!1,dataSet.add(c,[a],e,!0))}return!0};
_me.getItem=function(a,b,c,d){b=b.toUpperCase();var e=dataSet.get(c||"storage",[a,"ITEMS",0,"VALUES",b]);if(d)return d=GWOthers.get(a,c||"storage",!0),b=b.toLowerCase(),{VALUE:d.VALUES[b]||this.getItem(a,b,c),ACCESS:d.ACCESS[b]||"full"};e||(GWOthers.get(a,c||"storage"),e=dataSet.get(c||"storage",[a,"ITEMS",0,"VALUES",b]));if(e)return e.VALUE};
_me.getItemAccess=function(a,b){b=b.toUpperCase();var c=dataSet.get("storage",[a,"ITEMS",0,"VALUES",b]);c||(GWOthers.get(a,"storage"),c=dataSet.get("storage",[a,"ITEMS",0,"VALUES",b]));return c?!c.ATTRIBUTES||"view"!=c.ATTRIBUTES.ACCESS:!1};_me.setItem=function(a,b,c){var d={};d[b]=c;GWOthers.set(a,d,"storage")};_me.save=function(a){WMStorage.set({resources:dataSet.get("storage")},"storage","",a)};
_me.setDefault=function(a,b,c,d){var e=this.getDefaultValues(a);if("object"==typeof e){d=b.ITEMS[0].VALUES;var f=!1,g;for(g in e)"undefined"==typeof d[g]&&(d[g]={VALUE:e[g],ATTRIBUTES:{DEFAULT:!0}},f=!0);f&&dataSet.add(c,[a],b,!0);return b}return d?!1:b};
_me.getDefaultValues=function(a){var b;switch(a){case "GLOBAL_SETTINGS":b={UPLOAD_LIMIT:0,HTTP_PORT:sPrimaryAccountHTTP};break;case "SKINS":b={DEFAULT:"Default"};break;case "IM":b={ENTER_SEND:1,AUTO_CHAT:0,AUTO_STATUS:1,SMILES:1,STATUS_DND:1,STATUS_OFFLINE:1,SOUND_NOTIFY:1,ESC:2,DISABLE_GONE_MESSAGE:0};break;case "CHAT":b={SMILES:1,SOUND_NOTIFY:1,VISUAL_NOTIFY:1};break;case "DOCUMENTS":b={OFFICE_APP:"webdoc",DISABLE_OFFICE:0};break;case "MAIL_SETTINGS_DEFAULT":b={SEND_UNDO:1,CTRL_ENTER:"0",SEND_DELAY:0,
REPLY_MYSELF:0,CHECK_SUBJECT:1,SIGN_TOP:1,FONT_FAMILY:0,FONT_SIZE:13,TEXT_DIRECTION:"LTR",SPELLCHECKER:"en",HTML_MESSAGE:1,REPLY_MESSAGE:0,READ_CONFIRMATION:0,SAVE_SENT_MESSAGE:1,ENCRYPT:0,SIGN:0,REPLY_TO_ADDRESS:"",PRIORITY:3,CHARSET:"UTF-8"};break;case "MAIL_SETTINGS_GENERAL":b={SOUND_NOTIFY:0,AUTOUPDATE:1,AUTOUPDATE_MINUTES:10,MOVE_TO_TRASH:1,FORWARD_MESSAGES:"inline",AUTOSAVE:1,AUTOSAVE_MINUTES:5,DEFAULT_FLAG:"1",AUTO_RECIPIENT_TO_ADDRESSBOOK:"0",SHOW_INLINE_IMAGES:"1",AUTO_SHOW_IMAGES:"0",AUTOCLEAR_TRASH_DAYS:"30",
GROUP_CONTACTS_BY_EMAIL:0};break;case "LAYOUT_SETTINGS":b={DISABLE_PDF:0,INTERFACES:"abp",ACTIVITY:0,LOGIN_STYLE:"blue",LOGIN_CLIENT:"advanced",SKIN:"default",SKIN_STYLE:"default",LANGUAGE:"en",DISABLE_OFFICE:0,LOGIN_LOGO:"login_logo.png",DATE_FORMAT:0,TIME_FORMAT:0,ALTERNATIVE_CALENDAR:1,INIT_PAGE:"i",CONFIRM_EXIT:1,NOTIFICATIONS:0,BANNER_ENABLED:1,FONT_WEIGHT:"auto",COMPACT_VIEW:"2",KEEP_SEARCH:1,PREVIEW_DELAY:1500};break;case "HOMEPAGE_SETTINGS":b={BANNER_HEIGHT:60,APPLICATION:1};break;case "CALENDAR_SETTINGS":b=
{WEEK_BEGINS:"sunday",BEGIN_ON_TODAY:0,DAY_BEGINS:8,DAY_ENDS:16,WORKWEEK_BEGINS:1,WORKWEEK_ENDS:5,TEMPERATURE:"C",AUTOCLEAR_TRASH_DAYS:"30",ALTERNATIVE_CALENDAR:-1};break;case "DEFAULT_CALENDAR_SETTINGS":b={EVENT_VIEW:"week_view",EVENT_SHOW_AS:"S",EVENT_SHARING:"U",CONTACT_SHARING:"U",JOURNAL_SHARING:"U",NOTE_SHARING:"U",FILE_SHARING:"U",TASK_SHARING:"U"};break;case "EVENT_SETTINGS":b={TIME:0,RM_TYPE:"E",EMAIL:""};break;case "DEFAULT_FOLDERS":b={AB:"__@@ADDRESSBOOK@@__",SENT:sPrimaryAccount+"/"+getLang("COMMON_FOLDERS::SENT"),
TRASH:sPrimaryAccount+"/"+getLang("COMMON_FOLDERS::TRASH"),DRAFTS:sPrimaryAccount+"/"+getLang("COMMON_FOLDERS::DRAFTS"),CONTACTS:sPrimaryAccount+"/"+getLang("FOLDERS::CONTACTS"),EVENTS:sPrimaryAccount+"/"+getLang("FOLDERS::EVENTS"),TASKS:sPrimaryAccount+"/"+getLang("FOLDERS::TASKS"),NOTES:sPrimaryAccount+"/"+getLang("FOLDERS::NOTES"),JOURNAL:sPrimaryAccount+"/"+getLang("FOLDERS::JOURNAL"),FILES:sPrimaryAccount+"/"+getLang("FOLDERS::FILES"),SMART:sPrimaryAccount+"/"+getLang("FOLDERS::FILES"),TEMPLATES:sPrimaryAccount+
"/"+getLang("COMMON_FOLDERS::TEMPLATES")};break;case "READ_CONFIRMATION":b={TEXT:getLang("EMAIL::READING_CONFIRMATION"),SUBJECT:getLang("EMAIL::READING_CONFIRMATION_SUBJECT"),SEND_CONFIRMATION:0};break;case "SIGNATURE":b={TEXT:"",ENABLE:1};break;case "LOGIN_DATA":b={IE_6_WARNING_SHOW_ON:0};break;case "RESET_SETTINGS":b={ENABLED:0,MAIL:getLang("RESET_PASS::EMAIL"),SUBJECT:getLang("RESET_PASS::SUBJECT")};break;case "RESTRICTIONS":b={SORTSTRING:0,DISABLE_OTHERACCOUNTS:0,DISABLE_WEATHER_SETTING:0,DISABLE_CHANGEPASS:0,
DISABLE_SIGNUP:1,DISABLE_DROPBOX:0,GAL_SUGGEST:1,DISABLE_NEW_ALIASES:0,DISABLE_PERSONALITIES:0};break;case "SIP":b={MODE:"integrate",START:1}}return b};
_me.checkLayoutSettings=function(a,b){var c=this.get("SKINS",a,b);if(c){var d={},e;for(e in c.VALUES)"value"!=e&&(d[e]=c.VALUES[e]);d[this.getItem("LAYOUT_SETTINGS","skin")]||this.setItem("LAYOUT_SETTINGS","skin",this.getDefaultValues("LAYOUT_SETTINGS").SKIN)}if(c=this.get("LANGUAGES",a,b)){d={};for(e in c.VALUES)d[e]=c.VALUES[e];d[this.getItem("LAYOUT_SETTINGS","language")]||this.setItem("LAYOUT_SETTINGS","language",this.getDefaultValues("LAYOUT_SETTINGS").LANGUAGE)}};
var GWOthers=new gw_others,_me=obj_loader.prototype;function obj_loader(){}_me._value=function(a){this._getAnchor("content").innerHTML=a};_me=obj_form_generic.prototype;function obj_form_generic(){}_me.__constructor=function(){this._telemetry="id"};_me._value=function(a){if("undefined"!=typeof a)this.__eIN.value=a,this.__restrictions&&this.__restrictions.length&&this.__check();else return this.__eIN.value.replace(/(\r\n)/gm,"\n").replace(/\n/gm,"\r\n")};
_me._disabled=function(a){if("undefined"==typeof a)return this.__eIN.disabled;a?(this.__eIN.disabled=!0,addcss(this._main,"disabled")):(this.__eIN.disabled=!1,removecss(this._main,"disabled"))};_me._getFocusElement=function(){return this.__eIN};_me._focus=function(){if(navigator.os&&"iOS"==navigator.os.name)return!0;var a=this._getFocusElement();return!a.offsetParent||"BODY"==a.offsetParent.tagName||"hidden"==getComputedStyle(a).visibility||a.readonly||a.disabled?!1:(a.focus(),!0)};
_me.__update=function(a){if(!this._listener)this._listener=a;else if(a&&this._listener!=a)return;this._value(dataSet.get(this._listener,this._listenerPath))};_me=obj_form_tab.prototype;function obj_form_tab(){}
_me.__constructor=function(){var a=this,b;this._getFocusElement&&(b=this._getFocusElement())&&("Opera"==currentBrowser()?(AttachEvent(b,"onkeydown",function(a){this.lastKey=a.keyCode;this.lastShift=a.shiftKey}),AttachEvent(b,"onblur",function(b){9==this.lastKey&&a.__tabIndex_dock&&(this.lastShift?a.__tabIndex_dock._tabIndexPrev(a):a.__tabIndex_dock._tabIndexNext(a));this._focused=!1;a.__tabIndex_dock&&(a.__tabIndex_dock.__lastFocus=a._pathName);this.lastShift=this.lastKey=null}),AttachEvent(b,"onfocus",
function(b){this._focused=!0;a.__tabIndex_dock&&(a.__tabIndex_dock.__lastFocus=a._pathName);this.lastShift=this.lastKey=null})):(AttachEvent(b,"onkeydown",function(b){b=b||window.event;if(9==b.keyCode){b.cancelBubble=!0;try{b.preventDefault()}catch(d){}try{b.stopPropagation()}catch(d){}!b.ctrlKey&&a.__tabIndex_dock&&(b.shiftKey?a.__tabIndex_dock._tabIndexPrev(a):a.__tabIndex_dock._tabIndexNext(a));return!1}}),AttachEvent(b,"onblur",function(b){this._focused=!1;a.__tabIndex_dock&&(a.__tabIndex_dock.__lastFocus=
"")}),AttachEvent(b,"onfocus",function(b){this._focused=!0;a.__tabIndex_dock&&(a.__tabIndex_dock.__lastFocus=a._pathName)})),this._add_destructor("__disobeyTabIndex"))};_me._tabIndex=function(a,b,c){if(!c)for(var d=this;d=d._parent;)if(d.__addTabIndex){c=d;break}c&&(this.__disobeyTabIndex(),c.__addTabIndex(this,a,b)&&(this.__tabIndex_dock=c))};_me._hasFocus=function(){return this._getFocusElement()._focused};
_me.__disobeyTabIndex=function(){this.__tabIndex_dock&&(this.__tabIndex_dock.__removeTabIndex(this),this.__tabIndex_dock=null)};_me=obj_button.prototype;function obj_button(){}
_me.__constructor=function(){this.__eIN=mkElement("input",{type:"button",name:this._pathName+"#main",id:this._pathName+"#main"});this._main.appendChild(this.__eIN);this.__eIN.className="obj_button"==this._type?"obj_button":"obj_button "+this._type;var a=this;this.__eIN.onclick=this._main.onclick=function(b){b=b||window.event;var c=b.target||b.srcElement;if(this==c)return a._disabled()||(c==a._main&&a._focus(),a._onclick&&a._onclick(b)),!1};this.__eIN.onfocus=function(b){b=b||window.event;a.__hasFocus=
!0;a._onfocus&&a._onfocus(b);a.__exeEvent("onfocus",b,{owner:a});addcss(a._main,"focus");return!0};this.__eIN.onblur=function(b){b=b||window.event;a.__hasFocus=!1;if(a._onblur&&!1===a._onblur(b))return!1;a.__exeEvent("onblur",b,{owner:a});removecss(a._main,"focus");return!0};this._main.oncontextmenu=function(b){b=b||window.event;a._oncontext&&!1!==a._oncontext(b)&&a.__exeEvent("oncontext",b,{owner:a});return!1};this._main.onkeydown=function(b){b=b||window.event;!a._disabled()&&a._onkeypress&&a._onkeypress(b);
return!0}};_me._value=function(a){return this.__eIN.value=a?getLang(a):this.__eIN.value};_me._text=function(a){if(Is.String(a))this.__eIN.value=a;else return this.__eIN.value||""};_me._title=function(a){if(Is.String(a))this._main.title=this.__eIN.title=-1!=a.indexOf("::")?getLang(a):a;else return this.__eIN.title||""};_me._active=function(a){if(!0===a)addcss(this._main,"active");else if(!1===a)removecss(this._main,"active");else return hascss(this._main,"active")};_me=obj_connection.prototype;
function obj_connection(){}_me.__constructor=function(){var a=this;this.__requests=[];this.__count=null;this.__dimmer=mkElement("div",{id:"dimmer"});document.body.appendChild(this.__dimmer);this.btn_ok._onclick=function(){a.__requests.shift();a._show()};this.btn_re._onclick=function(){a._flush()};this.btn_cancel._onclick=function(){a._clear()};this._add_destructor("__destructor")};
_me._queue=function(a,b,c,d){a={id:unique_id(),code:a,delay:b||0,handler:c,errorHandler:d};if(b=this._queueInRequests(a))return b.id;this.__requests.push(a);this.__exeEvent("_queue",!1,{owner:this,id:a.id});cRequest&&(30<cRequest.lapse||1>cRequest.lapse)||this._show();return a.id};
_me._queueInRequests=function(a){return this.__requests.filter(function(b){return a.code===b.code&&a.delay===b.delay&&getCallbackFunction(a.handler)===getCallbackFunction(b.handler)&&getCallbackFunction(a.errorHandler)===getCallbackFunction(b.errorHandler)}).pop()};_me._flush=function(){for(var a,b=0,c=this.__requests.length;b<c;b++)(a=this.__requests.shift())&&a.handler&&executeCallbackFunction(a.handler);this.__exeEvent("_flush",!1,{owner:this});this._show()};
_me._clear=function(){for(var a,b=0,c=this.__requests.length;b<c;b++)(a=this.__requests.shift())&&a.errorHandler&&executeCallbackFunction(a.errorHandler,!1);this.__exeEvent("_flush",!1,{owner:this});this._show()};_me._hide=function(a){if(Is.Defined(a)){var b=!1;this.__requests=this.__requests.filter(function(c){return a==c.id?(b=!0,!1):!0});b&&this._show()}};
_me._show=function(){"undefined"!=typeof this.__titleID&&gui.frm_main&&gui.frm_main.title&&gui.frm_main.title._remove(this.__titleID,!0);var a=this.__requests[0];if(a){"undefined"!=typeof this.__interval&&window.clearInterval(this.__interval);0<a.delay?(this.__count=a.delay,this._getAnchor("countdown").innerHTML=getLang("ERROR::COUNTDOWN",[a.delay]),this.__interval=window.setInterval(function(){try{this._refresh()}catch(a){gui._REQUEST_VARS.debug&&console.log(this._name||!1,a)}}.bind(this),1E3)):
this.__count=0;this._main.style.display="block";this._getAnchor("retry").style.display="none";this._getAnchor("countdown").style.display="none";this._getAnchor("accept").style.display="none";this._getAnchor("cancel").style.display=a.delay?"block":"none";var b;switch(a.code){case 404:this.__dimmer.style.display="block";b="ERROR::FILENOTFOUND";a.delay=0;break;case 500:b="ERROR::SERVERERROR";a.delay=0;break;case 503:this.__dimmer.style.display="block";b="ERROR::OVERLOADED";break;default:b="ERROR::CONNECTION"}this._getAnchor("errors").innerHTML=
getLang(b);a.delay?503==a.code?this._getAnchor("countdown").style.display="block":this._getAnchor("retry").style.display="block":this._getAnchor("accept").style.display="block";gui.frm_main&&gui.frm_main.title&&(this.__titleID=gui.frm_main.title._add(getLang("TITLE::CERROR"),5))}else this._main.style.display="none",this.__dimmer.style.display="none","undefined"!=typeof this.__interval&&window.clearInterval(this.__interval),this.__count=0};
_me._refresh=function(){0<this.__count?(this.btn_re._text(getLang("FORM_BUTTONS::RETRY")+" ("+this.__count+")"),this._getAnchor("countdown").innerHTML=getLang("ERROR::COUNTDOWN",[this.__count--])):this.btn_re._onclick()};_me.__destructor=function(){"undefined"!=typeof this.__interval&&window.clearInterval(this.__interval);this.__dimmer&&this.__dimmer.parentNode.removeChild(this.__dimmer)};
